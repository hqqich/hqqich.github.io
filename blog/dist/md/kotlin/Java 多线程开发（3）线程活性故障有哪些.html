<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html"><meta property="og:site_name" content="blog"><meta property="og:title" content="Java 多线程开发（3）线程活性故障有哪些"><meta property="og:description" content="公众号：字节数组 (https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image) 希望对你有所帮助 🤣🤣 目前，多线程编程可以说是在大部分平台和应用上都需要实现的一个基本需求。本系列文章..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="hqqich"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java 多线程开发（3）线程活性故障有哪些","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"hqqich","url":"https://mister-hope.com"}]}</script><title>Java 多线程开发（3）线程活性故障有哪些 | blog</title><meta name="description" content="公众号：字节数组 (https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image) 希望对你有所帮助 🤣🤣 目前，多线程编程可以说是在大部分平台和应用上都需要实现的一个基本需求。本系列文章...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/dist/assets/style-e1af0ae0.css" as="style"><link rel="stylesheet" href="/blog/dist/assets/style-e1af0ae0.css">
    <link rel="modulepreload" href="/blog/dist/assets/app-6847d3e4.js"><link rel="modulepreload" href="/blog/dist/assets/Java 多线程开发（3）线程活性故障有哪些.html-8afc8c39.js"><link rel="modulepreload" href="/blog/dist/assets/Java 多线程开发（3）线程活性故障有哪些.html-ec4fea86.js"><link rel="modulepreload" href="/blog/dist/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/blog/dist/assets/index.html-e68a8aa2.js" as="script"><link rel="prefetch" href="/blog/dist/assets/slides.html-141feb08.js" as="script"><link rel="prefetch" href="/blog/dist/assets/resume.html-af74f6e4.js" as="script"><link rel="prefetch" href="/blog/dist/assets/day01.html-5cb6ea40.js" as="script"><link rel="prefetch" href="/blog/dist/assets/JVM（Java虚拟机） 整理（一）.html-c802af0e.js" as="script"><link rel="prefetch" href="/blog/dist/assets/MySQL实战45讲笔记.html-ec2ab87d.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-8542c835.js" as="script"><link rel="prefetch" href="/blog/dist/assets/SpringBoot第十三篇：同时集成华为RC6.5.1安全版kafka和原生kafka，通过配置文件动态控制.html-ac22ae42.js" as="script"><link rel="prefetch" href="/blog/dist/assets/【SpringBoot】38 个常用注解.html-d7c57776.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一句话总结Docker与K8S的关系.html-6a7f6a6a.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Gson 和 Kotlin Data Class 的避坑指南.html-4ef25010.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（1）.html-4be2b241.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（2）.html-5409f006.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（3）.html-9cc8e7fe.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（1）什么是多线程.html-926ae862.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（2）怎么实现多线程同步.html-21b575b6.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（4）锁的分类有这么多.html-64ebf45c.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（5）超详细的 ThreadPoolExecutor 源码解析.html-779ab900.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（1）协程基础.html-e76de760.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（2）取消和超时.html-a013f20c.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（3）组合挂起函数.html-906a72b3.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（4）协程上下文和调度器.html-87dd6d3c.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（5）异步流.html-d8acf7fa.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（6）通道.html-fefa6085.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（7）异常处理.html-184269ff.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（8）共享可变状态和并发性.html-90cf0947.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（9）选择表达式.html-f6235f18.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 ConstraintLayout.html-2dfef235.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 Gson.html-9d50047b.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 Kotlin 协程.html-454b238f.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 RxJava 2.html-0c933355.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文读懂 Handler 机制.html-b83e7a10.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文读懂 Java 和 Kotlin 的泛型难点.html-0209f67e.js" as="script"><link rel="prefetch" href="/blog/dist/assets/两万六千字带你 Kotlin 入门.html-dcfc63bb.js" as="script"><link rel="prefetch" href="/blog/dist/assets/主流开源库源码分析（11）OkHttp 源码详解.html-41ba2913.js" as="script"><link rel="prefetch" href="/blog/dist/assets/主流开源库源码分析（12）OkHttp _ Retrofit 开发调试利器.html-458950f8.js" as="script"><link rel="prefetch" href="/blog/dist/assets/探究 Bitmap 的优化手段.html-52d8142b.js" as="script"><link rel="prefetch" href="/blog/dist/assets/探究 Kotlin 的隐藏性能开销与避坑指南.html-f86e10c2.js" as="script"><link rel="prefetch" href="/blog/dist/assets/404.html-3afd45f4.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-8daec251.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-8ecd507a.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-12fcd146.js" as="script"><link rel="prefetch" href="/blog/dist/assets/slides.html-c34de2ee.js" as="script"><link rel="prefetch" href="/blog/dist/assets/resume.html-9942c685.js" as="script"><link rel="prefetch" href="/blog/dist/assets/day01.html-a31fdbf7.js" as="script"><link rel="prefetch" href="/blog/dist/assets/JVM（Java虚拟机） 整理（一）.html-1bf76551.js" as="script"><link rel="prefetch" href="/blog/dist/assets/MySQL实战45讲笔记.html-9a8df87f.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-24c60f82.js" as="script"><link rel="prefetch" href="/blog/dist/assets/SpringBoot第十三篇：同时集成华为RC6.5.1安全版kafka和原生kafka，通过配置文件动态控制.html-fe294f3d.js" as="script"><link rel="prefetch" href="/blog/dist/assets/【SpringBoot】38 个常用注解.html-5f73fbfa.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一句话总结Docker与K8S的关系.html-587f5983.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Gson 和 Kotlin Data Class 的避坑指南.html-e5defc33.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（1）.html-c4e8e2df.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（2）.html-70d0b545.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java _ Android 集合框架须知须会（3）.html-72b0aa6f.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（1）什么是多线程.html-5b7e4972.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（2）怎么实现多线程同步.html-21ac1d9f.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（4）锁的分类有这么多.html-b7d9865b.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Java 多线程开发（5）超详细的 ThreadPoolExecutor 源码解析.html-3b6277c9.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（1）协程基础.html-d22d6f99.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（2）取消和超时.html-ff65bbdf.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（3）组合挂起函数.html-a73ab9a7.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（4）协程上下文和调度器.html-4406649b.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（5）异步流.html-fa3b7012.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（6）通道.html-b412ea58.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（7）异常处理.html-98e3e68c.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（8）共享可变状态和并发性.html-c1d8b982.js" as="script"><link rel="prefetch" href="/blog/dist/assets/Kotlin 协程官方文档（9）选择表达式.html-493d1377.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 ConstraintLayout.html-e1964282.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 Gson.html-05d7e3f3.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 Kotlin 协程.html-7cfb8b5c.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文快速入门 RxJava 2.html-a0a04e3f.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文读懂 Handler 机制.html-2e6ee611.js" as="script"><link rel="prefetch" href="/blog/dist/assets/一文读懂 Java 和 Kotlin 的泛型难点.html-f2e918b0.js" as="script"><link rel="prefetch" href="/blog/dist/assets/两万六千字带你 Kotlin 入门.html-79735e84.js" as="script"><link rel="prefetch" href="/blog/dist/assets/主流开源库源码分析（11）OkHttp 源码详解.html-04d14fbb.js" as="script"><link rel="prefetch" href="/blog/dist/assets/主流开源库源码分析（12）OkHttp _ Retrofit 开发调试利器.html-b0cb7ab2.js" as="script"><link rel="prefetch" href="/blog/dist/assets/探究 Bitmap 的优化手段.html-23362b77.js" as="script"><link rel="prefetch" href="/blog/dist/assets/探究 Kotlin 的隐藏性能开销与避坑指南.html-99fbb911.js" as="script"><link rel="prefetch" href="/blog/dist/assets/404.html-ddac28c5.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-214a6c03.js" as="script"><link rel="prefetch" href="/blog/dist/assets/index.html-f98bfbac.js" as="script"><link rel="prefetch" href="/blog/dist/assets/photoswipe.esm-060dc2da.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/blog/dist/"><img class="vp-nav-logo" src="/blog/dist/logo.svg" alt="blog"><!----><span class="vp-site-name hide-in-pad">blog</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="主页" class="vp-link nav-link nav-link" href="/blog/dist/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="about me" class="vp-link nav-link nav-link" href="/blog/dist/md/resume.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>about me<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="学习日志" class="vp-link nav-link nav-link" href="/blog/dist/md/dev-log/day01.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>学习日志<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="kotlin" class="vp-link nav-link nav-link" href="/blog/dist/md/kotlin/%E4%B8%A4%E4%B8%87%E5%85%AD%E5%8D%83%E5%AD%97%E5%B8%A6%E4%BD%A0%20Kotlin%20%E5%85%A5%E9%97%A8.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>kotlin<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/hqqich/hqqich.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="主页" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>主页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><span class="vp-sidebar-title">学习日志</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="Day01" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/day01.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Day01<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="MySQL实战45讲笔记" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2%E7%AC%94%E8%AE%B0.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>MySQL实战45讲笔记<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="SpringBoot第十三篇：同时集成华为RC6.5.1安全版kafka和原生kafka，通过配置文件动态控制" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/SpringBoot%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AF%87%EF%BC%9A%E5%90%8C%E6%97%B6%E9%9B%86%E6%88%90%E5%8D%8E%E4%B8%BARC6.5.1%E5%AE%89%E5%85%A8%E7%89%88kafka%E5%92%8C%E5%8E%9F%E7%94%9Fkafka%EF%BC%8C%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A8%E6%80%81%E6%8E%A7%E5%88%B6.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>SpringBoot第十三篇：同时集成华为RC6.5.1安全版kafka和原生kafka，通过配置文件动态控制<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="/md/dev-log/【SpringBoot】 SpringBoot核心-CSDN博客.md" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/【SpringBoot】 SpringBoot核心-CSDN博客.html"><!---->/md/dev-log/【SpringBoot】 SpringBoot核心-CSDN博客.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一句话总结Docker与K8S的关系" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%BB%E7%BB%93Docker%E4%B8%8EK8S%E7%9A%84%E5%85%B3%E7%B3%BB.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一句话总结Docker与K8S的关系<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="JVM（Java虚拟机） 整理（一）" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/JVM%EF%BC%88Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%89%20%E6%95%B4%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>JVM（Java虚拟机） 整理（一）<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="【SpringBoot】38 个常用注解" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/dev-log/%E3%80%90SpringBoot%E3%80%9138%20%E4%B8%AA%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>【SpringBoot】38 个常用注解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><span class="vp-sidebar-title">kotlin</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="Gson 和 Kotlin Data Class 的避坑指南" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Gson%20%E5%92%8C%20Kotlin%20Data%20Class%20%E7%9A%84%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Gson 和 Kotlin Data Class 的避坑指南<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java &amp; Android 集合框架须知须会（1）" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20_%20Android%20%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A%EF%BC%881%EF%BC%89.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java &amp; Android 集合框架须知须会（1）<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java &amp; Android 集合框架须知须会（2）" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20_%20Android%20%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A%EF%BC%882%EF%BC%89.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java &amp; Android 集合框架须知须会（2）<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java &amp; Android 集合框架须知须会（3）" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20_%20Android%20%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A%EF%BC%883%EF%BC%89.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java &amp; Android 集合框架须知须会（3）<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java 多线程开发（1）什么是多线程" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%881%EF%BC%89%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（1）什么是多线程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java 多线程开发（2）怎么实现多线程同步" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%882%EF%BC%89%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（2）怎么实现多线程同步<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java 多线程开发（3）线程活性故障有哪些" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（3）线程活性故障有哪些<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="1、粗锁法" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html#_1、粗锁法"><!---->1、粗锁法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="2、锁排序法" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html#_2、锁排序法"><!---->2、锁排序法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="3、资源限时申请" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html#_3、资源限时申请"><!---->3、资源限时申请<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="1、信号丢失锁死" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html#_1、信号丢失锁死"><!---->1、信号丢失锁死<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="2、嵌套监视器锁死" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%883%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%B4%BB%E6%80%A7%E6%95%85%E9%9A%9C%E6%9C%89%E5%93%AA%E4%BA%9B.html#_2、嵌套监视器锁死"><!---->2、嵌套监视器锁死<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="Java 多线程开发（4）锁的分类有这么多" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%884%EF%BC%89%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB%E6%9C%89%E8%BF%99%E4%B9%88%E5%A4%9A.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（4）锁的分类有这么多<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Java 多线程开发（5）超详细的 ThreadPoolExecutor 源码解析" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%885%EF%BC%89%E8%B6%85%E8%AF%A6%E7%BB%86%E7%9A%84%20ThreadPoolExecutor%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（5）超详细的 ThreadPoolExecutor 源码解析<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（1）协程基础" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%881%EF%BC%89%E5%8D%8F%E7%A8%8B%E5%9F%BA%E7%A1%80.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（1）协程基础<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（2）取消和超时" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%882%EF%BC%89%E5%8F%96%E6%B6%88%E5%92%8C%E8%B6%85%E6%97%B6.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（2）取消和超时<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（3）组合挂起函数" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%883%EF%BC%89%E7%BB%84%E5%90%88%E6%8C%82%E8%B5%B7%E5%87%BD%E6%95%B0.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（3）组合挂起函数<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（4）协程上下文和调度器" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%884%EF%BC%89%E5%8D%8F%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E8%B0%83%E5%BA%A6%E5%99%A8.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（4）协程上下文和调度器<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（5）异步流" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%885%EF%BC%89%E5%BC%82%E6%AD%A5%E6%B5%81.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（5）异步流<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（6）通道" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%886%EF%BC%89%E9%80%9A%E9%81%93.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（6）通道<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（7）异常处理" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%887%EF%BC%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（7）异常处理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（8）共享可变状态和并发性" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%888%EF%BC%89%E5%85%B1%E4%BA%AB%E5%8F%AF%E5%8F%98%E7%8A%B6%E6%80%81%E5%92%8C%E5%B9%B6%E5%8F%91%E6%80%A7.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（8）共享可变状态和并发性<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Kotlin 协程官方文档（9）选择表达式" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/Kotlin%20%E5%8D%8F%E7%A8%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%889%EF%BC%89%E9%80%89%E6%8B%A9%E8%A1%A8%E8%BE%BE%E5%BC%8F.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Kotlin 协程官方文档（9）选择表达式<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文快速入门 ConstraintLayout" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%20ConstraintLayout.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文快速入门 ConstraintLayout<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文快速入门 Gson" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%20Gson.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文快速入门 Gson<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文快速入门 Kotlin 协程" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%20Kotlin%20%E5%8D%8F%E7%A8%8B.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文快速入门 Kotlin 协程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文快速入门 RxJava 2" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%20RxJava%202.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文快速入门 RxJava 2<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文读懂 Handler 机制" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E8%AF%BB%E6%87%82%20Handler%20%E6%9C%BA%E5%88%B6.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文读懂 Handler 机制<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="一文读懂 Java 和 Kotlin 的泛型难点" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%80%E6%96%87%E8%AF%BB%E6%87%82%20Java%20%E5%92%8C%20Kotlin%20%E7%9A%84%E6%B3%9B%E5%9E%8B%E9%9A%BE%E7%82%B9.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>一文读懂 Java 和 Kotlin 的泛型难点<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="两万六千字带你 Kotlin 入门" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%A4%E4%B8%87%E5%85%AD%E5%8D%83%E5%AD%97%E5%B8%A6%E4%BD%A0%20Kotlin%20%E5%85%A5%E9%97%A8.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>两万六千字带你 Kotlin 入门<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="主流开源库源码分析（11）OkHttp 源码详解" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%8811%EF%BC%89OkHttp%20%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>主流开源库源码分析（11）OkHttp 源码详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="主流开源库源码分析（12）OkHttp &amp; Retrofit 开发调试利器" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%8812%EF%BC%89OkHttp%20_%20Retrofit%20%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E5%88%A9%E5%99%A8.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>主流开源库源码分析（12）OkHttp &amp; Retrofit 开发调试利器<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="探究 Bitmap 的优化手段" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E6%8E%A2%E7%A9%B6%20Bitmap%20%E7%9A%84%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>探究 Bitmap 的优化手段<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="探究 Kotlin 的隐藏性能开销与避坑指南" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blog/dist/md/kotlin/%E6%8E%A2%E7%A9%B6%20Kotlin%20%E7%9A%84%E9%9A%90%E8%97%8F%E6%80%A7%E8%83%BD%E5%BC%80%E9%94%80%E4%B8%8E%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97.html"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>探究 Kotlin 的隐藏性能开销与避坑指南<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（3）线程活性故障有哪些</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">hqqich</a></span><span property="author" content="hqqich"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 26 分钟</span><meta property="timeRequired" content="PT26M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category1" role>kotlin</span><!--]--><meta property="articleSection" content="kotlin"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blog/dist/#_1、粗锁法">1、粗锁法</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blog/dist/#_2、锁排序法">2、锁排序法</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blog/dist/#_3、资源限时申请">3、资源限时申请</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blog/dist/#_1、信号丢失锁死">1、信号丢失锁死</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blog/dist/#_2、嵌套监视器锁死">2、嵌套监视器锁死</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><blockquote><p>公众号：<a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" rel="noopener noreferrer">字节数组<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>希望对你有所帮助 🤣🤣</p></blockquote><blockquote><p>目前，多线程编程可以说是在大部分平台和应用上都需要实现的一个基本需求。本系列文章就来对 <strong>Java 平台下的多线程编程知识</strong>进行讲解，从<strong>概念入门</strong>、<strong>底层实现</strong>到<strong>上层应用</strong>都会涉及到，预计一共会有五篇文章，希望对你有所帮助 😎😎</p><p>本篇文章是第三篇，来介绍四种不同类型的线程活性故障现象，这是开发者所必须应对的异常情况</p></blockquote><p><strong>线程活性故障</strong>是由于资源稀缺性或者程序自身的问题导致线程一直处于非 Runnable 状态，或者线程虽然处于 Runnable 状态但是其要执行的任务一直无法取得进展的一种故障现象</p><p>下面就来介绍几种常见类型的线程活性故障：</p><ol><li><p>死锁</p></li><li><p>锁死</p></li><li><p>线程饥饿</p></li><li><p>活锁</p></li></ol><h1 id="一、死锁" tabindex="-1"><a class="header-anchor" href="#一、死锁" aria-hidden="true">#</a> 一、死锁</h1><p>如果多个线程因互相等待对方而被永远暂停（生命周期状态为 Blocked 或者 Waiting），那么就称这些线程产生了死锁（Deadlock）。由于产生死锁的线程的生命周期状态永远是非运行状态，所以如果没有外力作用，这些线程所要执行的任务就永远也无法取得进展</p><p>例如，线程 A 在持有锁 L1 的情况下申请锁 L2，同时线程 B 在持有锁 L2 的情况下在申请锁 L1，而线程 A 和线程 B 各自要求只有在取得对方的锁后才能释放持有的锁，这就导致了两个锁都将处于无限等待的状态，此时死锁就发生了</p><p>有关死锁的一个经典问题是<strong>哲学家就餐问题</strong>。五位哲学家围着一张圆桌，每位哲学家之间均放着一根筷子，即一共有五根筷子。每位哲学家要么处于思考状态，要么是在吃饭。吃饭前，每位哲学家均会先拿起左手边的筷子，再拿起右手边的筷子，只有当手上持有了一双筷子时哲学家才能够吃饭，且除非本次吃饭行为完成，否则哲学家不会放下手中已持有的筷子。哲学家吃完饭后就会放下手中的筷子，再次思考一段时间后再进行吃饭</p><p>在这个问题中，每位哲学家就相当于一个线程，每根筷子就相当于多条线程间的共享资源。且筷子明显是一个排他性资源，因为每根筷子每次只能由一位哲学家持有，因此哲学家在拿起筷子前需要先取得筷子对应的锁。由于筷子和哲学家的数量相等，而每位哲学家需要的筷子数量是现有的两倍，所以发生死锁的可能性还是很大的</p><p>我们可以用一段程序来模拟并验证上述的情况</p><p>先对筷子 Chopstick 进行定义，其能被操作的行为只有两种，即：<strong>拿起</strong>和<strong>放下</strong></p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">enum</span> <span class="token keyword">class</span> ChopstickStatus <span class="token punctuation">{</span>
    UP<span class="token punctuation">,</span>
    Down
<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Chopstick</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> status <span class="token operator">=</span> ChopstickStatus<span class="token punctuation">.</span>Down
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">fun</span> <span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        status <span class="token operator">=</span> ChopstickStatus<span class="token punctuation">.</span>UP
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        status <span class="token operator">=</span> ChopstickStatus<span class="token punctuation">.</span>Down
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每位哲学家 Philosopher 均对应一个唯一的标识 id，一根左手边的筷子 left，一根右手边的筷子 right。会不间断地进行“思考”和“吃饭”两种行为，每种行为均包含一段随机的时间间隔（随机的线程休眠）</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">object</span> Tools <span class="token punctuation">{</span>

    <span class="token keyword">fun</span> <span class="token function">randomSleep</span><span class="token punctuation">(</span>max<span class="token operator">:</span> Long <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> realMax <span class="token operator">=</span> max<span class="token punctuation">.</span><span class="token function">coerceAtLeast</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        ThreadLocalRandom<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextLong</span><span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span>realMax <span class="token operator">==</span> <span class="token number">1L</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">1</span><span class="token punctuation">,</span> max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Chopstick<span class="token punctuation">,</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Chopstick<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Philosopher-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">synchronized</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">synchronized</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 开始吃饭.....&quot;</span></span><span class="token punctuation">)</span>
                Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 吃饭结束!!!!!!!!!!&quot;</span></span><span class="token punctuation">)</span>
                right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 思考中....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，我们创建五根筷子，并将每根筷子按顺序分配给每位哲学家，然后就启动哲学家的思考和吃饭行为（启动线程）</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">/**
 * @Author: leavesCZY
 * @Github：https://github.com/leavesCZY
 */</span>
<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> philosopherNumber <span class="token operator">=</span> <span class="token number">5</span>

    <span class="token keyword">val</span> chopstickList <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Chopstick<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span> until philosopherNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        chopstickList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Chopstick</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> philosopherList <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Philosopher<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token keyword">in</span> <span class="token number">0</span> until philosopherNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> left <span class="token operator">=</span> chopstickList<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">val</span> right <span class="token operator">=</span> chopstickList<span class="token punctuation">.</span><span class="token function">getOrNull</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?:</span> chopstickList<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        philosopherList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Philosopher</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    philosopherList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot; 左手边的筷子是：&quot;</span></span> <span class="token operator">+</span> it<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot; 右手边的筷子是：&quot;</span></span> <span class="token operator">+</span> it<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    philosopherList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，运行程序后，只要我们为哲学家设定每次思考和吃饭的耗时时间不要太长，那么应该就能很快看到程序没有继续输出日志了，似乎被卡住了，此时即发生了死锁</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>Philosopher<span class="token operator">-</span><span class="token number">0</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据输出日志可以分析出，最后每位哲学家均拿到了其左手边的筷子，且均在等待右手边的筷子被放下，但此时由于筷子是独占资源，所以每位哲学家都只能干瞪着眼无法吃饭，最终导致了死锁</p><h1 id="二、死锁的产生条件" tabindex="-1"><a class="header-anchor" href="#二、死锁的产生条件" aria-hidden="true">#</a> 二、死锁的产生条件</h1><p>哲学家就餐问题反映了发生死锁的<strong>必要条件</strong>，线程一旦发生死锁，那么这些线程及相关的共享资源就一定同时满足以下条件：</p><ol><li>资源互斥。涉及的资源必须是排他性资源，即每个资源每次只能由一个线程持有</li><li>资源不可抢夺。涉及的资源只能由其持有线程主动释放，其它线程无法从持有线程中主动夺得</li><li>占用并等待其它资源。涉及的线程当前至少已经持有了一个排他性资源，并在申请其它资源，而这些资源同时又被其它线程所持有。在这个资源等待过程中，线程不会主动释放持有的现有资源</li><li>循环等待资源。在涉及到的所有线程列表内部，每个线程均在互相等待其它线程释放持有的资源，形成了互相等待的圆形依赖关系。即存在一个处于等待状态的线程集合 {T1, T2, ..., Tn}，其中 Ti 等待的资源被 T(i+1) 占有（i 大于等于 1 小于 n），Tn 等待的资源被 T1 占有</li></ol><p>以上条件是死锁产生的必要条件而非充分条件，即只要产生了死锁，以上条件就一定同时成立，但是上诉条件即使同时成立也未必就一定能产生死锁。例如，对于上诉的第四点，如果线程 T1 等待的资源数大于一，除了等待 T2 主动释放持有的一份资源外，T1 还可以通过获取<strong>循环圈</strong>外的多余资源来打破线程间的循环等待关系，从而避免造成死锁</p><h1 id="三、规避死锁" tabindex="-1"><a class="header-anchor" href="#三、规避死锁" aria-hidden="true">#</a> 三、规避死锁</h1><p>如果把 Java 平台下的锁（Lock）当做一种资源，那么这种资源就正好符合“资源互斥”和“资源不可抢夺”的要求，在这种情况下，产生死锁的代码特征就是在持有一个锁的情况下去申请另外一个锁，这通常意味着锁的嵌套。但是，一个线程在已经持有一个锁的情况下再次申请这个锁并不会导致死锁，这是因为 Java 中的锁都是可重入的（Reentrant），这种情形下线程重复申请某个锁是可以成功的</p><p>从上诉的四个发生死锁的必要条件来反推，我们只要消除死锁产生的任意一个必要条件就可以规避死锁了。由于锁具有排他性且只能由其持有线程来主动释放，因此由锁导致的死锁只能从消除“占用并等待资源”和消除“循环等待资源”这两个方向入手。以下就来介绍基于这两个思路来规避死锁的方法</p><h2 id="_1、粗锁法" tabindex="-1"><a class="header-anchor" href="#_1、粗锁法" aria-hidden="true">#</a> 1、粗锁法</h2><p>粗锁法即使用粗粒度的锁来代替多个锁。“占用并等待资源”这个条件隐含的情况即：线程在持有一个锁的同时还去申请另一个锁。那么，只要采用一个粒度较粗的锁来替代原先粒度较细的锁，使得涉及的资源都只需要申请一个锁就可以获得，那么就可以避免死锁</p><p>对应上诉的哲学家就餐问题，只要将 Philosopher 拿左手边筷子和拿右手边筷子的行为统一放到同个锁内，就可以消除“占用并等待资源”和“循环等待资源”这两个条件了</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Chopstick<span class="token punctuation">,</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Chopstick<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Philosopher-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">val</span> LOCK <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">synchronized</span><span class="token punctuation">(</span>LOCK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 开始吃饭.....&quot;</span></span><span class="token punctuation">)</span>
            Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 吃饭结束!!!!!!!!!!&quot;</span></span><span class="token punctuation">)</span>
            right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 思考中....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>粗锁法的缺点就是它明显降低了并发性并可能导致资源浪费。修改过后的代码，每次只有一位哲学家能够吃饭。如果每位哲学家吃饭的耗时相对其思考的时间要长得多，那么在持有筷子的哲学家吃饭结束前，有可能其他哲学家都已经处于等待筷子的状态了（即锁的争用程度比较高，多个线程由于申请不到锁而被暂停，每次锁的争夺可能会经历多次线程上下文切换）。而如果每位哲学家吃饭的耗时相对其思考的时间要短得多，那么就有可能在非持有筷子的哲学家结束思考前，持有筷子的哲学家就已经吃饭结束了（即锁的争用比较低，每次只有一个线程来申请锁，此时就不会由于申请锁而导致线程上下文切换）</p><p>即使锁的争用程度比较低，一位哲学家在吃饭的时候也仅需要占用两根筷子，剩下的三根筷子本来还可以提供给另外一位哲学家使用，此时采用粗锁法就明显导致了资源的浪费。因此，粗锁法的适用范围较为有限</p><h2 id="_2、锁排序法" tabindex="-1"><a class="header-anchor" href="#_2、锁排序法" aria-hidden="true">#</a> 2、锁排序法</h2><p>锁排序法的思路是：对所有锁按照一定规则进行排序，所有线程在申请锁之前均按照先后顺序进行申请，以此来消除“循环等待资源”这个条件，从而来规避死锁</p><p>例如，对上诉的哲学家问题进行简单化。假设哲学家的数量是 2。哲学家1的左手边是筷子2，右手边是筷子1；哲学家2的左手边是筷子1，右手边是筷子2。当两位哲学家同时拿起左手边的筷子时，此时就会发生死锁。而如果对筷子的申请顺序进行要求，要求哲学家需要先拿起 ID 较小的筷子才能去申请 ID 较大的筷子，那么此时先拿到筷子1的哲学家就可以无竞争地拿到筷子2，从而避免了“循环等待资源”的情况</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Chopstick<span class="token punctuation">,</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Chopstick<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Philosopher-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> one<span class="token operator">:</span> Chopstick

    <span class="token keyword">private</span> <span class="token keyword">val</span> theOther<span class="token operator">:</span> Chopstick

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        <span class="token comment">//每位哲学家都对其左右两边的筷子进行排序</span>
        <span class="token comment">//都按照“先取ID小的筷子再取ID大的筷子”的这种规则来拿筷子</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token punctuation">.</span>id <span class="token operator">&lt;</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            one <span class="token operator">=</span> left
            theOther <span class="token operator">=</span> right
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            one <span class="token operator">=</span> right
            theOther <span class="token operator">=</span> left
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">synchronized</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">synchronized</span><span class="token punctuation">(</span>theOther<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 开始吃饭.....&quot;</span></span><span class="token punctuation">)</span>
                Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 吃饭结束!!!!!!!!!!&quot;</span></span><span class="token punctuation">)</span>
                right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 思考中....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3、资源限时申请" tabindex="-1"><a class="header-anchor" href="#_3、资源限时申请" aria-hidden="true">#</a> 3、资源限时申请</h2><p>避免死锁的另一种方法是在申请资源时设定一个超时时间，避免无限制地等待资源，从而消除“占用并等待资源”这种情况。当等待时间超出既定的限制时，释放已持有的资源（哲学家放下左手边的筷子转而去继续思考）先给其它线程使用，待后续再重新申请资源</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Chopstick<span class="token punctuation">,</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Chopstick<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Philosopher-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">val</span> LOCK_MAP <span class="token operator">=</span> ConcurrentHashMap<span class="token operator">&lt;</span>Chopstick<span class="token punctuation">,</span> ReentrantLock<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        LOCK_MAP<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> <span class="token function">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        LOCK_MAP<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> <span class="token function">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> leftLock <span class="token operator">=</span> LOCK_MAP<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token operator">!!</span>
        <span class="token keyword">val</span> leftLockAcquired <span class="token operator">=</span> leftLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>leftLockAcquired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">val</span> rightLock <span class="token operator">=</span> LOCK_MAP<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token operator">!!</span>
        <span class="token keyword">val</span> rightLockAcquired <span class="token operator">=</span> rightLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rightLockAcquired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            leftLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 开始吃饭.....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 吃饭结束!!!!!!!!!!&quot;</span></span><span class="token punctuation">)</span>
        right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        leftLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        rightLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 思考中....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="四、死锁的恢复" tabindex="-1"><a class="header-anchor" href="#四、死锁的恢复" aria-hidden="true">#</a> 四、死锁的恢复</h1><p>死锁的恢复有着一定难度，原因主要有以下几点</p><ul><li>如果代码中使用的是内部锁，或者使用的是显式锁的 <code>Lock.lock()</code> 方法，那么这些锁导致的死锁是无法恢复的，此时只能通过重启 Java 虚拟机来停止程序</li><li>可以通过定义一个工作者线程专门用于检测和恢复死锁。该线程定时检测系统中是否存在死锁，如果存在，则选择一个死锁线程向其发送中断。该中断使得相应的死锁线程被唤醒并抛出 InterruptedException 异常，死锁线程捕获到 InterruptedException 异常后主动释放已持有的资源，从而“消除并等待资源”这个条件。如果该死锁线程释放已持有的线程后依然存在死锁，工作者线程就继续选择一个死锁线程进行中断处理，直到消除死锁。这种方法依赖于发生死锁的线程能够响应中断，而<strong>能响应中断的同时并释放已持有的资源</strong>就意味着在一开始我们就考虑到了可能会发生死锁，那么我们应该在一开始就做好死锁的预防，而不是使死锁线程支持死锁的恢复处理</li><li>即使死锁线程能够在响应中断的同时并释放已持有的资源，那么检测死锁的工作者线程应该按照什么顺序来中断死锁线程依然是个问题，且被中断的死锁线程可能会丢失其之前已经完成的计算任务，从而导致各种意想不到的情况</li></ul><p>这里根据第一节内容中会发生死锁的哲学家问题，来尝试恢复死锁</p><p>定义一个死锁检测线程 DeadlockDetector，它会每隔一段时间定时检测当前系统是否发生了死锁，如果发生了的话，则从涉及到死锁的所有线程中选择一个线程向其发送中断请求，被中断的线程内部需要捕获中断异常，然后自动释放其持有的资源，尝试将资源让给其它线程使用，从而打破<strong>占用并等待其它资源</strong>和<strong>资源循环等待</strong>两个条件</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">/**
 * @Author: leavesCZY
 * @Github：https://github.com/leavesCZY
 */</span>
<span class="token keyword">class</span> <span class="token function">DeadlockDetector</span><span class="token punctuation">(</span>monitorInterval<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;DeadlockDetector&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">val</span> tmb <span class="token operator">=</span> ManagementFactory<span class="token punctuation">.</span><span class="token function">getThreadMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">//获取发生死锁时涉及到的所有线程</span>
        <span class="token keyword">fun</span> <span class="token function">findDeadlockedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>ThreadInfo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">val</span> ids <span class="token operator">=</span> tmb<span class="token punctuation">.</span><span class="token function">findDeadlockedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tmb<span class="token punctuation">.</span><span class="token function">findDeadlockedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> tmb<span class="token punctuation">.</span><span class="token function">getThreadInfo</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">fun</span> <span class="token function">findThreadById</span><span class="token punctuation">(</span>threadId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Thread<span class="token operator">?</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>thread <span class="token keyword">in</span> <span class="token function">getAllStackTraces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>thread<span class="token punctuation">.</span>id <span class="token operator">==</span> threadId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> thread
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//向线程发送中断</span>
        <span class="token keyword">fun</span> <span class="token function">interruptThread</span><span class="token punctuation">(</span>threadId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
            <span class="token keyword">val</span> thread <span class="token operator">=</span> <span class="token function">findThreadById</span><span class="token punctuation">(</span>threadId<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>thread <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//检测周期，单位为毫秒</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> monitorInterval<span class="token operator">:</span> Long

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        isDaemon <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>monitorInterval <span class="token operator">=</span> monitorInterval
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> threadInfoList<span class="token operator">:</span> Array<span class="token operator">&lt;</span>ThreadInfo<span class="token operator">&gt;</span>
        <span class="token keyword">var</span> ti<span class="token operator">:</span> ThreadInfo<span class="token operator">?</span>
        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadInfoList <span class="token operator">=</span> <span class="token function">findDeadlockedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>threadInfoList<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ti <span class="token operator">=</span> threadInfoList<span class="token punctuation">[</span>i<span class="token operator">++</span> <span class="token operator">%</span> threadInfoList<span class="token punctuation">.</span>size<span class="token punctuation">]</span>
                    <span class="token function">interruptThread</span><span class="token punctuation">(</span>ti<span class="token punctuation">.</span>threadId<span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    i <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token punctuation">}</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span>monitorInterval<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> InterruptedException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Philosopher 通过 <code>Lock.lockInterruptibly()</code> 方法来申请锁，该方法可以响应中断。此时就可以在捕获到中断异常时自动释放已持有的资源</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Chopstick<span class="token punctuation">,</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Chopstick<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Thread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Philosopher-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">val</span> LOCK_MAP <span class="token operator">=</span> ConcurrentHashMap<span class="token operator">&lt;</span>Chopstick<span class="token punctuation">,</span> ReentrantLock<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        LOCK_MAP<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> <span class="token function">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        LOCK_MAP<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> <span class="token function">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> leftLock <span class="token operator">=</span> LOCK_MAP<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token operator">!!</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            leftLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> InterruptedException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> ==========放弃等待左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">val</span> rightLock <span class="token operator">=</span> LOCK_MAP<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token operator">!!</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            rightLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> InterruptedException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> ==========放弃等待右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

            left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> ====================放下已持有的左边的筷子: &quot;</span></span> <span class="token operator">+</span> left<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

            leftLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 拿起了右边的筷子: &quot;</span></span> <span class="token operator">+</span> right<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 开始吃饭.....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 吃饭结束!!!!!!!!!!&quot;</span></span><span class="token punctuation">)</span>

        left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        leftLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        rightLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> 思考中....&quot;</span></span><span class="token punctuation">)</span>
        Tools<span class="token punctuation">.</span><span class="token function">randomSleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
 * @Author: leavesCZY
 * @Github：https://github.com/leavesCZY
 */</span>
<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> philosopherNumber <span class="token operator">=</span> <span class="token number">5</span>

    <span class="token keyword">val</span> chopstickList <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Chopstick<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span> until philosopherNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        chopstickList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Chopstick</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> philosopherList <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Philosopher<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token keyword">in</span> <span class="token number">0</span> until philosopherNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> left <span class="token operator">=</span> chopstickList<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">val</span> right <span class="token operator">=</span> chopstickList<span class="token punctuation">.</span><span class="token function">getOrNull</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?:</span> chopstickList<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        philosopherList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Philosopher</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    philosopherList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot; 左手边的筷子是：&quot;</span></span> <span class="token operator">+</span> it<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot; 右手边的筷子是：&quot;</span></span> <span class="token operator">+</span> it<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    philosopherList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">DeadlockDetector</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从日志输出可以看出来，<strong>线程 Philosopher-4</strong> 在收到中断请求时释放了其持有的资源，但很快又发生了死锁，因为<strong>线程 Philosopher-4</strong> 释放的资源可以由所有需要的线程进行抢夺，可能在 <strong>线程 Philosopher-4</strong> 刚释放了持有的资源时又马上自己抢占到了该资源。最极端的情况就是：每次收到中断的线程均释放了其持有的资源，但随后又马上自己抢占到了该资源，接着该线程（或者其它线程）又收到中断请求，又释放持有的资源，又自己抢占到该资源……如此循环往复。这种情况下所有线程依然无法获得依赖的目标资源，反而由于反复的锁申请和锁释放操作造成多次的线程上下文切换。且释放锁可能会导致线程之前的任务被无效化。所以说，死锁的恢复实际意义不大</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>Philosopher<span class="token operator">-</span><span class="token number">0</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 左手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> 右手边的筷子是：<span class="token function">Chopstick</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">3</span>
java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InterruptedException
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">doAcquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">898</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>ReentrantLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span>ReentrantLock<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>放弃等待右边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>放下已持有的左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">1</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">1</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">2</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">2</span>
Philosopher<span class="token operator">-</span><span class="token number">3</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">3</span>
java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InterruptedException
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">doAcquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">898</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>ReentrantLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span>ReentrantLock<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>放弃等待右边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>放下已持有的左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InterruptedException
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">doAcquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">898</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>ReentrantLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span>ReentrantLock<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>放弃等待右边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>放下已持有的左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了右边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 开始吃饭<span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 吃饭结束<span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span><span class="token operator">!!</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">0</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">0</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InterruptedException
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">doAcquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">898</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span>AbstractQueuedSynchronizer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">)</span>
at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>ReentrantLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span>ReentrantLock<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
at thread<span class="token punctuation">.</span>Philosopher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DeadLockDemo<span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>放弃等待右边的筷子<span class="token operator">:</span> <span class="token number">3</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> <span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>放下已持有的左边的筷子<span class="token operator">:</span> <span class="token number">4</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 思考中<span class="token operator">..</span><span class="token operator">..</span>
Philosopher<span class="token operator">-</span><span class="token number">4</span> 拿起了左边的筷子<span class="token operator">:</span> <span class="token number">4</span>


····
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="五、锁死" tabindex="-1"><a class="header-anchor" href="#五、锁死" aria-hidden="true">#</a> 五、锁死</h1><p>等待线程由于唤醒其所需的条件永远无法成立，或者是其它线程无法唤醒这个线程导致其一直处于非运行状态（线程并未终止）从而任务一直取得进展，那么我们称这个线程被锁死</p><p>锁死和死锁之间有着共同的外在表现：故障线程一直处于非运行状态而使得其任务无法进展。死锁针对的是多个线程，而锁死可能只是作用在一个线程上。例如，一个调用了 <code>Object.wait()</code> 处于等待状态的线程，由于发生异常或者是代码缺陷，导致一直没有外部线程调用 <code>Object.notify()</code> 方法来唤醒等待线程，使得线程一直处于等待状态无法运行，此时就可以说该线程被锁死</p><p>锁死和死锁的产生条件是不同的，即便是在产生死锁的所有必要条件都不成立的情况下（此时死锁不可能发生），锁死仍可能出现。因此应对死锁的办法未必能够用来避免锁死现象的发生。按照锁死产生的条件来分，锁死包括信号丢失锁死和嵌套监视器锁死</p><h2 id="_1、信号丢失锁死" tabindex="-1"><a class="header-anchor" href="#_1、信号丢失锁死" aria-hidden="true">#</a> 1、信号丢失锁死</h2><p>信号丢失锁死是由于没有相应的通知线程来唤醒等待线程而使等待线程一直处于等待状态的一种活性故障</p><p>例如，某个等待线程在执行 <code>Object.wait()</code> 前没有对保护条件进行判断，而此时保护条件实际上已经成立了，然而此后可能并无其他线程会来唤醒等待线程，因为在等待线程获得 Object 内部锁之前保护条件已经是处于成立状态了，这就使得等待线程一直处于等待状态，其任务一直无法取得进展</p><p>信号丢失锁死的另外一个常见例子是由于 <code>CountDownLatch.countDown()</code> 没有放在 <strong>finally</strong> 块中，而如果 <code>CountDownLatch.countDown()</code> 的执行线程运行时抛出未捕获的异常时， <code>CountDownLatch.await()</code> 的执行线程就会一直处于等待状态从而任务一直无法取得进展</p><p>例如，对于以下代码，当 ServiceB 抛出异常时，main 线程就会由于一直无法收到唤醒通知从而一直处于等待状态</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">/**
 * @Author: leavesCZY
 * @Github：https://github.com/leavesCZY
 */</span>
<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> serviceManager <span class="token operator">=</span> <span class="token function">ServicesManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serviceManager<span class="token punctuation">.</span><span class="token function">startServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;等待所有 Services 执行完毕&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> allSuccess <span class="token operator">=</span> serviceManager<span class="token punctuation">.</span><span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;执行结果： </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">allSuccess</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> ServicesManager <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> countDownLatch <span class="token operator">=</span> <span class="token function">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> serviceList <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>AbstractService<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        serviceList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ServiceA</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;ServiceA&quot;</span></span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span>
        serviceList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ServiceB</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;ServiceB&quot;</span></span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">startServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serviceList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
            it<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> serviceList<span class="token punctuation">.</span><span class="token function">find</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it<span class="token punctuation">.</span><span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token function">AbstractService</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> countDownLatch<span class="token operator">:</span> CountDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> success <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">doTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean

    <span class="token keyword">fun</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thread <span class="token punctuation">{</span>
<span class="token comment">//            try {</span>
<span class="token comment">//                success = doTask()</span>
<span class="token comment">//            } finally {</span>
<span class="token comment">//                countDownLatch.countDown()</span>
<span class="token comment">//            }</span>
            success <span class="token operator">=</span> <span class="token function">doTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword">return</span> success
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token function">ServiceA</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> serviceName<span class="token operator">:</span> String<span class="token punctuation">,</span> countDownLatch<span class="token operator">:</span> CountDownLatch<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">AbstractService</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">serviceName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">执行完毕&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token function">ServiceB</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> serviceName<span class="token operator">:</span> String<span class="token punctuation">,</span> countDownLatch<span class="token operator">:</span> CountDownLatch<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">AbstractService</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Random<span class="token punctuation">.</span><span class="token function">nextBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span>  <span class="token function">RuntimeException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">serviceName</span></span><span class="token string"> failed&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">serviceName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">执行完毕&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2、嵌套监视器锁死" tabindex="-1"><a class="header-anchor" href="#_2、嵌套监视器锁死" aria-hidden="true">#</a> 2、嵌套监视器锁死</h2><p>嵌套监视器锁死是嵌套锁导致等待线程永远无法被唤醒的一种活性故障</p><p>来看以下伪代码。假设存在一个等待线程，其先后持有了 monitorX 和 monitorY 两个不同的锁，当等待线程监测到当前执行条件不成立时，调用了 <code>monitorY.wait()</code> 等待通知线程来唤醒自身，并同时释放了锁 monitorY</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token function">synchronized</span><span class="token punctuation">(</span>monitorX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token function">synchronized</span><span class="token punctuation">(</span>monitorY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>somethingOk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            monitorY<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//执行目标行为</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相应的通知线程其伪代码如下所示。通知线程需要持有了 monitorX 和 monitorY 两个锁才能执行到 <code>monitorY.notifyAll()</code> 这行代码来唤醒等待线程。而等待线程执行 <code>monitorY.wait()</code> 时仅会释放 monitorY，而不会释放 monitorX。这使得通知线程由于一直获得 monitorX， 从而导致等待线程一直无法被唤醒而一直处于 BLOCKED 状态</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token function">synchronized</span><span class="token punctuation">(</span>monitorX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token function">synchronized</span><span class="token punctuation">(</span>monitorY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
        somethingOk <span class="token operator">=</span> <span class="token boolean">true</span>
        monitorY<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种由于嵌套锁导致通知线程始终无法唤醒等待线程的活性故障就被称为嵌套监视器锁死</p><h1 id="六、线程饥饿" tabindex="-1"><a class="header-anchor" href="#六、线程饥饿" aria-hidden="true">#</a> 六、线程饥饿</h1><p>线程饥饿是指线程一直无法获得所需资源从而导致任务无法取得进展的一种活性故障现象</p><p>产生线程饥饿的一种情况是：线程一直没有被分配到处理器时间片。这种情况一般是由于处理器时间片一直被高优先级的线程抢占，低优先级的线程一直无法获得运行机会，此时即发生了线程饥饿现象。<code>Thread</code> 类提供了修改线程优先级的成员方法<code>setPriority(Int)</code>，定义了整数一到十之间的十个优先级级别。不同的操作系统会有不同的线程优先级等级，JVM 会把这 Thread 类的十个优先级级别映射到具体的操作系统所定义的线程优先级关系上。但是我们所设置的线程优先级对线程调度器来说只是一个建议，当我们将一个线程设置为高优先级时，既可能会被线程调度器忽略，也可能会使该线程过度优先执行而别的线程一直得不到处理器时间片，从而导致线程饥饿。因此我们应该尽量避免修改线程的优先级</p><p>把锁看做一种资源，那么死锁也是一种线程饥饿。死锁的结果是所有故障线程都无法获得其所需的全部锁，从而使得其任务一直无法取得进展，这就相当于线程无法获得所需的全部资源从而导致任务无法取得进展，即产生了线程饥饿</p><p>发生线程饥饿并不一定同时存在死锁。因为线程饥饿可能只发生在一个线程上（例如上述的低优先级线程无法获得时间片），且即使是同时发生在多个线程上，也可能并不满足死锁发生的必要条件之一：循环等待资源，因为此时涉及到的多个线程所等待的资源可能并没有相互依赖关系</p><h1 id="七、活锁" tabindex="-1"><a class="header-anchor" href="#七、活锁" aria-hidden="true">#</a> 七、活锁</h1><p>活锁指的是任务和任务的执行线程均没有被阻塞，但由于某些条件没有满足，导致线程一直在重复<strong>尝试—失败—尝试</strong>的过程，任务一直无法取得进展。也就是说，产生活锁的线程虽然处于 Runnable 状态，但是一直在做无用功</p><p>例如，对于上述的哲学家问题，假设某位哲学家“<strong>比较有礼貌</strong>”，当其拿起了左手边的筷子时，如果恰好有其他哲学家需要这根筷子，<strong>有礼貌的哲学家</strong>就主动放下筷子，让给其他哲学家使用。在最极端的情况下，每当有礼貌的哲学家一想要吃饭并拿起左手边的筷子时，就有其他哲学家需要这根筷子，此时有礼貌的哲学就会一直处于<strong>拿起筷子-放下筷子-拿起筷子</strong>这样一个循环过程中，导致一直无法吃饭。此时并没有发生死锁，但对于有礼貌的哲学家所代表的线程来说就是发生了活锁</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/hqqich/hqqich.github.io/edit/main/src/md/kotlin/Java 多线程开发（3）线程活性故障有哪些.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a aria-label="Java 多线程开发（2）怎么实现多线程同步" class="vp-link nav-link prev nav-link prev" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%882%EF%BC%89%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>Java 多线程开发（2）怎么实现多线程同步</div></a><a aria-label="Java 多线程开发（4）锁的分类有这么多" class="vp-link nav-link next nav-link next" href="/blog/dist/md/kotlin/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91%EF%BC%884%EF%BC%89%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB%E6%9C%89%E8%BF%99%E4%B9%88%E5%A4%9A.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Java 多线程开发（4）锁的分类有这么多<span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">hqqich</div><div class="vp-copyright">Copyright © 2024 hqqich</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/blog/dist/assets/app-6847d3e4.js" defer></script>
  </body>
</html>
