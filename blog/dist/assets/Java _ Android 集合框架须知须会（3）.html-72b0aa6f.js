import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as e,c as o,a as n,d as s,e as c,f as l}from"./app-6847d3e4.js";const i={},u={href:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image",target:"_blank",rel:"noopener noreferrer"},k=n("p",null,"å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£",-1),r=l(`<blockquote><p>æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨<strong>æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹</strong>ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£</p></blockquote><p>æœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹</p><h1 id="ä¸€ã€sparsearray" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€sparsearray" aria-hidden="true">#</a> ä¸€ã€SparseArray</h1><p>ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† <code>Map&lt;Integer,Object&gt;</code> ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼š<code>Use new SparseArray&lt;Object&gt;(...) instead for better performance ...</code>ï¼Œå³<strong>ç”¨ SparseArray&lt; Object &gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap</strong></p><p>è¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿</p><h2 id="_1ã€åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1ã€åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> 1ã€åŸºæœ¬æ¦‚å¿µ</h2><p>SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sparseArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sparseArray<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;leavesC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sparseArray<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sparseArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sparseArray<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SparseArray&lt; E &gt; ç›¸å½“äº Map&lt; Integer , E &gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼š<code>int[] mKeys ; Object[] mValues</code></p><p>mKeys å’Œ mValues æŒ‰ç…§å¦‚ä¸‹è§„åˆ™å¯¹åº”èµ·æ¥ï¼š</p><ul><li>å‡è®¾è¦å‘ SparseArray å­˜å…¥ key ä¸º 10ï¼Œvalue ä¸º 200 çš„é”®å€¼å¯¹ï¼Œåˆ™å…ˆå°† 10 å­˜åˆ° mKeys ä¸­ï¼Œå‡è®¾ 10 åœ¨ mKeys ä¸­å¯¹åº”çš„ç´¢å¼•å€¼æ˜¯ 2ï¼Œåˆ™å°† value å­˜å…¥ mValues[2] ä¸­</li><li>mKeys ä¸­çš„å…ƒç´ å€¼æŒ‰ç…§é€’å¢çš„æ–¹æ³•è¿›è¡Œå­˜å‚¨ï¼Œæ¯æ¬¡å­˜æ”¾æ–°çš„é”®å€¼å¯¹æ—¶éƒ½é€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼å°† key æ’å…¥åˆ° mKeys ä¸­</li><li>å½“è¦ä» SparseArray å–å€¼æ—¶ï¼Œå…ˆé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•æ‰¾åˆ° key åœ¨ mKeys ä¸­å¯¹åº”çš„ç´¢å¼•ï¼Œç„¶åæ ¹æ®è¯¥ç´¢å¼•ä» mValues ä¸­å–å€¼</li></ul><p>ä»ä»¥ä¸Šå¯ä»¥çœ‹å‡ºæ¥çš„ä¸€ç‚¹å°±æ˜¯ï¼šSparseArray é¿å…äº† HashMap æ¯æ¬¡å­˜å–å€¼æ—¶çš„è£…ç®±æ‹†ç®±æ“ä½œï¼Œkey å€¼ä¿æŒä¸ºåŸºæœ¬æ•°æ®ç±»å‹ intï¼Œå‡å°‘äº†æ€§èƒ½å¼€é”€</p><h2 id="_2ã€ç±»å£°æ˜" tabindex="-1"><a class="header-anchor" href="#_2ã€ç±»å£°æ˜" aria-hidden="true">#</a> 2ã€ç±»å£°æ˜</h2><p>SparseArray æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥ç»§æ‰¿äºä»»ä½•ç±»ï¼Œå†…éƒ¨ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ° Java åŸç”Ÿçš„é›†åˆæ¡†æ¶ï¼Œæ‰€ä»¥ SparseArray æ˜¯ Android ç³»ç»Ÿè‡ªå·±å®ç°çš„ä¸€ä¸ªé›†åˆå®¹å™¨ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3ã€å…¨å±€å˜é‡" tabindex="-1"><a class="header-anchor" href="#_3ã€å…¨å±€å˜é‡" aria-hidden="true">#</a> 3ã€å…¨å±€å˜é‡</h2><p><code>mGarbage</code> æ˜¯ SparseArray çš„ä¸€ä¸ªä¼˜åŒ–ç‚¹ä¹‹ä¸€ï¼Œç”¨äºæ ‡è®°<strong>å½“å‰æ˜¯å¦æœ‰éœ€è¦åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </strong>ï¼Œå½“è¯¥å€¼è¢«ç½®ä¸º true æ—¶ï¼Œæ„å‘³ç€å½“å‰å­˜åœ¨æ— æ•ˆå…ƒç´ ï¼Œéœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä½†å›æ”¶æ“ä½œå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œï¼Œè€Œæ˜¯åœ¨åç»­æ“ä½œä¸­å†ç»Ÿä¸€è¿›è¡Œ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//é”®å€¼å¯¹è¢«ç§»é™¤åå¯¹åº”çš„ value ä¼šå˜æˆæ­¤å€¼ï¼Œç”¨æ¥å½“åš GC æ ‡è®°ä½</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token constant">DELETED</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ç”¨äºæ ‡è®°å½“å‰æ˜¯å¦æœ‰å¾…åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> mGarbage <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mKeys<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mValues<span class="token punctuation">;</span>

<span class="token comment">//å½“å‰é›†åˆå…ƒç´ çš„æ•°é‡</span>
<span class="token comment">//è¯¥å€¼å¹¶ä¸ä¸€å®šæ˜¯æ—¶æ—¶å¤„äºæ­£ç¡®çŠ¶æ€ï¼Œå› ä¸ºæœ‰å¯èƒ½å‡ºç°åªåˆ é™¤ key å’Œ value ä¸¤è€…ä¹‹ä¸€çš„æƒ…å†µ</span>
<span class="token comment">//æ‰€ä»¥ size() æ–¹æ³•å†…éƒ½ä¼šå…ˆè¿›è¡Œ GC</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> mSize<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4ã€æ„é€ å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4ã€æ„é€ å‡½æ•°" aria-hidden="true">#</a> 4ã€æ„é€ å‡½æ•°</h2><p>key æ•°ç»„å’Œ value æ•°ç»„çš„é»˜è®¤å¤§å°éƒ½æ˜¯ 10ï¼Œå¦‚æœåœ¨åˆå§‹åŒ–æ—¶å·²çŸ¥æœ€ç»ˆæ•°æ®é‡çš„å¤§å°ï¼Œåˆ™å¯ä»¥ç›´æ¥æŒ‡å®šåˆå§‹å®¹é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…åç»­çš„æ‰©å®¹æ“ä½œ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//è®¾ç½®æ•°ç»„çš„é»˜è®¤åˆå§‹å®¹é‡ä¸º10</span>
<span class="token keyword">public</span> <span class="token class-name">SparseArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">SparseArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mKeys <span class="token operator">=</span> <span class="token class-name">EmptyArray</span><span class="token punctuation">.</span><span class="token constant">INT</span><span class="token punctuation">;</span>
        mValues <span class="token operator">=</span> <span class="token class-name">EmptyArray</span><span class="token punctuation">.</span><span class="token constant">OBJECT</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mValues <span class="token operator">=</span> <span class="token class-name">ArrayUtils</span><span class="token punctuation">.</span><span class="token function">newUnpaddedObjectArray</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mKeys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>mValues<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5ã€æ·»åŠ å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_5ã€æ·»åŠ å…ƒç´ " aria-hidden="true">#</a> 5ã€æ·»åŠ å…ƒç´ </h2><p>æ·»åŠ å…ƒç´ çš„æ–¹æ³•æœ‰å‡ ä¸ªï¼Œä¸»è¦çœ‹ <code>put(int key, E value)</code> æ–¹æ³•å°±å¯ä»¥ï¼Œè¯¥æ–¹æ³•ç”¨äºå­˜å…¥ key å’Œ value ç»„æˆçš„é”®å€¼å¯¹</p><p>æŒ‰ç…§å‰é¢æ‰€è¯´çš„ SparseArray å­˜å‚¨é”®å€¼å¯¹çš„è§„åˆ™ï¼Œ<code>put</code> æ–¹æ³•ä¼šå…ˆåˆ¤æ–­å½“å‰ mKeys ä¸­æ˜¯å¦å·²ç»æœ‰ç›¸åŒçš„ key å€¼ï¼Œæœ‰çš„è¯å°±ç”¨ value è¦†ç›– mValues ä¸­çš„æ—§å€¼ã€‚å¦‚æœä¸å­˜åœ¨ç›¸åŒ key å€¼ï¼Œåœ¨å°† key æ’å…¥åˆ° mKeys åéœ€è¦åœ¨ mValues çš„ç›¸åŒç´¢å¼•ä½ç½®æ’å…¥ valueã€‚ç”±äº mKeys æ˜¯æŒ‰ç…§å¤§å°å¯¹å…ƒç´ å€¼è¿›è¡Œæ’åºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å°† key æ’å…¥åˆ° mKeys å¯èƒ½ä¼šå¯¼è‡´å…ƒç´ é‡æ–°æ’åºï¼Œä»è€Œè¿é”å¯¼è‡´ mValues ä¹Ÿéœ€è¦é‡æ–°æ’åº</p><p><code>put</code> æ–¹æ³•ä» mKeys æŸ¥æ‰¾ key ç”¨çš„æ˜¯ ContainerHelpers ç±»æä¾›çš„äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•ï¼š<code>binarySearch</code>ï¼Œç”¨äºè·å– key åœ¨ mKeys ä¸­çš„å½“å‰ç´¢å¼•ï¼ˆå­˜åœ¨è¯¥ key çš„è¯ï¼‰æˆ–è€…æ˜¯åº”è¯¥å­˜æ”¾çš„ä½ç½®çš„ç´¢å¼•ï¼ˆä¸å­˜åœ¨è¯¥ keyï¼‰ï¼Œæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœ mKeys ä¸­å­˜åœ¨å¯¹åº”çš„ keyï¼Œåˆ™ç›´æ¥è¿”å›å¯¹åº”çš„ç´¢å¼•å€¼</li><li>å¦‚æœ mKeys ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ key <ol><li>å‡è®¾ mKeys ä¸­å­˜åœ¨&quot;å€¼æ¯” key å¤§ä¸”å¤§å°ä¸ key æœ€æ¥è¿‘çš„å€¼çš„ç´¢å¼•&quot;ä¸º presentIndexï¼Œåˆ™æ­¤æ–¹æ³•çš„è¿”å›å€¼ä¸º ~presentIndex</li><li>å¦‚æœ mKeys ä¸­ä¸å­˜åœ¨æ¯” key è¿˜è¦å¤§çš„å€¼çš„è¯ï¼Œåˆ™è¿”å›å€¼ä¸º ~mKeys.length</li></ol></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// This is Arrays.binarySearch(), but doesn&#39;t do any argument validation.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> lo <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hi <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>lo <span class="token operator">&lt;=</span> hi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>lo <span class="token operator">+</span> hi<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> midVal <span class="token operator">=</span> array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>midVal <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lo <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>midVal <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hi <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>  <span class="token comment">// value found</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">~</span>lo<span class="token punctuation">;</span>  <span class="token comment">// value not present</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ mKeys å­˜åœ¨ç›®æ ‡ keyï¼Œé‚£ä¹ˆè¿”å›å€¼å³å¯¹åº”çš„ç´¢å¼•ä½ç½®ã€‚å¦‚æœä¸å­˜åœ¨ç›®æ ‡ keyï¼Œå…¶è¿”å›å€¼ä¹ŸæŒ‡å‘äº†åº”è¯¥è®© key å­˜å…¥çš„ä½ç½®ï¼Œå› ä¸ºå½“ä¸å­˜åœ¨ç›®æ ‡ key æ—¶ï¼Œå°†è®¡ç®—å‡ºçš„ç´¢å¼•å€¼è¿›è¡Œ ~ è¿ç®—åè¿”å›å€¼ä¸€å®šæ˜¯è´Ÿæ•°ï¼Œä»è€Œä¸â€œæ‰¾å¾—åˆ°ç›®æ ‡ key çš„æƒ…å†µï¼ˆè¿”å›å€¼å¤§äºç­‰äº0ï¼‰â€çš„æƒ…å†µåŒºåˆ†å¼€ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºè¯¥æ–¹æ³•çš„å·§å¦™ä¹‹å¤„ï¼Œå•çº¯çš„ä¸€ä¸ªè¿”å›å€¼å°±å¯ä»¥åŒºåˆ†å‡ºå¤šç§æƒ…å†µï¼Œä¸”é€šè¿‡è¿™ç§æ–¹å¼æ¥å­˜æ”¾æ•°æ®å¯ä»¥ä½¿å¾— mKeys çš„å†…éƒ¨å€¼ä¸€ç›´æ˜¯æŒ‰ç…§å€¼é€’å¢çš„æ–¹å¼æ¥æ’åºçš„</p><p>å†æ¥å…·ä½“çœ‹çœ‹ put æ–¹æ³•çš„é€»è¾‘</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token class-name">E</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//å¯¹åº”å·²ç»å­˜åœ¨ç›¸åŒ key çš„æƒ…å†µ</span>
        mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//å–åï¼Œæ‹¿åˆ°çœŸå®çš„ç´¢å¼•ä½ç½®</span>
        i <span class="token operator">=</span> <span class="token operator">~</span>i<span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœç›®æ ‡ä½ç½®è¿˜æœªèµ‹å€¼ï¼Œåˆ™ç›´æ¥å­˜å…¥æ•°æ®å³å¯</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> mSize <span class="token operator">&amp;&amp;</span> mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
            mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å¦‚æœå­˜åœ¨å†—ä½™æ•°æ®ï¼Œé‚£ä¹ˆå°±å…ˆè¿›è¡Œ GC</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage <span class="token operator">&amp;&amp;</span> mSize <span class="token operator">&gt;=</span> mKeys<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//GC åå†æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œå› ä¸ºå€¼å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–äº†</span>
            i <span class="token operator">=</span> <span class="token operator">~</span><span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç´¢å¼• i ä½ç½®å·²ç»ç”¨äºå­˜å‚¨å…¶å®ƒæ•°æ®äº†ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œè¿ç§»</span>
        <span class="token comment">//æ‰€ä»¥ä»ç´¢å¼• i å¼€å§‹çš„æ‰€æœ‰æ•°æ®éƒ½éœ€è¦å‘åç§»åŠ¨ä¸€ä½ï¼Œå¹¶å°† key å­˜åˆ° mKeys[i]</span>
        mKeys <span class="token operator">=</span> <span class="token class-name">GrowingArrayUtils</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> i<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mValues <span class="token operator">=</span> <span class="token class-name">GrowingArrayUtils</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mValues<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> i<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mSize<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//å°†ç´¢å¼• index å¤„çš„å…ƒç´ èµ‹å€¼ä¸º value</span>
<span class="token comment">//çŸ¥é“ç›®æ ‡ä½ç½®çš„è¯å¯ä»¥ç›´æ¥å‘ mValues èµ‹å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValueAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> mSize <span class="token operator">&amp;&amp;</span> <span class="token class-name">UtilConfig</span><span class="token punctuation">.</span>sThrowExceptionForUpperArrayOutOfBounds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// The array might be slightly bigger than mSize, in which case, indexing won&#39;t fail.</span>
        <span class="token comment">// Check if exception should be thrown outside of the critical path.</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¦‚æœéœ€è¦åˆ™å…ˆè¿›è¡Œåƒåœ¾å›æ”¶</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mValues<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//å’Œ put æ–¹æ³•ç±»ä¼¼</span>
<span class="token comment">//ä½†åœ¨å­˜å…¥æ•°æ®å‰å…ˆå¯¹æ•°æ®å¤§å°è¿›è¡Œäº†åˆ¤æ–­ï¼Œæœ‰åˆ©äºå‡å°‘å¯¹ mKeys è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾çš„æ¬¡æ•°</span>
<span class="token comment">//æ‰€ä»¥åœ¨â€œå­˜å…¥çš„ key æ¯”ç°æœ‰çš„ mKeys å€¼éƒ½å¤§â€çš„æƒ…å†µä¸‹ä¼šæ¯” put æ–¹æ³•æ€§èƒ½é«˜</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token class-name">E</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mSize <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">&lt;=</span> mKeys<span class="token punctuation">[</span>mSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage <span class="token operator">&amp;&amp;</span> mSize <span class="token operator">&gt;=</span> mKeys<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mKeys <span class="token operator">=</span> <span class="token class-name">GrowingArrayUtils</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mValues <span class="token operator">=</span> <span class="token class-name">GrowingArrayUtils</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>mValues<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mSize<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6ã€ç§»é™¤å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_6ã€ç§»é™¤å…ƒç´ " aria-hidden="true">#</a> 6ã€ç§»é™¤å…ƒç´ </h2><p>ä¸Šæ–‡è¯´äº†ï¼Œå¸ƒå°”å˜é‡ <code>mGarbage</code> ç”¨äºæ ‡è®°<strong>å½“å‰æ˜¯å¦æœ‰å¾…åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </strong>ï¼Œå½“è¯¥å€¼è¢«ç½®ä¸º true æ—¶ï¼Œå³æ„å‘³ç€<strong>å½“å‰çŠ¶æ€éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä½†å›æ”¶æ“ä½œå¹¶ä¸é©¬ä¸Šè¿›è¡Œï¼Œè€Œæ˜¯åœ¨åç»­æ“ä½œä¸­å†å®Œæˆ</strong></p><p>ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•åœ¨ç§»é™¤å…ƒç´ æ—¶ï¼Œéƒ½åªæ˜¯åˆ‡æ–­äº† mValues å¯¹ value çš„å¼•ç”¨ï¼Œè€Œ mKeys å¹¶æ²¡æœ‰è¿›è¡Œå›æ”¶ï¼Œè¿™ä¸ªæ“ä½œä¼šç•™åˆ° <code>gc()</code> è¿›è¡Œå¤„ç†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">DELETED</span><span class="token punctuation">;</span>
            <span class="token comment">//æ ‡è®°å½“å‰éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶</span>
            mGarbage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//å’Œ delete æ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œå·®åˆ«åœ¨äºä¼šè¿”å› key å¯¹åº”çš„å…ƒç´ å€¼</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">removeReturnOld</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">E</span> old <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">DELETED</span><span class="token punctuation">;</span>
            mGarbage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> old<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ é™¤æŒ‡å®šç´¢å¼•å¯¹åº”çš„å…ƒç´ å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> mSize <span class="token operator">&amp;&amp;</span> <span class="token class-name">UtilConfig</span><span class="token punctuation">.</span>sThrowExceptionForUpperArrayOutOfBounds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// The array might be slightly bigger than mSize, in which case, indexing won&#39;t fail.</span>
        <span class="token comment">// Check if exception should be thrown outside of the critical path.</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mValues<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">DELETED</span><span class="token punctuation">;</span>
        <span class="token comment">//æ ‡è®°å½“å‰éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶</span>
        mGarbage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ é™¤ä»èµ·å§‹ç´¢å¼•å€¼ index å¼€å§‹ä¹‹åçš„ size ä¸ªå…ƒç´ å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeAtRange</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//é¿å…å‘ç”Ÿæ•°ç»„è¶Šç•Œçš„æƒ…å†µ</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> end <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>mSize<span class="token punctuation">,</span> index <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//ç§»é™¤æ‰€æœ‰å…ƒç´ å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> mValues<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    mGarbage <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7ã€æŸ¥æ‰¾å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_7ã€æŸ¥æ‰¾å…ƒç´ " aria-hidden="true">#</a> 7ã€æŸ¥æ‰¾å…ƒç´ </h2><p>æŸ¥æ‰¾å…ƒç´ çš„æ–¹æ³•è¾ƒå¤šï¼Œé€»è¾‘éƒ½æŒºç®€å•çš„</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æ ¹æ® key æŸ¥æ‰¾ç›¸åº”çš„å…ƒç´ å€¼ï¼ŒæŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å›é»˜è®¤å€¼</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token class-name">E</span> valueIfKeyNotFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¦‚æœæ‰¾ä¸åˆ°è¯¥ key æˆ–è€…è¯¥ key å°šæœªèµ‹å€¼ï¼Œåˆ™è¿”å›é»˜è®¤å€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> valueIfKeyNotFound<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ ¹æ® key æŸ¥æ‰¾ç›¸åº”çš„å…ƒç´ å€¼ï¼ŒæŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å› null</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//å› ä¸º mValues ä¸­çš„å…ƒç´ å€¼å¹¶éä¸€å®šæ˜¯è¿è´¯çš„ï¼Œæœ‰å¯èƒ½æºæ‚ç€ DELETED </span>
<span class="token comment">//æ‰€ä»¥åœ¨éå†å‰éœ€è¦å…ˆè¿›è¡Œ GCï¼Œè¿™æ ·é€šè¿‡æ•°ç»„å–å‡ºçš„å€¼æ‰æ˜¯æ­£ç¡®çš„</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">valueAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> mValues<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ ¹æ®ç´¢å¼•å€¼ index æŸ¥æ‰¾å¯¹åº”çš„ key </span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">keyAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mKeys<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ ¹æ® key å¯¹åº”çš„ç´¢å¼•å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOfKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">ContainerHelpers</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>mKeys<span class="token punctuation">,</span> mSize<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ ¹æ® value æŸ¥æ‰¾å¯¹åº”çš„ç´¢å¼•å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOfValue</span><span class="token punctuation">(</span><span class="token class-name">E</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ä¸ indexOfValue æ–¹æ³•ç±»ä¼¼ï¼Œä½† indexOfValue æ–¹æ³•æ˜¯é€šè¿‡æ¯”è¾ƒ == æ¥åˆ¤æ–­æ˜¯å¦åŒä¸ªå¯¹è±¡</span>
<span class="token comment">//è€Œæ­¤æ–¹æ³•æ˜¯é€šè¿‡ equals æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦åŒä¸ªå¯¹è±¡</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOfValueByValue</span><span class="token punctuation">(</span><span class="token class-name">E</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mGarbage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8ã€åƒåœ¾å›æ”¶" tabindex="-1"><a class="header-anchor" href="#_8ã€åƒåœ¾å›æ”¶" aria-hidden="true">#</a> 8ã€åƒåœ¾å›æ”¶</h2><p>å› ä¸º SparseArray ä¸­ä¼šå‡ºç°åªç§»é™¤ key å’Œ value ä¸¤è€…ä¹‹ä¸€çš„æƒ…å†µï¼Œå¯¼è‡´å½“å‰æ•°ç»„ä¸­çš„æœ‰æ•ˆæ•°æ®å¹¶ä¸æ˜¯å…¨éƒ½ç´§æŒ¨ç€æ’åˆ—åœ¨ä¸€èµ·çš„ï¼Œå³å­˜åœ¨æ— æ•ˆå€¼ï¼Œå› æ­¤ <code>gc()</code> æ–¹æ³•ä¼šæ ¹æ® mValues ä¸­åˆ°åº•å­˜åœ¨å¤šå°‘æœ‰æ•ˆæ•°æ®ï¼Œå°† mKeys å’Œ mValues ä¸­çš„æ•°æ®è¿›è¡Œé‡æ–°æ’åˆ—ï¼Œå°†æœ‰æ„ä¹‰çš„å…ƒç´ å€¼ç´§æŒ¨ç€æ’åºåœ¨ä¸€èµ·</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token keyword">int</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys <span class="token operator">=</span> mKeys<span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> mValues<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> val <span class="token operator">=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//val é DELETED ï¼Œè¯´æ˜è¯¥ä½ç½®å¯èƒ½éœ€è¦ç§»åŠ¨æ•°æ®</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">!=</span> <span class="token constant">DELETED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å°†ç´¢å¼• i å¤„çš„å€¼èµ‹å€¼åˆ°ç´¢å¼• o å¤„</span>
            <span class="token comment">//æ‰€ä»¥å¦‚æœ i == o ï¼Œåˆ™ä¸éœ€è¦æ‰§è¡Œä»£ç äº†</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                keys<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                values<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
                values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            o<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    mGarbage <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    mSize <span class="token operator">=</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9ã€ä¼˜åŠ£åŠ¿æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_9ã€ä¼˜åŠ£åŠ¿æ€»ç»“" aria-hidden="true">#</a> 9ã€ä¼˜åŠ£åŠ¿æ€»ç»“</h2><p>ä»ä¸Šæ–‡çš„ä»‹ç»æ¥çœ‹ï¼ŒSparseArray çš„ä¸»è¦ä¼˜åŠ¿æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>é¿å…äº†åŸºæœ¬æ•°æ®ç±»å‹ int çš„è£…ç®±æ‹†ç®±æ“ä½œ</li><li>å’Œ HashMap ä¸­æ¯ä¸ªå­˜å‚¨ç»“ç‚¹éƒ½æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ä¸åŒï¼ŒSparseArray ä¸éœ€è¦ç”¨äºåŒ…è£… key çš„ç»“æ„ä½“ï¼Œå•ä¸ªå…ƒç´ çš„å­˜å‚¨æˆæœ¬æ›´åŠ ä½å»‰</li><li>åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾æ•ˆç‡è¾ƒé«˜ï¼ˆäºŒåˆ†æŸ¥æ‰¾æ³•ï¼‰</li><li>å»¶è¿Ÿäº†åƒåœ¾å›æ”¶çš„æ—¶æœºï¼Œåªåœ¨éœ€è¦çš„æ—¶å€™æ‰ä¸€æ¬¡æ€§è¿›è¡Œ</li></ul><p>åŠ£åŠ¿æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å…·æœ‰ç‰¹å®šçš„é€‚ç”¨èŒƒå›´ï¼Œkey åªèƒ½æ˜¯ int ç±»å‹</li><li>æ’å…¥é”®å€¼å¯¹æ—¶å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡çš„æ•°ç»„å…ƒç´ </li><li>æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒæŸ¥æ‰¾æ•ˆç‡ï¼ˆäºŒåˆ†æŸ¥æ‰¾æ³•ï¼‰ä¼šæ˜æ˜¾é™ä½ï¼Œéœ€è¦ç»è¿‡å¤šæ¬¡æŠ˜åŠæŸ¥æ‰¾æ‰èƒ½å®šä½åˆ°ç›®æ ‡æ•°æ®ã€‚è€Œ HashMap åœ¨æ²¡æœ‰å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹åªéœ€è¦è¿›è¡Œä¸€æ¬¡å“ˆå¸Œè®¡ç®—å³å¯å®šä½åˆ°ç›®æ ‡å…ƒç´ ï¼Œæœ‰å“ˆå¸Œå†²çªæ—¶ä¹Ÿåªéœ€è¦å¯¹æ¯”é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ä¸Šçš„å…ƒç´ å³å¯</li></ul><h2 id="_10ã€å…³è”ç±»" tabindex="-1"><a class="header-anchor" href="#_10ã€å…³è”ç±»" aria-hidden="true">#</a> 10ã€å…³è”ç±»</h2><p>SparseArray å±äºæ³›å‹ç±»ï¼Œæ‰€ä»¥å³ä½¿ value æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ä¹Ÿä¼šè¢«è£…ç®±å’Œæ‹†ç®±ï¼Œå¦‚æœæƒ³å†çœå»è¿™ä¸€éƒ¨åˆ†å¼€é”€çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ SparseBooleanArrayã€SparseIntArray å’Œ SparseLongArray ç­‰ä¸‰ä¸ªå®¹å™¨ç±»ï¼Œè¿™ä¸‰ä¸ªå®¹å™¨çš„å®ç°åŸç†å’Œ SparseArray ç›¸åŒï¼Œä½†æ˜¯ value è¿˜æ˜¯å±äºåŸºæœ¬æ•°æ®ç±»å‹</p><p>æ­¤å¤–ï¼Œç³»ç»Ÿè¿˜æä¾›äº† LongSparseArray è¿™ä¸ªå®¹å™¨ç±»ï¼Œå…¶å®ç°åŸç†å’Œ SparseArray ç±»ä¼¼ï¼Œä½†æ˜¯ key å›ºå®šä¸º long ç±»å‹ï¼Œvalue é€šè¿‡æ³›å‹æ¥å£°æ˜ï¼Œå¯¹äºæ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒæœ‰ç”¨çš„ä¸€ç‚¹æ˜¯å¯ä»¥ç”¨æ¥æ ¹æ® viewId æ¥å­˜å‚¨ view å¯¹è±¡</p><h1 id="äºŒã€arraymap" tabindex="-1"><a class="header-anchor" href="#äºŒã€arraymap" aria-hidden="true">#</a> äºŒã€ArrayMap</h1><p>ArrayMap å±äºæ³›å‹ç±»ï¼Œç»§æ‰¿äº† Map æ¥å£ï¼Œå…¶ä½¿ç”¨æ–¹å¼å’Œ HashMap åŸºæœ¬ä¸€æ ·ï¼Œä½†åœ¨å†…éƒ¨é€»è¾‘ä¸Šæœ‰ç€å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥éœ€è¦äº†è§£å…¶å®ç°åŸç†åæ‰èƒ½æ˜ç™½ ArrayMap åˆ°åº•é€‚ç”¨äºå“ªäº›åœºæ™¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ArrayMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_1ã€å­˜å‚¨æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_1ã€å­˜å‚¨æœºåˆ¶" aria-hidden="true">#</a> 1ã€å­˜å‚¨æœºåˆ¶</h2><p>ArrayMap ä¸­åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„ã€‚mHashes ç”¨äºå­˜å‚¨é”®å€¼å¯¹ä¸­ key çš„å“ˆå¸Œå€¼ï¼ŒmArray åˆ™ç”¨äºå­˜å‚¨ key å’Œ valueï¼Œå³æ¯ä¸ªé”®å€¼å¯¹ä¼šä¸€èµ·è¢«å­˜å…¥ mArray ä¸­</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Hashes are an implementation detail. Use public key/value API.</span>
<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mHashes<span class="token punctuation">;</span>

<span class="token comment">// Storage is an implementation detail. Use public key/value API.</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mArray<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“å‘ ArrayMap æ’å…¥é”®å€¼å¯¹æ—¶ï¼Œä¼šå…ˆè®¡ç®—å‡º key çš„å“ˆå¸Œå€¼ï¼Œå°† keyHash æŒ‰ç…§å¤§å°é¡ºåºå­˜å…¥ mHashes ä¸­ï¼Œæ‹¿åˆ°å…¶ä½ç½®ç´¢å¼• indexã€‚ç„¶åå°† key å­˜å…¥ mArray çš„ index&lt;&lt;1 ä½ç½®ï¼Œå°† value å­˜å…¥ mArray çš„ (index&lt;&lt;1 + 1) ä½ç½®ï¼Œå³ key å’Œ value ä¼šå­˜å‚¨åœ¨ç›¸é‚»çš„ä½ç½®ã€‚ä»è¿™ä¸ªä½ç½®å¯¹åº”å…³ç³»æ¥çœ‹ï¼ŒmArray çš„æ‰€éœ€å®¹é‡è‡³å°‘ä¹Ÿéœ€è¦æ˜¯ mHashes çš„ä¸¤å€ï¼Œä¸”æ¯ä¸ª key-value çš„æ’åˆ—å…³ç³»ä¹Ÿæ˜¯å’Œ keyHash çš„æ’åˆ—ä¿æŒä¸€è‡´</p><p>å½“è¦é€šè¿‡ key å¯¹è±¡å‘ ArrayMap å–å€¼æ—¶ï¼Œå°±å…ˆè®¡ç®—å‡º keyHashï¼Œç„¶åé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•æ‰¾åˆ° keyHash åœ¨ mHashes ä¸­çš„ä½ç½®ç´¢å¼• indexï¼Œç„¶ååœ¨ (index&lt;&lt;1 + 1)ä½ç½®ä» mArray æ‹¿åˆ° value</p><h2 id="_2ã€æ·»åŠ å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_2ã€æ·»åŠ å…ƒç´ " aria-hidden="true">#</a> 2ã€æ·»åŠ å…ƒç´ </h2><p>æœ‰å‡ ä¸ªç”¨äºæ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œå½“ä¸­é‡ç‚¹çœ‹ <code>put</code> æ–¹æ³•å³å¯ï¼Œå…¶å®ƒæ·»åŠ å…ƒç´ çš„æ–¹æ³•éƒ½éœ€è¦ä¾é è¯¥æ–¹æ³•æ¥å®ç°ã€‚å‰æ–‡æœ‰è®²åˆ°ï¼Œkey-value æœ€ç»ˆæ˜¯ä¼šç›¸é‚»ç€å­˜å…¥ mArray ä¸­çš„ï¼Œè€Œ key-value åœ¨ mArray ä¸­çš„ä½ç½®æ˜¯ç”± keyHash å’Œ mHashes æ¥å…±åŒå†³å®šçš„ï¼Œ<code>put</code> æ–¹æ³•çš„æ•´ä½“é€»è¾‘å¦‚ä¸‹æ‰€è¿°ï¼š</p><ol><li>æ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•è·å–åˆ° keyHash åœ¨ mHashes ä¸­çš„ç´¢å¼•ä½ç½® index</li><li>å¦‚æœ index å¤§äºç­‰äº 0ï¼Œè¯´æ˜åœ¨ mArray ä¸­ key å·²å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥è¦†ç›–æ—§å€¼å³å¯ï¼Œç»“æŸæµç¨‹</li><li>å¦‚æœ index å°äº 0ï¼Œè¯´æ˜åœ¨ mArray ä¸­ key ä¸å­˜åœ¨ï¼Œ~index æ­¤æ—¶ä»£è¡¨çš„æ˜¯ keyHash æŒ‰ç…§é€’å¢é¡ºåºåº”è¯¥æ’å…¥ mHashes çš„ä½ç½®</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œéœ€è¦çš„è¯åˆ™è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœç¬¦åˆç¼“å­˜æ ‡å‡†çš„è¯ï¼Œåˆ™ä¼šç¼“å­˜æ‰©å®¹å‰çš„æ•°ç»„</li><li>å¯¹æœ€ç»ˆçš„æ•°ç»„è¿›è¡Œæ•°æ®è¿ç§»ï¼Œæ’å…¥ key-value å’Œ keyHash</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> osize <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">int</span> index<span class="token punctuation">;</span>

    <span class="token comment">//ç¬¬ä¸€æ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        index <span class="token operator">=</span> <span class="token function">indexOfNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        hash <span class="token operator">=</span> mIdentityHashCode <span class="token operator">?</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">identityHashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        index <span class="token operator">=</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç¬¬äºŒæ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index <span class="token operator">=</span> <span class="token punctuation">(</span>index<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">V</span> old <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span>mArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        mArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">return</span> old<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç¬¬ä¸‰æ­¥</span>
    index <span class="token operator">=</span> <span class="token operator">~</span>index<span class="token punctuation">;</span>

    <span class="token comment">//ç¬¬å››æ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> mHashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ArrayMap çš„æ‰©å®¹æœºåˆ¶ç›¸æ¯” HashMap ä¼šæ¯”è¾ƒå…‹åˆ¶</span>
        <span class="token comment">//å½“æ•°ç»„é•¿åº¦å·²è¶…å‡º BASE_SIZE*2 åï¼Œæ•°ç»„å®¹é‡æŒ‰ç…§ 1.5 å€æ¥æ‰©å®¹</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> n <span class="token operator">=</span> osize <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>osize<span class="token operator">+</span><span class="token punctuation">(</span>osize<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> <span class="token constant">BASE_SIZE</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">BASE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: grow from &quot;</span> <span class="token operator">+</span> mHashes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ohashes <span class="token operator">=</span> mHashes<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oarray <span class="token operator">=</span> mArray<span class="token punctuation">;</span>
        <span class="token function">allocArrays</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONCURRENT_MODIFICATION_EXCEPTIONS</span> <span class="token operator">&amp;&amp;</span> osize <span class="token operator">!=</span> mSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mHashes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: copy 0-&quot;</span> <span class="token operator">+</span> osize <span class="token operator">+</span> <span class="token string">&quot; to 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>ohashes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mHashes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ohashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>oarray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mArray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oarray<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">freeArrays</span><span class="token punctuation">(</span>ohashes<span class="token punctuation">,</span> oarray<span class="token punctuation">,</span> osize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç¬¬äº”æ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> osize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: move &quot;</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>osize<span class="token operator">-</span>index<span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>mHashes<span class="token punctuation">,</span> index<span class="token punctuation">,</span> mHashes<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> osize <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>mArray<span class="token punctuation">,</span> index <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> mArray<span class="token punctuation">,</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>mSize <span class="token operator">-</span> index<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONCURRENT_MODIFICATION_EXCEPTIONS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>osize <span class="token operator">!=</span> mSize <span class="token operator">||</span> index <span class="token operator">&gt;=</span> mHashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    mHashes<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">;</span>
    mArray<span class="token punctuation">[</span>index<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
    mArray<span class="token punctuation">[</span><span class="token punctuation">(</span>index<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    mSize<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>append</code> æ–¹æ³•ä¹Ÿæ˜¯ç”¨äºæ·»åŠ å…ƒç´ çš„ï¼Œå¸¦æœ‰ä¸€ç‚¹â€œè¿½åŠ â€çš„æ„æ€ï¼Œå¦‚æœå¤–éƒ¨å¯ä»¥ç¡®å®šæœ¬æ¬¡æ’å…¥çš„ key çš„ hash å€¼æ¯”å½“å‰æ‰€æœ‰å·²æœ‰å€¼éƒ½å¤§çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å‘ mHashes çš„å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œä»è€ŒèŠ‚çœäº†äºŒåˆ†æŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚æ‰€ä»¥ <code>append</code> æ–¹æ³•ä¼šå…ˆå’Œ mHashes çš„æœ€åä¸€ä¸ªå…ƒç´ å€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœ keyHash æ¯”è¯¥å€¼å¤§çš„è¯å°±è¯´æ˜å¯ä»¥ç›´æ¥ä¿å­˜åˆ°å°¾éƒ¨ï¼Œæ ¡éªŒä¸é€šè¿‡çš„è¯è¿˜æ˜¯ä¼šè°ƒç”¨ <code>put</code> æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> index <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash <span class="token operator">=</span> key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span>
            <span class="token operator">:</span> <span class="token punctuation">(</span>mIdentityHashCode <span class="token operator">?</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">identityHashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> mHashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Array is full&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¦‚æœ mHashes å½“å‰çš„æœ€åä¸€ä¸ªå€¼æ¯” hash å¤§ï¼Œhash æ²¡æ³•ç›´æ¥æ’åˆ°å°¾éƒ¨ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯éœ€è¦è°ƒç”¨ put æ–¹æ³•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mHashes<span class="token punctuation">[</span>index<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">fillInStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;New hash &quot;</span> <span class="token operator">+</span> hash
                <span class="token operator">+</span> <span class="token string">&quot; is before end of array hash &quot;</span> <span class="token operator">+</span> mHashes<span class="token punctuation">[</span>index<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token operator">+</span> <span class="token string">&quot; at index &quot;</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">&quot; key &quot;</span> <span class="token operator">+</span> key<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å°† key-value ç›´æ¥æ’å…¥åˆ°æ•°ç»„å°¾éƒ¨</span>
    mSize <span class="token operator">=</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    mHashes<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">;</span>
    index <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    mArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
    mArray<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3ã€è·å–å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_3ã€è·å–å…ƒç´ " aria-hidden="true">#</a> 3ã€è·å–å…ƒç´ </h2><p>è·å–å…ƒç´ çš„æ–¹æ³•ä¸»è¦çœ‹ <code>indexOf(Object key, int hash)</code>æ–¹æ³•å³å¯ï¼Œåªè¦ç†è§£äº†è¯¥æ–¹æ³•æ˜¯å¦‚ä½•è·å– keyIndex çš„ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿå¯¹ ArrayMap çš„å­˜å‚¨ç»“æ„æœ‰æ›´æ˜ç¡®çš„è®¤çŸ¥</p><p><code>indexOf</code> æ–¹æ³•ç”¨äºè·å–å’Œ keyï¼Œhash å‡èƒ½å¯¹åº”ä¸Šçš„å…ƒç´ çš„å“ˆå¸Œå€¼åœ¨ mHashes ä¸­çš„ç´¢å¼•ä½ç½®ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒkeyHash æ˜¯å­˜å‚¨åœ¨ mHashes ä¸­çš„ï¼Œè€Œ key-value åˆæ˜¯å­˜å‚¨åœ¨ mArray ä¸­çš„ï¼Œä½†æˆ‘ä»¬æ— æ³•åªæ ¹æ® keyHash å°±å‡†ç¡®å¯¹åº”ä¸Š key-valueï¼Œå› ä¸ºä¸åŒçš„ key æœ‰å¯èƒ½æœ‰ç›¸åŒçš„ hash å€¼ï¼Œå³éœ€è¦è€ƒè™‘å“ˆå¸Œå†²çªçš„æƒ…å†µï¼Œæ‰€ä»¥ <code>indexOf</code> æ–¹æ³•é™¤äº†éœ€è¦å¯¹æ¯” hash å€¼å¤§å°æ˜¯å¦ç›¸ç­‰å¤–è¿˜éœ€è¦å¯¹æ¯” key çš„ç›¸ç­‰æ€§</p><ol><li>é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•è·å–åˆ° mHashes ä¸­å’Œ hash ç›¸ç­‰çš„å€¼çš„ç´¢å¼• index</li><li>å¦‚æœ index å°äº 0ï¼Œè¯´æ˜ä¸å­˜åœ¨è¯¥ keyï¼Œé‚£ä¹ˆå°±è¿”å› indexï¼Œ~index å°±æ˜¯ hash æ’å…¥ mHashes åçš„ä½ç½®ç´¢å¼•ã€‚ç»“æŸæµç¨‹</li><li>index å¤§äºç­‰äº 0ï¼Œè¯´æ˜ key æœ‰å¯èƒ½å­˜åœ¨ï¼Œä¹‹æ‰€ä»¥è¯´å¯èƒ½ï¼Œå› ä¸ºå­˜åœ¨ key ä¸åŒä½† hash å€¼ç›¸ç­‰çš„æƒ…å†µ</li><li>åˆ¤æ–­ mArray ä¸­ index&lt;&lt;1 ä½ç½®çš„å…ƒç´ æ˜¯å¦å’Œ key ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰è¯´æ˜å·²ç»æ‰¾åˆ°äº†ç›®æ ‡ä½ç½®ï¼Œè¿”å› indexã€‚ç»“æŸæµç¨‹</li><li>æ­¤æ—¶å¯ä»¥ç¡®å®šå‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹ mArray è¿›è¡Œç›¸ç­‰æ€§å¯¹æ¯”äº†ï¼Œè€Œä¹‹æ‰€ä»¥è¦åˆ†ä¸ºä¸¤ä¸ª for å¾ªç¯ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘éå†æ¬¡æ•°ï¼Œå› ä¸ºç›¸åŒ hash å€¼æ˜¯ä¼šé æ‹¢åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥åˆ†åˆ«å‘ä¸¤ä¾§è¿›è¡Œéå†æŸ¥æ‰¾ã€‚å¦‚æœ key å’Œ keyHash çš„ç›¸ç­‰æ€§å‡æ ¡éªŒé€šè¿‡ï¼Œé‚£ä¹ˆå°±è¿”å›å¯¹åº”çš„ç´¢å¼•ã€‚ç»“æŸæµç¨‹</li><li>ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°å’Œ key ç›¸ç­‰çš„å…ƒç´ å€¼ï¼Œé‚£ä¹ˆå°±æ‹¿åˆ° hash åº”è¯¥å­˜å…¥ mHashes åçš„ç´¢å¼•ï¼Œ~ è¿ç®—åè¿”å›</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token comment">// Important fast case: if nothing is in here, nothing to look for.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">N</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ç¬¬ä¸€æ­¥</span>
    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">binarySearchHashes</span><span class="token punctuation">(</span>mHashes<span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// If the hash code wasn&#39;t found, then we have no entry for this key.</span>
    <span class="token comment">//ç¬¬äºŒæ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If the key at the returned index matches, that&#39;s what we want.</span>
    <span class="token comment">//ç¬¬å››æ­¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mArray<span class="token punctuation">[</span>index<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç¬¬äº”æ­¥</span>
    <span class="token comment">// Search for a matching key after the index.</span>
    <span class="token keyword">int</span> end<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>end <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> end <span class="token operator">&lt;</span> <span class="token class-name">N</span> <span class="token operator">&amp;&amp;</span> mHashes<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">==</span> hash<span class="token punctuation">;</span> end<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mArray<span class="token punctuation">[</span>end <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Search for a matching key before the index.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mHashes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> hash<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mArray<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Key not found -- return negative value indicating where a</span>
    <span class="token comment">// new entry for this key should go.  We use the end of the</span>
    <span class="token comment">// hash chain to reduce the number of array entries that will</span>
    <span class="token comment">// need to be copied when inserting.</span>
    <span class="token comment">//ç¬¬å…­æ­¥</span>
    <span class="token keyword">return</span> <span class="token operator">~</span>end<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4ã€ç¼“å­˜æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_4ã€ç¼“å­˜æœºåˆ¶" aria-hidden="true">#</a> 4ã€ç¼“å­˜æœºåˆ¶</h2><p>ArrayMap å†…éƒ¨åŒ…å«äº†å¯¹ mHashes å’Œ mArray è¿™ä¸¤ä¸ªæ•°ç»„è¿›è¡Œç¼“å­˜çš„æœºåˆ¶ï¼Œé¿å…ç”±äºé¢‘ç¹åˆ›å»ºæ•°ç»„è€Œé€ æˆå†…å­˜æŠ–åŠ¨ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„ä¹‰çš„ã€‚åœ¨ Android ç³»ç»Ÿä¸­ Bundle æ˜¯ä½¿ç”¨å¾—å¾ˆé¢‘ç¹çš„ä¸€ä¸ªç±»ï¼Œå…¶å†…éƒ¨å°±é€šè¿‡ ArrayMap æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œè¿™å¯ä»¥ä» Bundle çš„çˆ¶ç±» BaseBundle çœ‹åˆ°ã€‚æ‰€ä»¥ ArrayMap çš„æ•°ç»„ç¼“å­˜æœºåˆ¶åœ¨æˆ‘çœ‹æ¥æ›´å¤šçš„æ˜¯é¢å¯¹ç³»ç»Ÿè¿è¡Œæ—¶çš„ä¼˜åŒ–æªæ–½</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseBundle</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@UnsupportedAppUsage</span>
    <span class="token class-name">ArrayMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> mMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">boolean</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unparcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">putByte</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unparcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">putChar</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">char</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unparcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    Â·Â·Â·
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>put</code> æ–¹æ³•å†…éƒ¨å°±ä½¿ç”¨åˆ°äº†æ•°ç»„çš„ç¼“å­˜å’Œå¤ç”¨æœºåˆ¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Â·Â·Â·
    <span class="token keyword">if</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> mHashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> n <span class="token operator">=</span> osize <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>osize<span class="token operator">+</span><span class="token punctuation">(</span>osize<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> <span class="token constant">BASE_SIZE</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">BASE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: grow from &quot;</span> <span class="token operator">+</span> mHashes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ohashes <span class="token operator">=</span> mHashes<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oarray <span class="token operator">=</span> mArray<span class="token punctuation">;</span>
        <span class="token comment">//å°è¯•é€šè¿‡æ•°ç»„å¤ç”¨æœºåˆ¶æ¥åˆå§‹åŒ– mHashes å’Œ mArray</span>
        <span class="token function">allocArrays</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONCURRENT_MODIFICATION_EXCEPTIONS</span> <span class="token operator">&amp;&amp;</span> osize <span class="token operator">!=</span> mSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mHashes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: copy 0-&quot;</span> <span class="token operator">+</span> osize <span class="token operator">+</span> <span class="token string">&quot; to 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>ohashes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mHashes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ohashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>oarray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mArray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oarray<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å°è¯•å›æ”¶ ohashes å’Œ oarray</span>
        <span class="token function">freeArrays</span><span class="token punctuation">(</span>ohashes<span class="token punctuation">,</span> oarray<span class="token punctuation">,</span> osize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Â·Â·Â·
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼“å­˜æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜æ•°ç»„" aria-hidden="true">#</a> ç¼“å­˜æ•°ç»„</h3><p>å®ç°æ•°ç»„ç¼“å­˜é€»è¾‘å¯¹åº”çš„æ˜¯ <code>freeArrays</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±ç”¨äºç¼“å­˜ mHashes å’Œ mArrayã€‚æ¯å½“ ArrayMap å®Œæˆæ•°ç»„æ‰©å®¹åå°±ä¼šè°ƒç”¨æ­¤æ–¹æ³•å¯¹æ‰©å®¹å‰çš„æ•°ç»„è¿›è¡Œç¼“å­˜ï¼Œä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰æ•°ç»„éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œè€Œæ˜¯æœ‰ç€æ•°ç»„é•¿åº¦å’Œç¼“å­˜æ€»æ•°è¿™ä¸¤æ–¹é¢çš„é™åˆ¶</p><p>é¦–å…ˆï¼ŒArrayMap åŒ…å«äº†å¤šä¸ªå…¨å±€çš„é™æ€å˜é‡å’Œé™æ€å¸¸é‡ç”¨äºæ§åˆ¶åŠå®ç°æ•°ç»„ç¼“å­˜ã€‚ä»<code>freeArrays</code>æ–¹æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œif å’Œ else è¯­å¥å—çš„é€»è¾‘æ˜¯åŸºæœ¬å®Œå…¨ä¸€æ ·çš„ï¼Œå…¶åŒºåˆ«åªåœ¨äºè§¦å‘ç¼“å­˜çš„æ¡ä»¶å’Œä½¿ç”¨çš„ç¼“å­˜æ± ä¸ä¸€æ ·</p><p>ä¾‹å¦‚ï¼Œå¦‚æœ hashes çš„æ•°ç»„é•¿åº¦æ˜¯ BASE_SIZE * 2ï¼Œä¸”å½“å‰ç¼“å­˜æ€»æ•°æ²¡æœ‰è¶…å‡º CACHE_SIZEï¼Œé‚£ä¹ˆç¼“å­˜çš„æ•°ç»„å°±ä¿å­˜åœ¨ mTwiceBaseCache æ‰€æ„é€ çš„çš„å•å‘é“¾è¡¨ä¸­ã€‚mTwiceBaseCache é‡‡ç”¨å•å‘é“¾è¡¨çš„ç»“æ„æ¥ä¸²è”å¤šä¸ªæ•°ç»„ï¼Œè¦ç¼“å­˜çš„ mArray çš„ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ å€¼ä¼šå…ˆæŒ‡å‘ mTwiceBaseCacheï¼Œç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ å€¼ä¼šæŒ‡å‘ mHashesï¼Œä¹‹å mArray ä¼šæˆä¸ºå•å‘é“¾è¡¨çš„æ–°çš„å¤´ç»“ç‚¹ï¼Œå³ mArray æˆä¸ºäº†æ–°çš„ mTwiceBaseCacheã€‚åœ¨è¿™ç§ç¼“å­˜æœºåˆ¶ä¸‹ï¼Œæœ€ç»ˆ mTwiceBaseCache æŒ‡å‘çš„å…¶å®æ˜¯æœ¬æ¬¡ç¼“å­˜çš„ mArrayï¼ŒmArray çš„ç¬¬ä¸€ä¸ªå…ƒç´ å€¼æŒ‡å‘çš„åˆæ˜¯ä¸Šä¸€æ¬¡ç¼“å­˜çš„ mArrayï¼Œç¬¬äºŒä¸ªå…ƒç´ å€¼æŒ‡å‘çš„æ˜¯æœ¬æ¬¡ç¼“å­˜çš„ mHashesï¼Œä»è€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ç»“æ„</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE çš„æ•°ç»„</span>
<span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mBaseCache<span class="token punctuation">;</span>
<span class="token comment">//mBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> mBaseCacheSize<span class="token punctuation">;</span>

<span class="token comment">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE * 2 çš„æ•°ç»„</span>
<span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mTwiceBaseCache<span class="token punctuation">;</span>
<span class="token comment">//mTwiceBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> mTwiceBaseCacheSize<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BASE_SIZE</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">//mBaseCacheSize å’Œ mTwiceBaseCacheSize çš„æœ€å¤§ç¼“å­˜ä¸ªæ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">CACHE_SIZE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">//ç”¨æ¥å½“åšåŒæ­¥é”</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> sBaseCacheLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> sTwiceBaseCacheLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ç¼“å­˜ hashes å’Œ array</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">freeArrays</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hashes<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hashes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>sTwiceBaseCacheLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mTwiceBaseCacheSize <span class="token operator">&lt;</span> <span class="token constant">CACHE_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ mTwiceBaseCache</span>
                array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> mTwiceBaseCache<span class="token punctuation">;</span>
                  <span class="token comment">//ç¬¬äºŒä¸ªå…ƒç´ æŒ‡å‘ hashes</span>
                array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> hashes<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token punctuation">(</span>size<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&gt;=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//åˆ‡é™¤å¤šä½™å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼Œæœ‰åˆ©äº GC</span>
                    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//array æˆä¸ºå•é“¾è¡¨çš„å¤´ç»“ç‚¹</span>
                mTwiceBaseCache <span class="token operator">=</span> array<span class="token punctuation">;</span>
                mTwiceBaseCacheSize<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Storing 2x cache &quot;</span> <span class="token operator">+</span> array
                        <span class="token operator">+</span> <span class="token string">&quot; now have &quot;</span> <span class="token operator">+</span> mTwiceBaseCacheSize <span class="token operator">+</span> <span class="token string">&quot; entries&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hashes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token constant">BASE_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>sBaseCacheLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mBaseCacheSize <span class="token operator">&lt;</span> <span class="token constant">CACHE_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> mBaseCache<span class="token punctuation">;</span>
                array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> hashes<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token punctuation">(</span>size<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&gt;=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                mBaseCache <span class="token operator">=</span> array<span class="token punctuation">;</span>
                mBaseCacheSize<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Storing 1x cache &quot;</span> <span class="token operator">+</span> array
                        <span class="token operator">+</span> <span class="token string">&quot; now have &quot;</span> <span class="token operator">+</span> mBaseCacheSize <span class="token operator">+</span> <span class="token string">&quot; entries&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤ç”¨æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#å¤ç”¨æ•°ç»„" aria-hidden="true">#</a> å¤ç”¨æ•°ç»„</h3><p>ç¼“å­˜æ•°ç»„çš„ç›®çš„è‡ªç„¶å°±æ˜¯ä¸ºäº†åç»­å¤ç”¨ï¼Œæ•°ç»„çš„å¤ç”¨é€»è¾‘å¯¹åº”çš„æ˜¯ <code>allocArrays</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºä¸º mHashes å’Œ mArray ç”³è¯·ä¸€ä¸ªæ›´å¤§å®¹é‡çš„æ•°ç»„ç©ºé—´ï¼Œé€šè¿‡å¤ç”¨æ•°ç»„æˆ–è€…å…¨æ–°åˆå§‹åŒ–æ¥è·å¾—</p><p>åœ¨è¿›è¡Œæ•°ç»„ç¼“å­˜çš„æ—¶å€™ä¼šåˆ¤æ–­æ•°ç»„é•¿åº¦ï¼Œåªæœ‰å½“é•¿åº¦æ˜¯ BASE_SIZE * 2 æˆ– BASE_SIZE æ—¶æ‰ä¼šè¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆè‡ªç„¶åªæœ‰å½“æ•°ç»„çš„ç›®æ ‡é•¿åº¦ size æ˜¯è¿™ä¸¤ä¸ªå€¼ä¹‹ä¸€æ‰ç¬¦åˆå¤ç”¨æ¡ä»¶äº†ã€‚<code>allocArrays</code> æ–¹æ³•å–å‡ºç¼“å­˜çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å–å‡ºå•å‘é“¾è¡¨çš„å¤´ç»“ç‚¹èµ‹å€¼ç»™ mHashes å’Œ mArrayï¼ŒåŒæ—¶ä½¿é“¾è¡¨çš„ç¬¬äºŒä¸ªç»“ç‚¹æˆä¸ºæ–°çš„å¤´ç»“ç‚¹å³å¯ã€‚å¦‚æœä¸ç¬¦åˆå¤ç”¨æ¡ä»¶æˆ–è€…å¤ç”¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯éœ€è¦é‡æ–°æ„å»ºä¸¤ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE çš„æ•°ç»„</span>
<span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mBaseCache<span class="token punctuation">;</span>
<span class="token comment">//mBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> mBaseCacheSize<span class="token punctuation">;</span>

<span class="token comment">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE * 2 çš„æ•°ç»„</span>
<span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mTwiceBaseCache<span class="token punctuation">;</span>
<span class="token comment">//mTwiceBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> mTwiceBaseCacheSize<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BASE_SIZE</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">//mBaseCacheSize å’Œ mTwiceBaseCacheSize çš„æœ€å¤§ç¼“å­˜ä¸ªæ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">CACHE_SIZE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">//ç”¨æ¥å½“åšåŒæ­¥é”</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> sBaseCacheLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> sTwiceBaseCacheLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">allocArrays</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mHashes <span class="token operator">==</span> <span class="token constant">EMPTY_IMMUTABLE_INTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;ArrayMap is immutable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>sTwiceBaseCacheLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mTwiceBaseCache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> mTwiceBaseCache<span class="token punctuation">;</span>
                mArray <span class="token operator">=</span> array<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//æŒ‡å‘å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œå³åŸå…ˆçš„ç¬¬äºŒä¸ªç»“ç‚¹å°†æˆä¸ºé“¾è¡¨æ–°çš„å¤´ç»“ç‚¹</span>
                    mTwiceBaseCache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    mHashes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mHashes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//ç¬¦åˆå¤ç”¨æ¡ä»¶ï¼Œåˆ‡é™¤å¤šä½™å¼•ç”¨</span>
                        array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        mTwiceBaseCacheSize<span class="token operator">--</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Retrieving 2x cache &quot;</span> <span class="token operator">+</span> mHashes
                                    <span class="token operator">+</span> <span class="token string">&quot; now have &quot;</span> <span class="token operator">+</span> mTwiceBaseCacheSize <span class="token operator">+</span> <span class="token string">&quot; entries&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassCastException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Whoops!  Someone trampled the array (probably due to not protecting</span>
                <span class="token comment">// their access with a lock).  Our cache is corrupt; report and give up.</span>
                <span class="token class-name">Slog</span><span class="token punctuation">.</span><span class="token function">wtf</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Found corrupt ArrayMap cache: [0]=&quot;</span> <span class="token operator">+</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token operator">+</span> <span class="token string">&quot; [1]=&quot;</span> <span class="token operator">+</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜ç¼“å­˜æœºåˆ¶å‘ç°é—®é¢˜ï¼Œåˆ™å¼ƒç”¨ä¹‹å‰çš„æ‰€æœ‰ç¼“å­˜</span>
                mTwiceBaseCache <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                mTwiceBaseCacheSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token constant">BASE_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>sBaseCacheLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mBaseCache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> mBaseCache<span class="token punctuation">;</span>
                mArray <span class="token operator">=</span> array<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mBaseCache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    mHashes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mHashes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        mBaseCacheSize<span class="token operator">--</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Retrieving 1x cache &quot;</span> <span class="token operator">+</span> mHashes
                                    <span class="token operator">+</span> <span class="token string">&quot; now have &quot;</span> <span class="token operator">+</span> mBaseCacheSize <span class="token operator">+</span> <span class="token string">&quot; entries&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassCastException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Whoops!  Someone trampled the array (probably due to not protecting</span>
                <span class="token comment">// their access with a lock).  Our cache is corrupt; report and give up.</span>
                <span class="token class-name">Slog</span><span class="token punctuation">.</span><span class="token function">wtf</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Found corrupt ArrayMap cache: [0]=&quot;</span> <span class="token operator">+</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token operator">+</span> <span class="token string">&quot; [1]=&quot;</span> <span class="token operator">+</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mBaseCache <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                mBaseCacheSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    mHashes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    mArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>size<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h3><p>ä¸Šæ–‡è¯´äº†ï¼Œåªæœ‰é•¿åº¦ä¸º BASE_SIZE æˆ–è€… BASE_SIZE * 2 çš„æ•°ç»„æ‰ä¼šè¢«ç¼“å­˜å¤ç”¨ï¼Œè€Œ mHashes å’Œ mArray çš„æ‰©å®¹æ“ä½œä¹Ÿä¼šå°½é‡ä½¿å¾—æ‰©å®¹åçš„æ•°ç»„é•¿åº¦å°±æ˜¯è¿™ä¸¤ä¸ªå€¼ä¹‹ä¸€ï¼Œè¿™å¯ä»¥ä» <code>put</code> æ–¹æ³•è®¡ç®—æ‰©å®¹åå®¹é‡çš„ç®—æ³•çœ‹å‡ºæ¥</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> osize <span class="token operator">=</span> mSize<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    Â·Â·Â·
    <span class="token keyword">if</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> mHashes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è®¡ç®—æ•°ç»„æ‰©å®¹åçš„å¤§å°</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> n <span class="token operator">=</span> osize <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>osize<span class="token operator">+</span><span class="token punctuation">(</span>osize<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token punctuation">(</span>osize <span class="token operator">&gt;=</span> <span class="token constant">BASE_SIZE</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token constant">BASE_SIZE</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">BASE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;put: grow from &quot;</span> <span class="token operator">+</span> mHashes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ohashes <span class="token operator">=</span> mHashes<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oarray <span class="token operator">=</span> mArray<span class="token punctuation">;</span>

        <span class="token function">allocArrays</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Â·Â·Â·

        <span class="token function">freeArrays</span><span class="token punctuation">(</span>ohashes<span class="token punctuation">,</span> oarray<span class="token punctuation">,</span> osize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Â·Â·Â·
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥è¯´ï¼Œè™½ç„¶ ArrayMap çš„æ„é€ å‡½æ•°ä¸­å¹¶æ²¡æœ‰ç›´æ¥å°† BASE_SIZE ä½œä¸ºæ•°ç»„çš„é»˜è®¤é•¿åº¦ï¼Œä½†æ˜¯åœ¨æ‰©å®¹è¿‡ç¨‹ä¸­ä¼šå°½é‡å¾€ BASE_SIZE å’Œ BASE_SIZE * 2 è¿™ä¸¤ä¸ªå€¼é æ‹¢ï¼Œè¿™å°±æœ‰åˆ©äºå°½é‡å®ç°æ•°ç»„å¤ç”¨</p><p>æ­¤å¤–ï¼ŒArrayMap çš„æ‰©å®¹æ“ä½œåœ¨ç”³è¯·å†…å­˜æ—¶ä¹Ÿæ˜¾å¾—æ¯”è¾ƒå…‹åˆ¶ï¼Œåœ¨æ•°ç»„é•¿åº¦è¶…å‡º BASE_SIZE * 2 åï¼Œåªæ˜¯æ‰©å®¹åˆ°å½“å‰çš„ 1.5 å€ï¼Œä¸”ä¹Ÿåªåœ¨ mHashes å®¹é‡ä¸è¶³æ—¶æ‰ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚è€Œ HashMap åœ¨è¾¾åˆ°è´Ÿè½½å› å­è®¾å®šçš„æ¯”ä¾‹åï¼ˆæ­¤æ—¶æ•°ç»„æœªæ»¡ï¼‰å°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œè€Œä¸”ä¹Ÿæ˜¯æŒ‰ç…§æ‰©å……åˆ°ä¸¤å€å®¹é‡çš„æ–¹å¼è¿›è¡Œæ‰©å®¹ã€‚æ‰€ä»¥è¯´ï¼ŒArrayMap å¯¹äºå†…å­˜ç©ºé—´çš„åˆ©ç”¨æ•ˆç‡ä¼šæ›´é«˜ä¸€äº›</p><h2 id="_5ã€ä¼˜åŠ£åŠ¿æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5ã€ä¼˜åŠ£åŠ¿æ€»ç»“" aria-hidden="true">#</a> 5ã€ä¼˜åŠ£åŠ¿æ€»ç»“</h2><p>ArrayMap çš„é€‚ç”¨åœºæ™¯å¯ä»¥ä»å®ƒçš„ç¼“å­˜æœºåˆ¶å°±çœ‹å‡ºæ¥ä¸€äº›ï¼Œå®ƒä¼šç¼“å­˜å®¹é‡ä¸º 4 æˆ–è€… 8 çš„æ•°ç»„å¹¶è¿›è¡Œåç»­å¤ç”¨ï¼Œè€Œè¿™ä¸¤ä¸ªå€¼å¯ä»¥è¯´éƒ½æ˜¯æ¯”è¾ƒå°çš„ã€‚Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œéœ€è¦å­˜å‚¨é”®å€¼å¯¹æ—¶é¢å¯¹çš„å¾€å¾€æ˜¯ä½¿ç”¨é¢‘ç‡é«˜ä½†æ•°æ®é‡å°çš„åœºæ™¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨è·³è½¬åˆ° Activity æ—¶å¾€å¾€æ˜¯é€šè¿‡ Bundle æ¥å­˜å‚¨è·³è½¬å‚æ•°ï¼Œä½†æ•°æ®é‡ä¸€èˆ¬éƒ½å¾ˆå°‘ï¼Œæ‰€ä»¥ Bundle å†…éƒ¨å°±ä½¿ç”¨åˆ°äº† ArrayMap æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚ArrayMap åœ¨å†…å­˜ç”³è¯·æ—¶ç›¸æ¯” HashMap ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œé”®å€¼å¯¹ä¼šä»¥æ›´åŠ ç´§å¯†çš„æ•°æ®ç»“æ„å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå¯¹å†…å­˜åˆ©ç”¨ç‡ä¼šæ›´é«˜ä¸€äº›</p><p>è€Œç›¸å¯¹çš„ï¼ŒArrayMap çš„è¿™ç§å­˜å‚¨ç»“æ„ä¹Ÿå¯¼è‡´äº†å…¶æŸ¥æ‰¾æ•ˆç‡ç›¸æ¯” HashMap è¦ä½å¾ˆå¤šã€‚åœ¨æ•°æ®é‡å¤§æ—¶ï¼ŒArrayMap å¯èƒ½éœ€è¦é€šè¿‡å¤šæ¬¡äºŒåˆ†æŸ¥æ‰¾æ‰èƒ½å®šä½åˆ°å…ƒç´ ï¼Œè€Œ HashMap åœ¨æ²¡æœ‰å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹åªéœ€è¦ç»è¿‡ä¸€æ¬¡å“ˆå¸Œè®¡ç®—å³å¯å®šä½åˆ°å…ƒç´ ï¼Œå³ä½¿æœ‰å“ˆå¸Œå†²çªä¹Ÿåªéœ€è¦éå†å‘ç”Ÿå†²çªçš„éƒ¨åˆ†å…ƒç´ å³å¯</p><p>æ‰€ä»¥è¯´ï¼Œ ArrayMap é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„åœºæ™¯ï¼Œæ­¤æ—¶æŸ¥æ‰¾æ•ˆç‡ä¹Ÿä¸ä¼šå—å¤šå¤§å½±å“ï¼Œè€Œå†…å­˜åˆ©ç”¨ç‡èƒ½å¤Ÿæ˜¾è‘—æé«˜ã€‚å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ HashMap æ¥æ›¿ä»£äº†</p><h2 id="_6ã€å…³è”ç±»" tabindex="-1"><a class="header-anchor" href="#_6ã€å…³è”ç±»" aria-hidden="true">#</a> 6ã€å…³è”ç±»</h2><p>ç³»ç»Ÿè¿˜åŒ…å«äº†ä¸€ä¸ªç”¨äºå­˜å‚¨ä¸é‡å¤å…ƒç´ å€¼çš„é›†åˆæ¡†æ¶ç±»ï¼šArraySetï¼Œä»åå­—å°±å¯ä»¥çŒœåˆ° ArraySet å®ç°äº† Set æ¥å£ã€‚ArraySet å†…éƒ¨ä¸€æ ·ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„æ¥å­˜å‚¨ hash å’Œ valueï¼Œå³ mHashes å’Œ mArrayï¼Œåœ¨å®ç°é€»è¾‘ä¸ŠåŸºæœ¬å’Œ ArrayMap ä¸€æ ·ï¼Œåªæ˜¯ä¼šåœ¨å­˜å€¼çš„æ—¶å€™åˆ¤æ–­ value æ˜¯å¦é‡å¤è€Œå·²ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>`,92);function d(v,m){const a=t("ExternalLinkIcon");return e(),o("div",null,[n("blockquote",null,[n("p",null,[s("å…¬ä¼—å·ï¼š"),n("a",u,[s("å­—èŠ‚æ•°ç»„"),c(a)])]),k]),r])}const h=p(i,[["render",d],["__file","Java _ Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰.html.vue"]]);export{h as default};
