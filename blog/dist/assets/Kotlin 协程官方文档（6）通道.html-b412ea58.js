import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as l,a as n,d as s,e,f as t}from"./app-6847d3e4.js";const i={},u={href:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image",target:"_blank",rel:"noopener noreferrer"},r=n("p",null,"å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£",-1),k=n("p",null,[s("æœ€è¿‘ä¸€ç›´åœ¨äº†è§£å…³äº "),n("strong",null,"Kotlinåç¨‹"),s(" çš„çŸ¥è¯†ï¼Œé‚£æœ€å¥½çš„å­¦ä¹ èµ„æ–™è‡ªç„¶æ˜¯å®˜æ–¹æä¾›çš„å­¦ä¹ æ–‡æ¡£äº†ï¼Œçœ‹äº†çœ‹åæˆ‘å°±èŒç”Ÿäº†ç¿»è¯‘å®˜æ–¹æ–‡æ¡£çš„æƒ³æ³•ã€‚å‰åèŠ±äº†è¦æ¥è¿‘ä¸€ä¸ªæœˆæ—¶é—´ï¼Œä¸€å…±ä¹ç¯‡æ–‡ç« ï¼Œåœ¨è¿™é‡Œä¹Ÿåˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚ä¸ªäººçŸ¥è¯†æ‰€é™ï¼Œæœ‰äº›ç¿»è¯‘å¾—ä¸æ˜¯å¤ªé¡ºç•…ï¼Œä¹Ÿå¸Œæœ›è¯»è€…èƒ½æå‡ºæ„è§")],-1),d={href:"https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md",target:"_blank",rel:"noopener noreferrer"},m=t(`<p>Deferred å€¼æä¾›äº†åœ¨åç¨‹ä¹‹é—´ä¼ é€’å•ä¸ªå€¼çš„æ–¹ä¾¿æ–¹æ³•ï¼Œè€Œé€šé“ï¼ˆChannelsï¼‰æä¾›äº†ä¸€ç§ä¼ è¾“å€¼æµçš„æ–¹æ³•</p><h1 id="ä¸€ã€é€šé“åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€é€šé“åŸºç¡€" aria-hidden="true">#</a> ä¸€ã€é€šé“åŸºç¡€</h1><p>é€šé“åœ¨æ¦‚å¿µä¸Šéå¸¸ç±»ä¼¼äº <code>BlockingQueue</code>ï¼Œå®ƒä»¬ä¹‹é—´çš„ä¸€ä¸ªå…³é”®åŒºåˆ«æ˜¯ï¼šé€šé“æœ‰ä¸€ä¸ªæŒ‚èµ·çš„ send å‡½æ•°å’Œä¸€ä¸ªæŒ‚èµ·çš„ receive å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé˜»å¡çš„ put æ“ä½œå’Œä¸€ä¸ªé˜»å¡çš„ take æ“ä½œ</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> channel <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    launch <span class="token punctuation">{</span>
        <span class="token comment">// this might be heavy CPU-consuming computation or async logic, we&#39;ll just send five squares</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span> channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// here we print five received integers:</span>
    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Done!&quot;</span></span><span class="token punctuation">)</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœæ˜¯:</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token number">1</span>
<span class="token number">4</span>
<span class="token number">9</span>
<span class="token number">16</span>
<span class="token number">25</span>
Done<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="äºŒã€å…³é—­å’Œè¿­ä»£é€šé“" tabindex="-1"><a class="header-anchor" href="#äºŒã€å…³é—­å’Œè¿­ä»£é€šé“" aria-hidden="true">#</a> äºŒã€å…³é—­å’Œè¿­ä»£é€šé“</h1><p>ä¸é˜Ÿåˆ—ä¸åŒï¼Œé€šé“å¯ä»¥å…³é—­ï¼Œä»¥æ­¤æ¥è¡¨æ˜å…ƒç´ å·²å‘é€å®Œæˆã€‚åœ¨æ¥æ”¶æ–¹ï¼Œä½¿ç”¨å¸¸è§„çš„ for å¾ªç¯ä»é€šé“æ¥æ”¶å…ƒç´ æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„</p><p>ä»æ¦‚å¿µä¸Šè®²ï¼Œclose ç±»ä¼¼äºå‘é€šé“å‘é€ä¸€ä¸ªç‰¹æ®Šçš„ cloase æ ‡è®°ã€‚ä¸€æ—¦æ¥æ”¶åˆ°è¿™ä¸ª close æ ‡è®°ï¼Œè¿­ä»£å°±ä¼šåœæ­¢ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ¥æ”¶åˆ° close ä¹‹å‰å‘é€çš„æ‰€æœ‰å…ƒç´ ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> channel <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    launch <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span> channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// we&#39;re done sending</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// here we print received values using \`for\` loop (until the channel is closed)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>y <span class="token keyword">in</span> channel<span class="token punctuation">)</span> <span class="token function">println</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Done!&quot;</span></span><span class="token punctuation">)</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="ä¸‰ã€æ„å»ºé€šé“ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ„å»ºé€šé“ç”Ÿäº§è€…" aria-hidden="true">#</a> ä¸‰ã€æ„å»ºé€šé“ç”Ÿäº§è€…</h1><p>åç¨‹ç”Ÿæˆå…ƒç´ åºåˆ—(sequence )çš„æ¨¡å¼éå¸¸å¸¸è§ã€‚è¿™æ˜¯å¯ä»¥ç»å¸¸åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å‘ç°çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚ä½ å¯ä»¥å°†è¿™æ ·ä¸€ä¸ªç”Ÿäº§è€…æŠ½è±¡ä¸ºä¸€ä¸ªä»¥ channel ä¸ºå‚æ•°çš„å‡½æ•°ï¼Œä½†è¿™ä¸å¿…é¡»ä»å‡½æ•°è¿”å›ç»“æœçš„å¸¸è¯†ç›¸å</p><p>æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„åä¸º product çš„åç¨‹æ„é€ å™¨ï¼Œå®ƒä½¿å¾—åœ¨ producer ç«¯æ‰§è¡Œè¯¥æ“ä½œå˜å¾—å¾ˆå®¹æ˜“ï¼›è¿˜æœ‰ä¸€ä¸ªæ‰©å±•å‡½æ•° consumerEachï¼Œå®ƒæ›¿æ¢äº†consumer ç«¯çš„ for å¾ªç¯ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">produceSquares</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token operator">=</span> produce <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> squares <span class="token operator">=</span> <span class="token function">produceSquares</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    squares<span class="token punctuation">.</span><span class="token function">consumeEach</span> <span class="token punctuation">{</span> <span class="token function">println</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Done!&quot;</span></span><span class="token punctuation">)</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="å››ã€ç®¡é“" tabindex="-1"><a class="header-anchor" href="#å››ã€ç®¡é“" aria-hidden="true">#</a> å››ã€ç®¡é“</h1><p>ç®¡é“æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ˜¯ä¸€ä¸ªåç¨‹æ­£åœ¨ç”Ÿæˆçš„å¯èƒ½æ˜¯æ— ç©·å¤šä¸ªå…ƒç´ çš„å€¼æµ</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// infinite stream of integers starting from 1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåç¨‹å¯¹å€¼æµè¿›è¡Œå–å€¼ï¼Œè¿›è¡Œä¸€äº›å¤„ç†å¹¶äº§ç”Ÿä¸€äº›å…¶å®ƒç»“æœã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªè¿”å›å€¼ä¹Ÿæ˜¯å…¥å‚å€¼ï¼ˆæ•°å­—ï¼‰çš„å¹³æ–¹å€¼</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>numbers<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token operator">=</span> produce <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> numbers<span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨å¹¶è¿æ¥æ•´ä¸ªç®¡é“ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> numbers <span class="token operator">=</span> <span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// produces integers from 1 and on</span>
    <span class="token keyword">val</span> squares <span class="token operator">=</span> <span class="token function">square</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token comment">// squares integers</span>
    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span>squares<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// print first five</span>
    <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Done!&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// we are done</span>
    coroutineContext<span class="token punctuation">.</span><span class="token function">cancelChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cancel children coroutines</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// infinite stream of integers starting from 1</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>numbers<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token operator">=</span> produce <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> numbers<span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>åˆ›å»ºåç¨‹çš„æ‰€æœ‰å‡½æ•°éƒ½è¢«å®šä¹‰ä¸º CoroutineScope çš„æ‰©å±•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¾èµ–ç»“æ„åŒ–å¹¶å‘æ¥ç¡®ä¿åº”ç”¨ç¨‹åºä¸­æ²¡æœ‰å»¶è¿Ÿçš„å…¨å±€åç¨‹</p></blockquote><h1 id="äº”ã€ä½¿ç”¨ç®¡é“çš„ç´ æ•°" tabindex="-1"><a class="header-anchor" href="#äº”ã€ä½¿ç”¨ç®¡é“çš„ç´ æ•°" aria-hidden="true">#</a> äº”ã€ä½¿ç”¨ç®¡é“çš„ç´ æ•°</h1><p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªä½¿ç”¨åç¨‹ç®¡é“ç”Ÿæˆç´ æ•°çš„ä¾‹å­ï¼Œå°†ç®¡é“å‘æŒ¥åˆ°æè‡´ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªæ— é™çš„æ•°å­—åºåˆ—å¼€å§‹</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">numbersFrom</span><span class="token punctuation">(</span>start<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> start
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// infinite stream of integers from start</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸‹ç®¡é“è¿‡æ»¤ä¼ å…¥çš„æ•°å­—æµï¼Œåˆ é™¤æ‰€æœ‰å¯è¢«ç»™å®šç´ æ•°æ•´é™¤çš„æ•°å­—ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>numbers<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">,</span> prime<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> numbers<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> prime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä»2å¼€å§‹ä¸€ä¸ªæ•°å­—æµï¼Œä»å½“å‰é€šé“è·å–ä¸€ä¸ªè´¨æ•°ï¼Œå¹¶ä¸ºæ‰¾åˆ°çš„æ¯ä¸ªè´¨æ•°å¯åŠ¨æ–°çš„ç®¡é“ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token function">numbersFrom</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">..</span><span class="token punctuation">.</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‰“å°äº†å‰åä¸ªè´¨æ•°ï¼Œåœ¨ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ•´ä¸ªç®¡é“ã€‚å› ä¸ºæ‰€æœ‰çš„åç¨‹éƒ½æ˜¯åœ¨ä¸» runBlocking åç¨‹çš„èŒƒå›´å†…å¯åŠ¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…ä¿ç•™æ‰€æœ‰å·²å¯åŠ¨çš„åç¨‹çš„æ˜¾å¼å¼•ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨æ‰©å±•å‡½æ•° cancelChildren æ¥å–æ¶ˆæ‰“å°å‰åä¸ªè´¨æ•°åçš„æ‰€æœ‰å­åç¨‹</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">var</span> cur <span class="token operator">=</span> <span class="token function">numbersFrom</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> prime <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span>prime<span class="token punctuation">)</span>
        cur <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> prime<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    coroutineContext<span class="token punctuation">.</span><span class="token function">cancelChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cancel all children to let main finish</span>
    <span class="token comment">//sampleEnd    </span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">numbersFrom</span><span class="token punctuation">(</span>start<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> start
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// infinite stream of integers from start</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>numbers<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">,</span> prime<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">in</span> numbers<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> prime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">5</span>
<span class="token number">7</span>
<span class="token number">11</span>
<span class="token number">13</span>
<span class="token number">17</span>
<span class="token number">19</span>
<span class="token number">23</span>
<span class="token number">29</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ iterator åç¨‹æ„é€ å™¨æ¥æ„å»ºç›¸åŒçš„ç®¡é“ã€‚å°† product æ›¿æ¢ä¸º iteratorï¼Œsend æ›¿æ¢ä¸º yieldï¼Œreceive æ›¿æ¢ä¸º nextï¼ŒReceiveChannel æ›¿æ¢ä¸º iteratorï¼Œå¹¶å»æ‰åç¨‹ä½œç”¨åŸŸã€‚ä½ ä¹Ÿä¸éœ€è¦å†ä½¿ç”¨ runBlocking ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å¦‚ä¸Šæ‰€ç¤ºçš„é€šé“çš„ç®¡é“çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœåœ¨ Dispatchers.Default ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå®ƒï¼Œå®ƒå®é™…ä¸Šå¯ä»¥åˆ©ç”¨å¤šä¸ª CPU æ¥æ‰§è¡Œä»£ç </p><p>ä½†æ— è®ºå¦‚ä½•ï¼Œå¦‚ä¸Šæ‰€è¿°çš„æ›¿ä»£æ–¹æ¡ˆä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¸åˆ‡å®é™…çš„æ¥å¯»æ‰¾ç´ æ•°çš„æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œç®¡é“ç¡®å®æ¶‰åŠä¸€äº›å…¶ä»–æŒ‚èµ·è°ƒç”¨ï¼ˆå¦‚å¯¹è¿œç¨‹æœåŠ¡çš„å¼‚æ­¥è°ƒç”¨ï¼‰ï¼Œå¹¶ä¸”è¿™äº›ç®¡é“ä¸èƒ½ä½¿ç”¨ sequence/iterator æ¥æ„å»ºï¼Œå› ä¸ºå®ƒä»¬ä¸å…è®¸ä»»æ„æŒ‚èµ·ï¼Œè€Œ product æ˜¯å®Œå…¨å¼‚æ­¥çš„</p><h1 id="å…­ã€æ‰‡å‡º" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ‰‡å‡º" aria-hidden="true">#</a> å…­ã€æ‰‡å‡º</h1><p>å¤šä¸ªåç¨‹å¯ä»¥ä»åŒä¸€ä¸ªé€šé“æ¥æ”¶æ•°æ®ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åˆ†é…ä»»åŠ¡ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªå‘¨æœŸæ€§åœ°ç”Ÿæˆæ•´æ•°ï¼ˆæ¯ç§’10ä¸ªæ•°ï¼‰çš„ producer åç¨‹å¼€å§‹ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// start from 1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// produce next</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// wait 0.1s</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªå¤„ç†å™¨(processor)åç¨‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä»–ä»¬åªéœ€æ‰“å°ä»–ä»¬çš„ id å’Œæ¥æ”¶çš„æ•°å­—ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">launchProcessor</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">,</span> channel<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=</span> launch <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>msg <span class="token keyword">in</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Processor #</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string"> received </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">msg</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨è®©æˆ‘ä»¬å¯åŠ¨5ä¸ªå¤„ç†å™¨ï¼Œè®©å®ƒä»¬å·¥ä½œå‡ ä¹ä¸€ç§’é’Ÿã€‚çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> producer <span class="token operator">=</span> <span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">launchProcessor</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> producer<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">950</span><span class="token punctuation">)</span>
    producer<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cancel producer coroutine and thus kill them all</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">produceNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> produce<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// start from 1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">send</span><span class="token punctuation">(</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// produce next</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// wait 0.1s</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">launchProcessor</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">,</span> channel<span class="token operator">:</span> ReceiveChannel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=</span> launch <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>msg <span class="token keyword">in</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Processor #</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string"> received </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">msg</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°½ç®¡æ¥æ”¶æ¯ä¸ªç‰¹å®šæ•´æ•°çš„å¤„ç†å™¨ id å¯èƒ½ä¸åŒï¼Œä½†è¿è¡Œç»“æœå°†ç±»ä¼¼äºä»¥ä¸‹è¾“å‡ºï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>Processor #<span class="token number">2</span> received <span class="token number">1</span>
Processor #<span class="token number">4</span> received <span class="token number">2</span>
Processor #<span class="token number">0</span> received <span class="token number">3</span>
Processor #<span class="token number">1</span> received <span class="token number">4</span>
Processor #<span class="token number">3</span> received <span class="token number">5</span>
Processor #<span class="token number">2</span> received <span class="token number">6</span>
Processor #<span class="token number">4</span> received <span class="token number">7</span>
Processor #<span class="token number">0</span> received <span class="token number">8</span>
Processor #<span class="token number">1</span> received <span class="token number">9</span>
Processor #<span class="token number">3</span> received <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œå–æ¶ˆ producer åç¨‹ä¼šå…³é—­å…¶é€šé“ï¼Œä»è€Œæœ€ç»ˆç»ˆæ­¢ processor åç¨‹æ­£åœ¨æ‰§è¡Œçš„é€šé“ä¸Šçš„è¿­ä»£</p><p>å¦å¤–ï¼Œè¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ for å¾ªç¯åœ¨é€šé“ä¸Šæ˜¾å¼è¿­ä»£ä»¥åœ¨ launchProcessor ä»£ç ä¸­æ‰§è¡Œ fan-outã€‚ä¸ consumeEach ä¸åŒï¼Œè¿™ä¸ª for å¾ªç¯æ¨¡å¼åœ¨å¤šä¸ªåç¨‹ä¸­ä½¿ç”¨æ˜¯å®Œå…¨å®‰å…¨çš„ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ª processor åç¨‹å¤±è´¥ï¼Œåˆ™å…¶ä»–å¤„ç†å™¨ä»å°†å¤„ç†é€šé“ï¼Œè€Œé€šè¿‡ consumeEach å†™å…¥çš„å¤„ç†å™¨æ€»æ˜¯åœ¨æ­£å¸¸æˆ–å¼‚å¸¸å®Œæˆæ—¶æ¶ˆè´¹ï¼ˆå–æ¶ˆï¼‰åº•å±‚é€šé“</p><h1 id="ä¸ƒã€æ‰‡å…¥" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ‰‡å…¥" aria-hidden="true">#</a> ä¸ƒã€æ‰‡å…¥</h1><p>å¤šä¸ªåç¨‹å¯ä»¥å‘é€åˆ°åŒä¸€ä¸ªé€šé“ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²é€šé“å’Œä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå‡½æ•°ä»¥æŒ‡å®šçš„å»¶è¿Ÿå°†æŒ‡å®šçš„å­—ç¬¦ä¸²é‡å¤å‘é€åˆ°æ­¤é€šé“ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">sendString</span><span class="token punctuation">(</span>channel<span class="token operator">:</span> SendChannel<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span> s<span class="token operator">:</span> String<span class="token punctuation">,</span> time<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
        channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœå¯åŠ¨ä¸¤ä¸ªåç¨‹æ¥å‘é€å­—ç¬¦ä¸²ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å®ƒä»¬ä½œä¸ºä¸»åç¨‹çš„å­åç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­å¯åŠ¨ï¼‰ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> channel <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    launch <span class="token punctuation">{</span> <span class="token function">sendString</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;foo&quot;</span></span><span class="token punctuation">,</span> <span class="token number">200L</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    launch <span class="token punctuation">{</span> <span class="token function">sendString</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;BAR!&quot;</span></span><span class="token punctuation">,</span> <span class="token number">500L</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// receive first six</span>
        <span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    coroutineContext<span class="token punctuation">.</span><span class="token function">cancelChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cancel all children to let main finish</span>
    <span class="token comment">//sampleEnd</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">sendString</span><span class="token punctuation">(</span>channel<span class="token operator">:</span> SendChannel<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span> s<span class="token operator">:</span> String<span class="token punctuation">,</span> time<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
        channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>foo
foo
BAR<span class="token operator">!</span>
foo
foo
BAR<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="å…«ã€å¸¦ç¼“å†²çš„é€šé“" tabindex="-1"><a class="header-anchor" href="#å…«ã€å¸¦ç¼“å†²çš„é€šé“" aria-hidden="true">#</a> å…«ã€å¸¦ç¼“å†²çš„é€šé“</h1><p>åˆ°ç›®å‰ä¸ºæ­¢æ˜¾ç¤ºçš„é€šé“éƒ½æ²¡æœ‰ç¼“å†²åŒºã€‚æ— ç¼“å†²é€šé“åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒæ—¶è°ƒç”¨å‘é€å’Œæ¥æ”¶æ“ä½œæ—¶ä¼ è¾“å…ƒç´ ã€‚å¦‚æœå…ˆè°ƒç”¨ sendï¼Œåˆ™åœ¨è°ƒç”¨ receive ä¹‹å‰ä¼šå°†å…¶æŒ‚èµ·ï¼›å¦‚æœå…ˆè°ƒç”¨ receive ï¼Œåˆ™åœ¨è°ƒç”¨ send ä¹‹å‰ä¼šå°†å…¶æŒ‚èµ·</p><p>Channel() å·¥å‚å‡½æ•°å’Œ produce æ„å»ºå™¨éƒ½é‡‡ç”¨å¯é€‰çš„å‚æ•° <code>capacity</code> æ¥æŒ‡å®šç¼“å†²åŒºå¤§å°ã€‚ ç¼“å†²ç”¨äºå…è®¸å‘é€è€…åœ¨æŒ‚èµ·ä¹‹å‰å‘é€å¤šä¸ªå…ƒç´ ï¼Œç±»ä¼¼äºå…·æœ‰æŒ‡å®šå®¹é‡çš„ BlockingQueueï¼Œå®ƒåœ¨ç¼“å†²åŒºå·²æ»¡æ—¶æ‰é˜»å¡</p><p>æŸ¥çœ‹ä»¥ä¸‹ä»£ç çš„æ•ˆæœï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//sampleStart</span>
    <span class="token keyword">val</span> channel <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// create buffered channel</span>
    <span class="token keyword">val</span> sender <span class="token operator">=</span> launch <span class="token punctuation">{</span> <span class="token comment">// launch sender coroutine</span>
        <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Sending </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">it</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// print before sending each element</span>
            channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token comment">// will suspend when buffer is full</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// don&#39;t receive anything... just wait....</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    sender<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cancel sender coroutine</span>
    <span class="token comment">//sampleEnd    </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨äº†å®¹é‡ä¸º4çš„ç¼“å†²é€šé“ï¼Œæ‰€ä»¥å°†æ‰“å°äº”æ¬¡ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>Sending <span class="token number">0</span>
Sending <span class="token number">1</span>
Sending <span class="token number">2</span>
Sending <span class="token number">3</span>
Sending <span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰å››ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°ç¼“å†²åŒºå†…ï¼Œsender åœ¨å°è¯•å‘é€ç¬¬äº”ä¸ªå…ƒç´ æ—¶æŒ‚èµ·</p><h1 id="ä¹ã€é€šé“æ˜¯å…¬å¹³çš„" tabindex="-1"><a class="header-anchor" href="#ä¹ã€é€šé“æ˜¯å…¬å¹³çš„" aria-hidden="true">#</a> ä¹ã€é€šé“æ˜¯å…¬å¹³çš„</h1><p>å¯¹é€šé“çš„å‘é€å’Œæ¥æ”¶æ“ä½œï¼Œå¯¹äºä»å¤šä¸ªåç¨‹è°ƒç”¨å®ƒä»¬çš„é¡ºåºæ˜¯å…¬å¹³çš„ã€‚å®ƒä»¬æŒ‰å…ˆå…¥å…ˆå‡ºçš„é¡ºåºæä¾›ï¼Œä¾‹å¦‚ï¼Œå…ˆè°ƒç”¨ receive çš„åç¨‹å…ˆè·å–åˆ°å…ƒç´ ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªåç¨‹ â€œpingâ€ å’Œ â€œpongâ€ ä»å…±äº«çš„ â€œtableâ€ é€šé“æ¥æ”¶ â€œballâ€ å¯¹è±¡</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token comment">//sampleStart</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Ball</span><span class="token punctuation">(</span><span class="token keyword">var</span> hits<span class="token operator">:</span> Int<span class="token punctuation">)</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token keyword">val</span> table <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>Ball<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a shared table</span>
    launch <span class="token punctuation">{</span> <span class="token function">player</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;ping&quot;</span></span><span class="token punctuation">,</span> table<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    launch <span class="token punctuation">{</span> <span class="token function">player</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;pong&quot;</span></span><span class="token punctuation">,</span> table<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    table<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">Ball</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// serve the ball</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// delay 1 second</span>
    coroutineContext<span class="token punctuation">.</span><span class="token function">cancelChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// game over, cancel them</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">player</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> table<span class="token operator">:</span> Channel<span class="token operator">&lt;</span>Ball<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>ball <span class="token keyword">in</span> table<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// receive the ball in a loop</span>
        ball<span class="token punctuation">.</span>hits<span class="token operator">++</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ball</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token comment">// wait a bit</span>
        table<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span> <span class="token comment">// send the ball back</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//sampleEnd</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€œpingâ€ åç¨‹é¦–å…ˆå¼€å§‹è¿è¡Œï¼Œæ‰€ä»¥å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ¥æ”¶åˆ° ball çš„ã€‚å³ä½¿ â€œpingâ€ åç¨‹åœ¨å°† ball é‡æ–°é€å›ç»™ table ååˆç«‹å³å¼€å§‹è¿›è¡Œ receiveï¼Œä½† ball è¿˜æ˜¯ä¼šè¢« â€œpongâ€ æ¥æ”¶åˆ°ï¼Œå› ä¸ºå®ƒå·²ç»å…ˆåœ¨ç­‰å¾…æ¥æ”¶äº†ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>ping <span class="token function">Ball</span><span class="token punctuation">(</span>hits<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
pong <span class="token function">Ball</span><span class="token punctuation">(</span>hits<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
ping <span class="token function">Ball</span><span class="token punctuation">(</span>hits<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
pong <span class="token function">Ball</span><span class="token punctuation">(</span>hits<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,66),v={href:"https://github.com/Kotlin/kotlinx.coroutines/issues/111",target:"_blank",rel:"noopener noreferrer"},b=t(`<h1 id="åã€è®¡æ—¶å™¨é€šé“" tabindex="-1"><a class="header-anchor" href="#åã€è®¡æ—¶å™¨é€šé“" aria-hidden="true">#</a> åã€è®¡æ—¶å™¨é€šé“</h1><p>è®¡æ—¶å™¨é€šé“æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¼šåˆ(rendezvous)é€šé“ï¼Œè‡ªè¯¥é€šé“çš„æœ€åä¸€æ¬¡æ¶ˆè€—ä»¥æ¥ï¼Œæ¯æ¬¡ç»™å®šçš„å»¶è¿Ÿæ—¶é—´ç»“æŸåéƒ½å°†è¿”å› Unit å€¼ã€‚å°½ç®¡å®ƒçœ‹èµ·æ¥æ˜¯æ— ç”¨å¤„çš„ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ„å»ºå—ï¼Œå¯ä»¥åˆ›å»ºå¤æ‚çš„åŸºäºæ—¶é—´çš„ produce ç®¡é“å’Œè¿›è¡Œçª—å£åŒ–æ“ä½œä»¥åŠå…¶å®ƒæ—¶é—´ç›¸å…³çš„å¤„ç†ã€‚è®¡æ—¶å™¨é€šé“å¯ç”¨äº select æ‰§è¡Œ â€œon tickâ€ æ“ä½œ</p><p>è¦åˆ›å»ºè¿™æ ·çš„é€šé“ï¼Œè¯·ä½¿ç”¨å·¥å‚æ–¹æ³• tickerã€‚å¦‚æœä¸éœ€è¦é€šé“å‘é€æ›´å¤šå…ƒç´ äº†ï¼Œè¯·å¯¹å…¶ä½¿ç”¨ ReceiveChannel.cancel å–æ¶ˆå‘é€</p><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®ƒåœ¨å®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> tickerChannel <span class="token operator">=</span> <span class="token function">ticker</span><span class="token punctuation">(</span>delayMillis <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> initialDelayMillis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// create ticker channel</span>
    <span class="token keyword">var</span> nextElement <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> tickerChannel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Initial element is available immediately: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">nextElement</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// initial delay hasn&#39;t passed yet</span>

    nextElement <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> tickerChannel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// all subsequent elements has 100ms delay</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Next element is not ready in 50 ms: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">nextElement</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    nextElement <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> tickerChannel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Next element is ready in 100 ms: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">nextElement</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Emulate large consumption delays</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Consumer pauses for 150ms&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span>
    <span class="token comment">// Next element is available immediately</span>
    nextElement <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> tickerChannel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Next element is available immediately after large consumer delay: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">nextElement</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token comment">// Note that the pause between \`receive\` calls is taken into account and next element arrives faster</span>
    nextElement <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> tickerChannel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> 
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Next element is ready in 50ms after consumer pause in 150ms: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">nextElement</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    tickerChannel<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// indicate that no more elements are needed</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>Initial element <span class="token keyword">is</span> available immediately<span class="token operator">:</span> kotlin<span class="token punctuation">.</span>Unit
Next element <span class="token keyword">is</span> not ready <span class="token keyword">in</span> <span class="token number">50</span> ms<span class="token operator">:</span> <span class="token keyword">null</span>
Next element <span class="token keyword">is</span> ready <span class="token keyword">in</span> <span class="token number">100</span> ms<span class="token operator">:</span> kotlin<span class="token punctuation">.</span>Unit
Consumer pauses <span class="token keyword">for</span> 150ms
Next element <span class="token keyword">is</span> available immediately after large consumer delay<span class="token operator">:</span> kotlin<span class="token punctuation">.</span>Unit
Next element <span class="token keyword">is</span> ready <span class="token keyword">in</span> 50ms after consumer pause <span class="token keyword">in</span> 150ms<span class="token operator">:</span> kotlin<span class="token punctuation">.</span>Unit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œticker èƒ½æ„ŸçŸ¥åˆ°æ¶ˆè´¹ç«¯å¯èƒ½å¤„äºæš‚åœçŠ¶æ€ï¼Œå¹¶ä¸”åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå‘ç”Ÿæš‚åœï¼Œå°†ä¼šå»¶è¿Ÿä¸‹ä¸€ä¸ªå…ƒç´ çš„ç”Ÿæˆï¼Œå°è¯•ä¿æŒç”Ÿæˆå…ƒç´ çš„å›ºå®šé€Ÿç‡</p><p>å¯é€‰çš„ï¼Œticker å‡½æ•°çš„ mode å‚æ•°å¯ä»¥æŒ‡å®šä¸º TickerMode.FIXED_DELAYï¼Œä»¥ä¿è¯å…ƒç´ ä¹‹é—´çš„å›ºå®šå»¶è¿Ÿ</p>`,9);function g(f,h){const a=o("ExternalLinkIcon");return c(),l("div",null,[n("blockquote",null,[n("p",null,[s("å…¬ä¼—å·ï¼š"),n("a",u,[s("å­—èŠ‚æ•°ç»„"),e(a)])]),r]),n("blockquote",null,[k,n("p",null,[s("åç¨‹å®˜æ–¹æ–‡æ¡£ï¼š"),n("a",d,[s("coroutines-guide"),e(a)])])]),m,n("p",null,[s("è¯·æ³¨æ„ï¼Œæœ‰æ—¶ç”±äºæ‰€ä½¿ç”¨çš„æ‰§è¡Œè€…çš„æ€§è´¨ï¼Œé€šé“å¯èƒ½ä¼šäº§ç”Ÿçœ‹èµ·æ¥ä¸å…¬å¹³çš„æ‰§è¡Œæ•ˆæœã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ "),n("a",v,[s("issue"),e(a)])]),b])}const x=p(i,[["render",g],["__file","Kotlin åç¨‹å®˜æ–¹æ–‡æ¡£ï¼ˆ6ï¼‰é€šé“.html.vue"]]);export{x as default};
