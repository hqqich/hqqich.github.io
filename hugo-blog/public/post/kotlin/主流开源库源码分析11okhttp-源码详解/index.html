<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><script src="/hugo-blog/public/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=hugo-blog/public/livereload" data-no-instant defer></script>
  <title>ä¸»æµå¼€æºåº“æºç åˆ†æï¼ˆ11ï¼‰OkHttp æºç è¯¦è§£ :: Hugo Theme Tailwind Example Site - Example site for hugo-theme-tailwind</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content=" \\ // \\ .ooo. // .@@@@@@@@@. :@@@@@@@@@@@@@: :@@. &#39;@@@@@&#39; .@@: @@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@ :@@ :@@@@@@@@@@@@@@@@@. @@: @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@@@@@@@@@@@@@@@ &#39;@@@@@@@@@@@@@@@&#39; @@@@ @@@@ @@@@ @@@@ @@@@ @@@@ &#39;@@&#39; &#39;@@&#39; :@@@. .@@@@@@@: &#43;@@ `@@ @@` @@ @@ .@@@@&#39;@@@@: &#43;@@ `@@ @@` @@ @@ @@@ @@@ &#43;@@ `@@ @@` @@ @@ .@@ @@: &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@;@@@@@ @@@ @@@ &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@@@@@@@@ @@@ @@@ &#43;@@ @@@ `@@@@@@@@@@` @@ @@ @@@ :@@ @@@ @@@ &#43;@@@@@ `@@@@@@@@@@` @@ @@ @@# @@&#43; @@@ @@@ &#43;@@@@@&#43; `@@ @@` @@ @@ @@: @@# @@: .@@` &#43;@@@&#43;@@ `@@ @@` @@ @@ @@# @@&#43; @@@. .@@@ &#43;@@ @@@ `@@ @@` @@ @@ @@@ ,@@ @@@@@@@@@ &#43;@@ @@@ `@@ @@` @@@@ @@@@ @@@@#@@@@ @@@@@@@ &#43;@@ #@@ `@@ @@` @@@@: @@@@: @@&#39;@@@@@ @@: @@: @@: å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
å¯¹äº Android Developer æ¥è¯´ï¼Œå¾ˆå¤šå¼€æºåº“éƒ½æ˜¯å±äºå¼€å‘å¿…å¤‡çš„çŸ¥è¯†ç‚¹ï¼Œä»ä½¿ç”¨æ–¹å¼åˆ°å®ç°åŸç†å†åˆ°æºç è§£æï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£å’Œè¿ç”¨èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—æ¥å†™ä¸€ç³»åˆ—å…³äºå¼€æºåº“æºç è§£æå’Œå®æˆ˜æ¼”ç»ƒçš„æ–‡ç« ï¼Œåˆå®šçš„ç›®æ ‡æ˜¯ EventBusã€ARouterã€LeakCanaryã€Retrofitã€Glideã€OkHttpã€Coil ç­‰ä¸ƒä¸ªçŸ¥åå¼€æºåº“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬æ–‡åŸºäº OkHttp çš„ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOkHttp å’Œ OkIO ç›®å‰å·²ç»è¢«å®˜æ–¹ç”¨ Kotlin è¯­è¨€é‡å†™äº†ä¸€éï¼Œæ‰€ä»¥è¿˜æ²¡å­¦ Kotlin çš„åŒå­¦å¯èƒ½è¿æºç éƒ½æ¯”è¾ƒéš¾çœ‹æ‡‚äº†ï¼ŒKotlin å…¥é—¨å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šä¸¤ä¸‡å…­åƒå­—å¸¦ä½  Kotlin å…¥é—¨ dependencies { implementation &#39;com.squareup.okhttp3:okhttp:4.9.0&#39; } å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œåé¢çš„è®²è§£éƒ½ä¼šåŸºäºè¿™ä¸ªä¾‹å­æ¶‰åŠåˆ°çš„æ¨¡å—æ¥å±•å¼€
/** * @Author: leavesCZY * @Githubï¼šhttps://github.com/leavesCZY */ const val URL = &#34;https://publicobject.com/helloworld.txt&#34; fun main() { val okHttClient = OkHttpClient.Builder() .connectTimeout(Duration.ofSeconds(10)) .readTimeout(Duration.ofSeconds(10)) .writeTimeout(Duration.ofSeconds(10)) .retryOnConnectionFailure(true) .build() val request = Request.Builder().url(URL).build() val call = okHttClient.newCall(request) val response = call.execute() println(response.body?.string()) } ä»¥ä¸Šä»£ç å°±å®Œæˆäº†ä¸€æ¬¡ Get è¯·æ±‚ï¼Œå…¶åŒ…å«çš„æ“ä½œæœ‰ï¼š
"
/>
<meta
  name="keywords"
  content="hugo, tailwind, tailwindcss, hugo theme, hugo theme tailwind"
/>
<meta name="robots" content="noodp" /><link rel="manifest" href="/manifest.json" /><meta property="og:url" content="http://localhost:1313/hugo-blog/public/post/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9011okhttp-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/">
  <meta property="og:site_name" content="Hugo Theme Tailwind Example Site">
  <meta property="og:title" content="ä¸»æµå¼€æºåº“æºç åˆ†æï¼ˆ11ï¼‰OkHttp æºç è¯¦è§£">
  <meta property="og:description" content="\\ // \\ .ooo. // .@@@@@@@@@. :@@@@@@@@@@@@@: :@@. &#39;@@@@@&#39; .@@: @@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@ :@@ :@@@@@@@@@@@@@@@@@. @@: @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@@@@@@@@@@@@@@@ &#39;@@@@@@@@@@@@@@@&#39; @@@@ @@@@ @@@@ @@@@ @@@@ @@@@ &#39;@@&#39; &#39;@@&#39; :@@@. .@@@@@@@: &#43;@@ `@@ @@` @@ @@ .@@@@&#39;@@@@: &#43;@@ `@@ @@` @@ @@ @@@ @@@ &#43;@@ `@@ @@` @@ @@ .@@ @@: &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@;@@@@@ @@@ @@@ &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@@@@@@@@ @@@ @@@ &#43;@@ @@@ `@@@@@@@@@@` @@ @@ @@@ :@@ @@@ @@@ &#43;@@@@@ `@@@@@@@@@@` @@ @@ @@# @@&#43; @@@ @@@ &#43;@@@@@&#43; `@@ @@` @@ @@ @@: @@# @@: .@@` &#43;@@@&#43;@@ `@@ @@` @@ @@ @@# @@&#43; @@@. .@@@ &#43;@@ @@@ `@@ @@` @@ @@ @@@ ,@@ @@@@@@@@@ &#43;@@ @@@ `@@ @@` @@@@ @@@@ @@@@#@@@@ @@@@@@@ &#43;@@ #@@ `@@ @@` @@@@: @@@@: @@&#39;@@@@@ @@: @@: @@: å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
å¯¹äº Android Developer æ¥è¯´ï¼Œå¾ˆå¤šå¼€æºåº“éƒ½æ˜¯å±äºå¼€å‘å¿…å¤‡çš„çŸ¥è¯†ç‚¹ï¼Œä»ä½¿ç”¨æ–¹å¼åˆ°å®ç°åŸç†å†åˆ°æºç è§£æï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£å’Œè¿ç”¨èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—æ¥å†™ä¸€ç³»åˆ—å…³äºå¼€æºåº“æºç è§£æå’Œå®æˆ˜æ¼”ç»ƒçš„æ–‡ç« ï¼Œåˆå®šçš„ç›®æ ‡æ˜¯ EventBusã€ARouterã€LeakCanaryã€Retrofitã€Glideã€OkHttpã€Coil ç­‰ä¸ƒä¸ªçŸ¥åå¼€æºåº“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬æ–‡åŸºäº OkHttp çš„ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOkHttp å’Œ OkIO ç›®å‰å·²ç»è¢«å®˜æ–¹ç”¨ Kotlin è¯­è¨€é‡å†™äº†ä¸€éï¼Œæ‰€ä»¥è¿˜æ²¡å­¦ Kotlin çš„åŒå­¦å¯èƒ½è¿æºç éƒ½æ¯”è¾ƒéš¾çœ‹æ‡‚äº†ï¼ŒKotlin å…¥é—¨å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šä¸¤ä¸‡å…­åƒå­—å¸¦ä½  Kotlin å…¥é—¨ dependencies { implementation &#39;com.squareup.okhttp3:okhttp:4.9.0&#39; } å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œåé¢çš„è®²è§£éƒ½ä¼šåŸºäºè¿™ä¸ªä¾‹å­æ¶‰åŠåˆ°çš„æ¨¡å—æ¥å±•å¼€
/** * @Author: leavesCZY * @Githubï¼šhttps://github.com/leavesCZY */ const val URL = &#34;https://publicobject.com/helloworld.txt&#34; fun main() { val okHttClient = OkHttpClient.Builder() .connectTimeout(Duration.ofSeconds(10)) .readTimeout(Duration.ofSeconds(10)) .writeTimeout(Duration.ofSeconds(10)) .retryOnConnectionFailure(true) .build() val request = Request.Builder().url(URL).build() val call = okHttClient.newCall(request) val response = call.execute() println(response.body?.string()) } ä»¥ä¸Šä»£ç å°±å®Œæˆäº†ä¸€æ¬¡ Get è¯·æ±‚ï¼Œå…¶åŒ…å«çš„æ“ä½œæœ‰ï¼š">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ä¸»æµå¼€æºåº“æºç åˆ†æï¼ˆ11ï¼‰OkHttp æºç è¯¦è§£">
  <meta name="twitter:description" content="\\ // \\ .ooo. // .@@@@@@@@@. :@@@@@@@@@@@@@: :@@. &#39;@@@@@&#39; .@@: @@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@ :@@ :@@@@@@@@@@@@@@@@@. @@: @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@ &#39;@@@@@@@@@@@@@@@@@, @@@ @@@@@@@@@@@@@@@@@ &#39;@@@@@@@@@@@@@@@&#39; @@@@ @@@@ @@@@ @@@@ @@@@ @@@@ &#39;@@&#39; &#39;@@&#39; :@@@. .@@@@@@@: &#43;@@ `@@ @@` @@ @@ .@@@@&#39;@@@@: &#43;@@ `@@ @@` @@ @@ @@@ @@@ &#43;@@ `@@ @@` @@ @@ .@@ @@: &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@;@@@@@ @@@ @@@ &#43;@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@@@@@@@@ @@@ @@@ &#43;@@ @@@ `@@@@@@@@@@` @@ @@ @@@ :@@ @@@ @@@ &#43;@@@@@ `@@@@@@@@@@` @@ @@ @@# @@&#43; @@@ @@@ &#43;@@@@@&#43; `@@ @@` @@ @@ @@: @@# @@: .@@` &#43;@@@&#43;@@ `@@ @@` @@ @@ @@# @@&#43; @@@. .@@@ &#43;@@ @@@ `@@ @@` @@ @@ @@@ ,@@ @@@@@@@@@ &#43;@@ @@@ `@@ @@` @@@@ @@@@ @@@@#@@@@ @@@@@@@ &#43;@@ #@@ `@@ @@` @@@@: @@@@: @@&#39;@@@@@ @@: @@: @@: å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
å¯¹äº Android Developer æ¥è¯´ï¼Œå¾ˆå¤šå¼€æºåº“éƒ½æ˜¯å±äºå¼€å‘å¿…å¤‡çš„çŸ¥è¯†ç‚¹ï¼Œä»ä½¿ç”¨æ–¹å¼åˆ°å®ç°åŸç†å†åˆ°æºç è§£æï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£å’Œè¿ç”¨èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—æ¥å†™ä¸€ç³»åˆ—å…³äºå¼€æºåº“æºç è§£æå’Œå®æˆ˜æ¼”ç»ƒçš„æ–‡ç« ï¼Œåˆå®šçš„ç›®æ ‡æ˜¯ EventBusã€ARouterã€LeakCanaryã€Retrofitã€Glideã€OkHttpã€Coil ç­‰ä¸ƒä¸ªçŸ¥åå¼€æºåº“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬æ–‡åŸºäº OkHttp çš„ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOkHttp å’Œ OkIO ç›®å‰å·²ç»è¢«å®˜æ–¹ç”¨ Kotlin è¯­è¨€é‡å†™äº†ä¸€éï¼Œæ‰€ä»¥è¿˜æ²¡å­¦ Kotlin çš„åŒå­¦å¯èƒ½è¿æºç éƒ½æ¯”è¾ƒéš¾çœ‹æ‡‚äº†ï¼ŒKotlin å…¥é—¨å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šä¸¤ä¸‡å…­åƒå­—å¸¦ä½  Kotlin å…¥é—¨ dependencies { implementation &#39;com.squareup.okhttp3:okhttp:4.9.0&#39; } å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œåé¢çš„è®²è§£éƒ½ä¼šåŸºäºè¿™ä¸ªä¾‹å­æ¶‰åŠåˆ°çš„æ¨¡å—æ¥å±•å¼€
/** * @Author: leavesCZY * @Githubï¼šhttps://github.com/leavesCZY */ const val URL = &#34;https://publicobject.com/helloworld.txt&#34; fun main() { val okHttClient = OkHttpClient.Builder() .connectTimeout(Duration.ofSeconds(10)) .readTimeout(Duration.ofSeconds(10)) .writeTimeout(Duration.ofSeconds(10)) .retryOnConnectionFailure(true) .build() val request = Request.Builder().url(URL).build() val call = okHttClient.newCall(request) val response = call.execute() println(response.body?.string()) } ä»¥ä¸Šä»£ç å°±å®Œæˆäº†ä¸€æ¬¡ Get è¯·æ±‚ï¼Œå…¶åŒ…å«çš„æ“ä½œæœ‰ï¼š">


<link rel="canonical" href="http://localhost:1313/hugo-blog/public/post/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9011okhttp-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/" />

<link rel="shortcut icon" href="/hugo-blog/public/favicon.ico" />
<link rel="stylesheet" href="/hugo-blog/public/css/index.c3a5d1586276a68cf55558ab67f2c726fee27f4aea3add1802872f471c5f233d.css">









  
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Xiaoliang Wang"},"dateModified":"0001-01-01T00:00:00Z","datePublished":"0001-01-01T00:00:00Z","description":" \\\\ // \\\\ .ooo. // .@@@@@@@@@. :@@@@@@@@@@@@@: :@@. \u0026#39;@@@@@\u0026#39; .@@: @@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@ :@@ :@@@@@@@@@@@@@@@@@. @@: @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@ \u0026#39;@@@@@@@@@@@@@@@@@, @@@ @@@@@@@@@@@@@@@@@ \u0026#39;@@@@@@@@@@@@@@@\u0026#39; @@@@ @@@@ @@@@ @@@@ @@@@ @@@@ \u0026#39;@@\u0026#39; \u0026#39;@@\u0026#39; :@@@. .@@@@@@@: +@@ `@@ @@` @@ @@ .@@@@\u0026#39;@@@@: +@@ `@@ @@` @@ @@ @@@ @@@ +@@ `@@ @@` @@ @@ .@@ @@: +@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@;@@@@@ @@@ @@@ +@@ @@@ `@@ @@` @@@@@@ @@@@@@ @@@@@@@@@ @@@ @@@ +@@ @@@ `@@@@@@@@@@` @@ @@ @@@ :@@ @@@ @@@ +@@@@@ `@@@@@@@@@@` @@ @@ @@# @@+ @@@ @@@ +@@@@@+ `@@ @@` @@ @@ @@: @@# @@: .@@` +@@@+@@ `@@ @@` @@ @@ @@# @@+ @@@. .@@@ +@@ @@@ `@@ @@` @@ @@ @@@ ,@@ @@@@@@@@@ +@@ @@@ `@@ @@` @@@@ @@@@ @@@@#@@@@ @@@@@@@ +@@ #@@ `@@ @@` @@@@: @@@@: @@\u0026#39;@@@@@ @@: @@: @@: å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£\nå¯¹äº Android Developer æ¥è¯´ï¼Œå¾ˆå¤šå¼€æºåº“éƒ½æ˜¯å±äºå¼€å‘å¿…å¤‡çš„çŸ¥è¯†ç‚¹ï¼Œä»ä½¿ç”¨æ–¹å¼åˆ°å®ç°åŸç†å†åˆ°æºç è§£æï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£å’Œè¿ç”¨èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—æ¥å†™ä¸€ç³»åˆ—å…³äºå¼€æºåº“æºç è§£æå’Œå®æˆ˜æ¼”ç»ƒçš„æ–‡ç« ï¼Œåˆå®šçš„ç›®æ ‡æ˜¯ EventBusã€ARouterã€LeakCanaryã€Retrofitã€Glideã€OkHttpã€Coil ç­‰ä¸ƒä¸ªçŸ¥åå¼€æºåº“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£\næœ¬æ–‡åŸºäº OkHttp çš„ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOkHttp å’Œ OkIO ç›®å‰å·²ç»è¢«å®˜æ–¹ç”¨ Kotlin è¯­è¨€é‡å†™äº†ä¸€éï¼Œæ‰€ä»¥è¿˜æ²¡å­¦ Kotlin çš„åŒå­¦å¯èƒ½è¿æºç éƒ½æ¯”è¾ƒéš¾çœ‹æ‡‚äº†ï¼ŒKotlin å…¥é—¨å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šä¸¤ä¸‡å…­åƒå­—å¸¦ä½  Kotlin å…¥é—¨ dependencies { implementation \u0026#39;com.squareup.okhttp3:okhttp:4.9.0\u0026#39; } å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œåé¢çš„è®²è§£éƒ½ä¼šåŸºäºè¿™ä¸ªä¾‹å­æ¶‰åŠåˆ°çš„æ¨¡å—æ¥å±•å¼€\n/** * @Author: leavesCZY * @Githubï¼šhttps://github.com/leavesCZY */ const val URL = \u0026#34;https://publicobject.com/helloworld.txt\u0026#34; fun main() { val okHttClient = OkHttpClient.Builder() .connectTimeout(Duration.ofSeconds(10)) .readTimeout(Duration.ofSeconds(10)) .writeTimeout(Duration.ofSeconds(10)) .retryOnConnectionFailure(true) .build() val request = Request.Builder().url(URL).build() val call = okHttClient.newCall(request) val response = call.execute() println(response.body?.string()) } ä»¥ä¸Šä»£ç å°±å®Œæˆäº†ä¸€æ¬¡ Get è¯·æ±‚ï¼Œå…¶åŒ…å«çš„æ“ä½œæœ‰ï¼š\n","name":"ä¸»æµå¼€æºåº“æºç åˆ†æï¼ˆ11ï¼‰OkHttp æºç è¯¦è§£","url":"http://localhost:1313/hugo-blog/public/post/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9011okhttp-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/"}
</script>

</head>
<body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800">
    
<div class="fixed right-0 top-0 z-50 flex items-center justify-center bg-gray-200 p-2 text-sm uppercase text-black sm:bg-red-200 md:bg-yellow-200 lg:bg-green-200 xl:bg-blue-200 2xl:bg-pink-200">
  <span class="block sm:hidden">all</span>
  <span class="hidden sm:block md:hidden">sm</span>
  <span class="hidden md:block lg:hidden">md</span>
  <span class="hidden lg:block xl:hidden">lg</span>
  <span class="hidden xl:block 2xl:hidden">xl</span>
  <span class="hidden 2xl:block">2xl</span>
</div>

  <header class="flex flex-none justify-center z-10">
    <div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3">
  <div class="flex-none ml-2 md:ml-0">
    <a href="/hugo-blog/public/" class="">
      <img class="h-12 w-12 rounded-full object-cover bg-gray-100" src="/hugo-blog/public/logo.svg" alt="logo">
    </a>
  </div>
  
  <h1 class="hidden md:flex flex-col justify-center mx-2">
    <a href="/hugo-blog/public/" class="text-2xl font-semibold text-slate-800 dark:text-slate-200">
      Hugo Theme Tailwind
    </a>
  </h1>
  
  <div class="flex-1"></div>
  <div class="flex-none">
    



<nav class="h-full static">
  <button id="navbar-menu-toggle" type="button" class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls="navbar-menu" aria-expanded="false">
    <span class="sr-only">Open main menu</span>
    <i class="w-8 h-8">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 6l16 0" />
  <path d="M4 12l16 0" />
  <path d="M4 18l16 0" />
</svg>

    </i>
  </button>
  <div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id="navbar-menu">
    <ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-xs md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5">
    
        <li id="post" class="">
          <a class="block px-3 py-3 hover:text-emerald-600 text-emerald-600"
            href="/hugo-blog/public/post/" title="Post">Post</a>
        </li>
      
    
        <li id="about" class="">
          <a class="block px-3 py-3 hover:text-emerald-600"
            href="/hugo-blog/public/about/" title="About">About</a>
        </li>
      
    
    </ul>
  </div>
</nav>


  </div>
  
  <div class="flex-none">
    <div class="h-full static">
      <button id="navbar-lang-toggle" type="button" class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
        <span class="sr-only">Open language switcher</span>
        <i class="w-8 h-8">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c0 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>

        </i>
      </button>
      <div class="absolute hidden top-16 z-50" id="navbar-lang">
        <ul class="flex flex-col rounded-xs px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5">
          <li class="">
            <span class="block px-3 py-3 cursor-default hover:text-emerald-600">English</span>
            </li>
        
        </ul>
      </div>
    </div>
  </div>
  
  <div class="flex-none md:hidden">
    <a href=/hugo-blog/public/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
      <span class="sr-only">Search</span>
      <i class="w-8 h-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
    <path d="M21 21l-6 -6" />
</svg>

      </i>
    </a>
  </div>
  <div class="darkmode-toggle flex flex-none mr-2 md:mr-0">
    <label for="darkmode-toggle" class="relative flex items-center gap-1 px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode">
      <input name="darkmode-toggle" id="darkmode-toggle" type="checkbox" class="sr-only peer" aria-label="Toggle dark mode">
      <div class="absolute z-10 w-15 h-8 rounded-full bg-white dark:bg-gray-700"></div>
      <i class="h-6 w-6 z-20 ml-1 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:invisible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
   <path d="M12 5l0 .01"></path>
   <path d="M17 7l0 .01"></path>
   <path d="M19 12l0 .01"></path>
   <path d="M17 17l0 .01"></path>
   <path d="M12 19l0 .01"></path>
   <path d="M7 17l0 .01"></path>
   <path d="M5 12l0 .01"></path>
   <path d="M7 7l0 .01"></path>
</svg>

      </i>
      <i class="h-6 w-6 z-20 mr-1 flex-none rounded-full place-self-center invisible peer-checked:visible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
   <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
   <path d="M19 11h2m-1 -1v2"></path>
</svg>

      </i>
    </label>
  </div>
</div>

  </header>
  <main class="flex flex-auto justify-center">
    
<div id="progress" class="fixed top-0 left-0 w-full h-1 bg-blue-500"></div>
<div class="w-full max-w-4xl lg:max-w-5xl">
  <div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700">
    <div>
      <a href="/hugo-blog/public/post/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9011okhttp-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/">
        
      </a>
    </div>
    <div class="flex flex-col gap-y-3 p-6">
      <h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100">
        <a href="/hugo-blog/public/post/kotlin/%E4%B8%BB%E6%B5%81%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9011okhttp-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/">ä¸»æµå¼€æºåº“æºç åˆ†æï¼ˆ11ï¼‰OkHttp æºç è¯¦è§£</a>
      </h1>

      
      


      <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M6.5 7h11"></path>
   <path d="M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z"></path>
   <path d="M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z"></path>
</svg>

    </i>
    <span>
      13 minutes to read
    </span>
  </div>
</div>

      <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
    class="icon icon-tabler icons-tabler-outline icon-tabler-user">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>

    </i>
    <span>Xiaoliang Wang</span>
  </div>
</div>

      
        
        <section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6">
          <h2>Table of Contents</h2>
          <aside><nav id="TableOfContents">
  <ul>
    <li><a href="#1åŒæ­¥è¯·æ±‚">1ã€åŒæ­¥è¯·æ±‚</a></li>
    <li><a href="#2å¼‚æ­¥è¯·æ±‚">2ã€å¼‚æ­¥è¯·æ±‚</a></li>
    <li><a href="#3arraydeque">3ã€ArrayDeque</a></li>
    <li><a href="#4çº¿ç¨‹æ± ">4ã€çº¿ç¨‹æ± </a></li>
    <li><a href="#5æ¨åŠ¨è¯·æ±‚æ‰§è¡Œ">5ã€æ¨åŠ¨è¯·æ±‚æ‰§è¡Œ</a></li>
    <li><a href="#6æ€»ç»“">6ã€æ€»ç»“</a></li>
  </ul>
</nav></aside>
        </section>
        
      

      <article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content">
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">                         <span class="err">\\</span>           <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                          <span class="err">\\</span>  <span class="p">.</span><span class="n">ooo</span><span class="p">.</span>  <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                           <span class="p">.</span><span class="err">@@@@@@@@@</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">                         <span class="p">:</span><span class="err">@@@@@@@@@@@@@</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="p">:</span><span class="err">@@</span><span class="p">.</span> <span class="err">&#39;@@@@@&#39;</span> <span class="p">.</span><span class="err">@@</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="err">@@@@@@@@@@@@@@@@@</span>
</span></span><span class="line"><span class="cl">                        <span class="err">@@@@@@@@@@@@@@@@@</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                   <span class="p">:</span><span class="err">@@</span> <span class="p">:</span><span class="err">@@@@@@@@@@@@@@@@@</span><span class="p">.</span> <span class="err">@@</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                   <span class="err">@@@</span> <span class="err">&#39;@@@@@@@@@@@@@@@@@</span><span class="p">,</span> <span class="err">@@@</span>
</span></span><span class="line"><span class="cl">                        <span class="err">@@@@@@@@@@@@@@@@@</span>
</span></span><span class="line"><span class="cl">                        <span class="err">&#39;@@@@@@@@@@@@@@@&#39;</span>
</span></span><span class="line"><span class="cl">                           <span class="err">@@@@</span>   <span class="err">@@@@</span>
</span></span><span class="line"><span class="cl">                           <span class="err">@@@@</span>   <span class="err">@@@@</span>
</span></span><span class="line"><span class="cl">                           <span class="err">@@@@</span>   <span class="err">@@@@</span>
</span></span><span class="line"><span class="cl">                           <span class="err">&#39;@@&#39;</span>   <span class="err">&#39;@@&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">:</span><span class="err">@@@</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">   <span class="p">.</span><span class="err">@@@@@@@</span><span class="p">:</span>   <span class="p">+</span><span class="err">@@</span>       <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="err">@@@@&#39;@@@@</span><span class="p">:</span>  <span class="p">+</span><span class="err">@@</span>       <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>
</span></span><span class="line"><span class="cl">  <span class="err">@@@</span>     <span class="err">@@@</span>  <span class="p">+</span><span class="err">@@</span>       <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>
</span></span><span class="line"><span class="cl"> <span class="p">.</span><span class="err">@@</span>       <span class="err">@@</span><span class="p">:</span> <span class="p">+</span><span class="err">@@</span>   <span class="err">@@@</span> <span class="err">`@@</span>      <span class="err">@@`</span> <span class="err">@@@@@@</span> <span class="err">@@@@@@</span>  <span class="err">@@</span><span class="p">;</span><span class="err">@@@@@</span>
</span></span><span class="line"><span class="cl"> <span class="err">@@@</span>       <span class="err">@@@</span> <span class="p">+</span><span class="err">@@</span>  <span class="err">@@@</span>  <span class="err">`@@</span>      <span class="err">@@`</span> <span class="err">@@@@@@</span> <span class="err">@@@@@@</span>  <span class="err">@@@@@@@@@</span>
</span></span><span class="line"><span class="cl"> <span class="err">@@@</span>       <span class="err">@@@</span> <span class="p">+</span><span class="err">@@</span> <span class="err">@@@</span>   <span class="err">`@@@@@@@@@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>    <span class="err">@@@</span>   <span class="p">:</span><span class="err">@@</span>
</span></span><span class="line"><span class="cl"> <span class="err">@@@</span>       <span class="err">@@@</span> <span class="p">+</span><span class="err">@@@@@</span>    <span class="err">`@@@@@@@@@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>    <span class="err">@@#</span>    <span class="err">@@</span><span class="p">+</span>
</span></span><span class="line"><span class="cl"> <span class="err">@@@</span>       <span class="err">@@@</span> <span class="p">+</span><span class="err">@@@@@</span><span class="p">+</span>   <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>    <span class="err">@@</span><span class="p">:</span>    <span class="err">@@#</span>
</span></span><span class="line"><span class="cl">  <span class="err">@@</span><span class="p">:</span>     <span class="p">.</span><span class="err">@@`</span> <span class="p">+</span><span class="err">@@@</span><span class="p">+</span><span class="err">@@</span>   <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>    <span class="err">@@#</span>    <span class="err">@@</span><span class="p">+</span>
</span></span><span class="line"><span class="cl">  <span class="err">@@@</span><span class="p">.</span>   <span class="p">.</span><span class="err">@@@</span>  <span class="p">+</span><span class="err">@@</span>  <span class="err">@@@</span>  <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@</span>     <span class="err">@@</span>    <span class="err">@@@</span>   <span class="p">,</span><span class="err">@@</span>
</span></span><span class="line"><span class="cl">   <span class="err">@@@@@@@@@</span>   <span class="p">+</span><span class="err">@@</span>   <span class="err">@@@</span> <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@@@</span>   <span class="err">@@@@</span>  <span class="err">@@@@#@@@@</span>
</span></span><span class="line"><span class="cl">    <span class="err">@@@@@@@</span>    <span class="p">+</span><span class="err">@@</span>   <span class="err">#@@</span> <span class="err">`@@</span>      <span class="err">@@`</span>   <span class="err">@@@@</span><span class="p">:</span>  <span class="err">@@@@</span><span class="p">:</span> <span class="err">@@&#39;@@@@@</span>
</span></span><span class="line"><span class="cl">                                                     <span class="err">@@</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                                     <span class="err">@@</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                                     <span class="err">@@</span><span class="p">:</span>
</span></span></code></pre></div><blockquote>
<p>å…¬ä¼—å·ï¼š<a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" rel="noopener">å­—èŠ‚æ•°ç»„</a>
</p>
<p>å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£</p></blockquote>
<blockquote>
<p>å¯¹äº Android Developer æ¥è¯´ï¼Œå¾ˆå¤šå¼€æºåº“éƒ½æ˜¯å±äº<strong>å¼€å‘å¿…å¤‡</strong>çš„çŸ¥è¯†ç‚¹ï¼Œä»ä½¿ç”¨æ–¹å¼åˆ°å®ç°åŸç†å†åˆ°æºç è§£æï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£å’Œè¿ç”¨èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—æ¥å†™ä¸€ç³»åˆ—å…³äºå¼€æºåº“<strong>æºç è§£æ</strong>å’Œ<strong>å®æˆ˜æ¼”ç»ƒ</strong>çš„æ–‡ç« ï¼Œåˆå®šçš„ç›®æ ‡æ˜¯ <strong>EventBusã€ARouterã€LeakCanaryã€Retrofitã€Glideã€OkHttpã€Coil</strong> ç­‰ä¸ƒä¸ªçŸ¥åå¼€æºåº“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£</p></blockquote>
<p>æœ¬æ–‡åŸºäº OkHttp çš„ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒOkHttp å’Œ OkIO ç›®å‰å·²ç»è¢«å®˜æ–¹ç”¨ Kotlin è¯­è¨€é‡å†™äº†ä¸€éï¼Œæ‰€ä»¥è¿˜æ²¡å­¦ Kotlin çš„åŒå­¦å¯èƒ½è¿æºç éƒ½æ¯”è¾ƒéš¾çœ‹æ‡‚äº†ï¼ŒKotlin å…¥é—¨å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/6880602489297895438" target="_blank" rel="noopener">ä¸¤ä¸‡å…­åƒå­—å¸¦ä½  Kotlin å…¥é—¨</a>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="s1">&#39;com.squareup.okhttp3:okhttp:4.9.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œåé¢çš„è®²è§£éƒ½ä¼šåŸºäºè¿™ä¸ªä¾‹å­æ¶‰åŠåˆ°çš„æ¨¡å—æ¥å±•å¼€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @Author: leavesCZY
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @Githubï¼šhttps://github.com/leavesCZY
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="k">val</span> <span class="py">URL</span> <span class="p">=</span> <span class="s2">&#34;https://publicobject.com/helloworld.txt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">okHttClient</span> <span class="p">=</span> <span class="nc">OkHttpClient</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">connectTimeout</span><span class="p">(</span><span class="nc">Duration</span><span class="p">.</span><span class="n">ofSeconds</span><span class="p">(</span><span class="m">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">readTimeout</span><span class="p">(</span><span class="nc">Duration</span><span class="p">.</span><span class="n">ofSeconds</span><span class="p">(</span><span class="m">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">writeTimeout</span><span class="p">(</span><span class="nc">Duration</span><span class="p">.</span><span class="n">ofSeconds</span><span class="p">(</span><span class="m">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">retryOnConnectionFailure</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">Request</span><span class="p">.</span><span class="n">Builder</span><span class="p">().</span><span class="n">url</span><span class="p">(</span><span class="n">URL</span><span class="p">).</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">call</span> <span class="p">=</span> <span class="n">okHttClient</span><span class="p">.</span><span class="n">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">call</span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="o">?.</span><span class="n">string</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä»¥ä¸Šä»£ç å°±å®Œæˆäº†ä¸€æ¬¡ Get è¯·æ±‚ï¼Œå…¶åŒ…å«çš„æ“ä½œæœ‰ï¼š</p>
<ol>
<li>é€šè¿‡ Builder æ¨¡å¼å¾—åˆ° OkHttpClientï¼ŒOkHttpClient åŒ…å«äº†å¯¹ç½‘ç»œè¯·æ±‚çš„å…¨å±€é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <strong>é“¾æ¥è¶…æ—¶æ—¶é—´ã€è¯»å†™è¶…æ—¶æ—¶é—´ã€é“¾æ¥å¤±è´¥é‡è¯•</strong> ç­‰å„ç§é…ç½®</li>
<li>é€šè¿‡ Builder æ¨¡å¼å¾—åˆ° Requestï¼ŒRequest åŒ…å«äº†æœ¬æ¬¡ç½‘ç»œè¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬ <strong>urlã€methodã€headersã€body</strong> ç­‰</li>
<li>é€šè¿‡ newCall æ–¹æ³•å¾—åˆ° Callï¼ŒCall å°±ç”¨äºå‘èµ·è¯·æ±‚ï¼Œå¯ç”¨äºæ‰§è¡Œ <strong>åŒæ­¥è¯·æ±‚ï¼ˆexecuteï¼‰ã€å¼‚æ­¥è¯·æ±‚ï¼ˆenqueueï¼‰ã€å–æ¶ˆè¯·æ±‚ï¼ˆcancelï¼‰</strong> ç­‰å„ç§æ“ä½œ</li>
<li>è°ƒç”¨ execute æ–¹æ³•å‘èµ·åŒæ­¥è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ª Response å¯¹è±¡ï¼ŒResponse å°±åŒ…å«äº†æ­¤æ¬¡ç½‘ç»œè¯·æ±‚çš„æ‰€æœ‰è¿”å›ä¿¡æ¯ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥çš„è¯æ­¤æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li>æ‹¿åˆ° Response å¯¹è±¡çš„ body å¹¶ä»¥å­—ç¬¦ä¸²æµçš„æ–¹å¼è¿›è¡Œè¯»å–ï¼Œæ‰“å°ç»“æœå³æ–‡ç« å¼€å¤´çš„ Android æœºå™¨äººå½©è›‹</li>
</ol>
<h1 id="ä¸€okhttpclient">ä¸€ã€OkHttpClient</h1>
<p>OkHttpClient ä½¿ç”¨äº† Builder æ¨¡å¼æ¥å®Œæˆåˆå§‹åŒ–ï¼Œå…¶æä¾›äº†å¾ˆå¤šçš„é…ç½®å‚æ•°ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œæ‰€ä»¥ä¹Ÿæœ‰å¿…è¦æ¥äº†è§£ä¸‹å…¶åŒ…å«çš„æ‰€æœ‰å‚æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Builder</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è°ƒåº¦å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">dispatcher</span><span class="p">:</span> <span class="n">Dispatcher</span> <span class="p">=</span> <span class="n">Dispatcher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿æ¥æ± 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">connectionPool</span><span class="p">:</span> <span class="n">ConnectionPool</span> <span class="p">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ‹¦æˆªå™¨åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">val</span> <span class="py">interceptors</span><span class="p">:</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç½‘ç»œæ‹¦æˆªå™¨åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">val</span> <span class="py">networkInterceptors</span><span class="p">:</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//äº‹ä»¶ç›‘å¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">eventListenerFactory</span><span class="p">:</span> <span class="nc">EventListener</span><span class="p">.</span><span class="n">Factory</span> <span class="p">=</span> <span class="nc">EventListener</span><span class="p">.</span><span class="nc">NONE</span><span class="p">.</span><span class="n">asFactory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿æ¥å¤±è´¥çš„æ—¶å€™æ˜¯å¦é‡è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">retryOnConnectionFailure</span> <span class="p">=</span> <span class="k">true</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">//æºæœåŠ¡å™¨èº«ä»½éªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">authenticator</span><span class="p">:</span> <span class="n">Authenticator</span> <span class="p">=</span> <span class="nc">Authenticator</span><span class="p">.</span><span class="n">NONE</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ˜¯å¦å…è®¸é‡å®šå‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">followRedirects</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ˜¯å¦å…è®¸sslé‡å®šå‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">followSslRedirects</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Cookie
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">cookieJar</span><span class="p">:</span> <span class="n">CookieJar</span> <span class="p">=</span> <span class="nc">CookieJar</span><span class="p">.</span><span class="n">NO_COOKIES</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç¼“å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">cache</span><span class="p">:</span> <span class="n">Cache</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//DNS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">dns</span><span class="p">:</span> <span class="n">Dns</span> <span class="p">=</span> <span class="nc">Dns</span><span class="p">.</span><span class="n">SYSTEM</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä»£ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">proxy</span><span class="p">:</span> <span class="n">Proxy</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä»£ç†é€‰æ‹©å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">proxySelector</span><span class="p">:</span> <span class="n">ProxySelector</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä»£ç†èº«ä»½éªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">proxyAuthenticator</span><span class="p">:</span> <span class="n">Authenticator</span> <span class="p">=</span> <span class="nc">Authenticator</span><span class="p">.</span><span class="n">NONE</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Socketå·¥å‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">socketFactory</span><span class="p">:</span> <span class="n">SocketFactory</span> <span class="p">=</span> <span class="nc">SocketFactory</span><span class="p">.</span><span class="n">getDefault</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å®‰å…¨å¥—æ¥å±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">sslSocketFactoryOrNull</span><span class="p">:</span> <span class="n">SSLSocketFactory</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">x509TrustManagerOrNull</span><span class="p">:</span> <span class="n">X509TrustManager</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">connectionSpecs</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ConnectionSpec</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">DEFAULT_CONNECTION_SPECS</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//HTTP åè®®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">protocols</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Protocol</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">DEFAULT_PROTOCOLS</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä¸»æœºåå­—ç¡®è®¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">hostnameVerifier</span><span class="p">:</span> <span class="n">HostnameVerifier</span> <span class="p">=</span> <span class="n">OkHostnameVerifier</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è¯ä¹¦é“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">certificatePinner</span><span class="p">:</span> <span class="n">CertificatePinner</span> <span class="p">=</span> <span class="nc">CertificatePinner</span><span class="p">.</span><span class="n">DEFAULT</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">certificateChainCleaner</span><span class="p">:</span> <span class="n">CertificateChainCleaner</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">callTimeout</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">connectTimeout</span> <span class="p">=</span> <span class="m">10</span><span class="n">_000</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è¯»è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">readTimeout</span> <span class="p">=</span> <span class="m">10</span><span class="n">_000</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å†™è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">writeTimeout</span> <span class="p">=</span> <span class="m">10</span><span class="n">_000</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ping ä¹‹é—´çš„æ—¶é—´é—´éš”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">internal</span> <span class="k">var</span> <span class="py">pingInterval</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">minWebSocketMessageToCompress</span> <span class="p">=</span> <span class="nc">RealWebSocket</span><span class="p">.</span><span class="n">DEFAULT_MINIMUM_DEFLATE_SIZE</span>
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">var</span> <span class="py">routeDatabase</span><span class="p">:</span> <span class="n">RouteDatabase</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="äºŒrequest">äºŒã€Request</h1>
<p>Request åŒ…å«äº†ç½‘ç»œè¯·æ±‚æ—¶çš„æ‰€æœ‰è¯·æ±‚å‚æ•°ï¼Œä¸€å…±åŒ…å«ä»¥ä¸‹äº”ä¸ªï¼š</p>
<ol>
<li>urlã€‚å³æœ¬æ¬¡çš„ç½‘ç»œè¯·æ±‚åœ°å€ä»¥åŠå¯èƒ½åŒ…å«çš„ query é”®å€¼å¯¹</li>
<li>methodã€‚å³è¯·æ±‚æ–¹å¼ï¼Œå¯é€‰å‚æ•°æœ‰ GETã€HEADã€POSTã€DELETEã€PUTã€PATCH</li>
<li>headersã€‚å³è¯·æ±‚å¤´ï¼Œå¯ç”¨æ¥å­˜ tokenã€æ—¶é—´æˆ³ç­‰</li>
<li>bodyã€‚å³è¯·æ±‚ä½“</li>
<li>tagsã€‚å¯ç”¨æ¥å”¯ä¸€æ ‡è¯†æœ¬æ¬¡è¯·æ±‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">var</span> <span class="py">url</span><span class="p">:</span> <span class="n">HttpUrl</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">var</span> <span class="py">method</span><span class="p">:</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">var</span> <span class="py">headers</span><span class="p">:</span> <span class="nc">Headers</span><span class="p">.</span><span class="n">Builder</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">var</span> <span class="py">body</span><span class="p">:</span> <span class="n">RequestBody</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="cm">/** A mutable map of tags, or an immutable empty map if we don&#39;t have any. */</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">var</span> <span class="py">tags</span><span class="p">:</span> <span class="n">MutableMap</span><span class="p">&lt;</span><span class="n">Class</span><span class="p">&lt;*&gt;,</span> <span class="n">Any</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">()</span>
</span></span></code></pre></div><h1 id="ä¸‰call">ä¸‰ã€Call</h1>
<p>å½“è°ƒç”¨ <code>okHttClient.newCall(request)</code>æ—¶å°±ä¼šå¾—åˆ°ä¸€ä¸ª Call å¯¹è±¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/** Prepares the [request] to be executed at some point in the future. */</span>
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Call</span> <span class="p">=</span> <span class="n">RealCall</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">forWebSocket</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
</span></span></code></pre></div><p>Call æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹åšæ˜¯ç½‘ç»œè¯·æ±‚çš„å¯åŠ¨å™¨ï¼Œå¯ç”¨äºå‘èµ·åŒæ­¥è¯·æ±‚æˆ–å¼‚æ­¥è¯·æ±‚ï¼Œ<strong>ä½†é‡å¤å‘èµ·å¤šæ¬¡è¯·æ±‚çš„è¯ä¼šæŠ›å‡ºå¼‚å¸¸</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">interface</span> <span class="nc">Call</span> <span class="p">:</span> <span class="n">Cloneable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="c1">//è¿”å›æœ¬æ¬¡ç½‘ç»œè¯·æ±‚çš„ Request å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">request</span><span class="p">():</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="c1">//å‘èµ·åŒæ­¥è¯·æ±‚ï¼Œå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@Throws</span><span class="p">(</span><span class="n">IOException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">execute</span><span class="p">():</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="c1">//å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œé€šè¿‡ Callback æ¥å›è°ƒæœ€ç»ˆç»“æœ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">enqueue</span><span class="p">(</span><span class="n">responseCallback</span><span class="p">:</span> <span class="n">Callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//å–æ¶ˆç½‘ç»œè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//æ˜¯å¦å·²ç»å‘èµ·è¿‡è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">isExecuted</span><span class="p">():</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//æ˜¯å¦å·²ç»å–æ¶ˆè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">isCanceled</span><span class="p">():</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">//è¶…æ—¶è®¡ç®—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="nf">timeout</span><span class="p">():</span> <span class="n">Timeout</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//åŒä¸ª Call ä¸å…è®¸é‡å¤å‘èµ·è¯·æ±‚ï¼Œæƒ³è¦å†æ¬¡å‘èµ·è¯·æ±‚å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å¾—åˆ°ä¸€ä¸ªæ–°çš„ Call å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">public</span> <span class="k">override</span> <span class="k">fun</span> <span class="nf">clone</span><span class="p">():</span> <span class="n">Call</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">interface</span> <span class="n">Factory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Call</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>newCall</code> æ–¹æ³•è¿”å›çš„å®é™…ç±»å‹æ˜¯ RealCallï¼Œå®ƒæ˜¯ Call æ¥å£çš„å”¯ä¸€å®ç°ç±»</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨ <code>execute</code> æ–¹æ³•å‘èµ·åŒæ­¥è¯·æ±‚æ—¶ï¼Œå…¶ä¸»è¦é€»è¾‘æ˜¯ï¼š</p>
<ol>
<li>åˆ¤è¯»æ˜¯å¦é‡å¤è¯·æ±‚</li>
<li>äº‹ä»¶è®°å½•</li>
<li>å°†è‡ªèº«åŠ å…¥åˆ° dispatcher ä¸­ï¼Œå¹¶åœ¨è¯·æ±‚ç»“æŸæ—¶ä» dispatcher ä¸­ç§»é™¤è‡ªèº«</li>
<li>é€šè¿‡ <code>getResponseWithInterceptorChain</code> æ–¹æ³•å¾—åˆ° Response å¯¹è±¡</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealCall</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">client</span><span class="p">:</span> <span class="n">OkHttpClient</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/** The application&#39;s original request unadulterated by redirects or auth headers. */</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">originalRequest</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">forWebSocket</span><span class="p">:</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="n">Call</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">execute</span><span class="p">():</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span><span class="p">(</span><span class="n">executed</span><span class="p">.</span><span class="n">compareAndSet</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span> <span class="s2">&#34;Already Executed&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeout</span><span class="p">.</span><span class="n">enter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">callStart</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">executed</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">getResponseWithInterceptorChain</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">finished</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="å››dispatcher">å››ã€Dispatcher</h1>
<p>ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>getResponseWithInterceptorChain</code> æ–¹æ³•å°±æ˜¯é‡å¤´æˆäº†ï¼Œå…¶è¿”å›äº†æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ Responseã€‚ä½†è¿™é‡Œå…ˆä¸ä»‹ç»è¯¥æ–¹æ³•ï¼Œå…ˆæ¥çœ‹çœ‹ Dispatcher çš„é€»è¾‘</p>
<p>Dispatcher æ˜¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œç”¨äºå¯¹å…¨å±€çš„ç½‘ç»œè¯·æ±‚è¿›è¡Œç¼“å­˜è°ƒåº¦ï¼Œå…¶åŒ…å«ä»¥ä¸‹å‡ ä¸ªæˆå‘˜å˜é‡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">var</span> <span class="py">maxRequests</span> <span class="p">=</span> <span class="m">64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">var</span> <span class="py">maxRequestsPerHost</span> <span class="p">=</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** Ready async calls in the order they&#39;ll be run. */</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">val</span> <span class="py">readyAsyncCalls</span> <span class="p">=</span> <span class="n">ArrayDeque</span><span class="p">&lt;</span><span class="n">AsyncCall</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** Running asynchronous calls. Includes canceled calls that haven&#39;t finished yet. */</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">val</span> <span class="py">runningAsyncCalls</span> <span class="p">=</span> <span class="n">ArrayDeque</span><span class="p">&lt;</span><span class="n">AsyncCall</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** Running synchronous calls. Includes canceled calls that haven&#39;t finished yet. */</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">val</span> <span class="py">runningSyncCalls</span> <span class="p">=</span> <span class="n">ArrayDeque</span><span class="p">&lt;</span><span class="n">RealCall</span><span class="p">&gt;()</span>
</span></span></code></pre></div><ul>
<li>maxRequestsã€‚åŒä¸€æ—¶é—´å…è®¸å¹¶å‘æ‰§è¡Œç½‘ç»œè¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•°</li>
<li>maxRequestsPerHostã€‚åŒä¸€ host ä¸‹çš„æœ€å¤§åŒæ—¶è¯·æ±‚æ•°</li>
<li>readyAsyncCallsã€‚ä¿å­˜å½“å‰ç­‰å¾…æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡</li>
<li>runningAsyncCallsã€‚ä¿å­˜å½“å‰æ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡</li>
<li>runningSyncCallsã€‚ä¿å­˜å½“å‰æ­£åœ¨æ‰§è¡Œçš„åŒæ­¥ä»»åŠ¡</li>
</ul>
<p>å®¢æˆ·ç«¯ä¸åº”è¯¥æ— é™åˆ¶åœ°åŒæ—¶å‘èµ·å¤šä¸ªç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºé™¤äº†ç½‘ç»œèµ„æºæ‰€é™å¤–ï¼Œç³»ç»Ÿèµ„æºä¹Ÿæ˜¯æœ‰é™çš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ç”±ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œç³»ç»Ÿæ”¯æŒå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥ OkHttp å†…éƒ¨å°±ä½¿ç”¨ maxRequests æ¥æ§åˆ¶åŒæ—¶æ‰§è¡Œå¼‚æ­¥è¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚æ­¤å¤–ï¼ŒOkHttp ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå…è®¸å¤šä¸ªæŒ‡å‘åŒä¸€ host çš„ç½‘ç»œè¯·æ±‚å…±äº«åŒä¸€ä¸ª Socketï¼Œè€Œæœ€å¤§å…±äº«æ•°é‡å³ maxRequestsPerHost</p>
<p>ä¸ºäº†ç»Ÿè®¡ä»¥ä¸Šä¸¤ä¸ªè¿è¡Œå‚æ•°ï¼Œå°±éœ€è¦ä½¿ç”¨ readyAsyncCallsã€runningAsyncCalls å’Œ runningSyncCalls æ¥ä¿å­˜å½“å‰æ­£åœ¨æ‰§è¡Œæˆ–è€…å‡†å¤‡æ‰§è¡Œçš„ç½‘ç»œè¯·æ±‚ã€‚runningSyncCalls ç”¨äºä¿å­˜<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„åŒæ­¥ä»»åŠ¡</strong>ï¼Œå…¶å­˜å‚¨çš„æ˜¯ RealCallã€‚readyAsyncCalls å’Œ runningAsyncCalls ç”¨äºä¿å­˜<strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼Œå…¶å­˜å‚¨çš„æ˜¯ AsyncCall</p>
<h2 id="1åŒæ­¥è¯·æ±‚">1ã€åŒæ­¥è¯·æ±‚</h2>
<p>RealCall çš„ <code>execute()</code> æ–¹æ³•åœ¨å¼€å§‹è¯·æ±‚å‰ï¼Œä¼šå…ˆå°†è‡ªèº«ä¼ ç»™ dispatcherï¼Œåœ¨è¯·æ±‚ç»“æŸååˆä¼šä» dispatcher ä¸­ç§»é™¤</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealCall</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">client</span><span class="p">:</span> <span class="n">OkHttpClient</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/** The application&#39;s original request unadulterated by redirects or auth headers. */</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">originalRequest</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">forWebSocket</span><span class="p">:</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="n">Call</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">execute</span><span class="p">():</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span><span class="p">(</span><span class="n">executed</span><span class="p">.</span><span class="n">compareAndSet</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span> <span class="s2">&#34;Already Executed&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeout</span><span class="p">.</span><span class="n">enter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">callStart</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ·»åŠ åˆ° dispatcher
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">executed</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">getResponseWithInterceptorChain</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ä» dispatcher ä¸­ç§»é™¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">finished</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Dispatcher å†…éƒ¨ä¹Ÿåªæ˜¯ç›¸åº”çš„å°† RealCall æ·»åŠ åˆ° runningSyncCalls ä¸­æˆ–è€…æ˜¯å°†å…¶ä» runningSyncCalls ä¸­ç§»é™¤ï¼Œä¿å­˜åˆ° runningSyncCalls çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿<strong>ç»Ÿè®¡å½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚æ€»æ•°</strong>ä»¥åŠ<strong>èƒ½å¤Ÿå–æ¶ˆæ‰€æœ‰è¯·æ±‚</strong>ã€‚æ­¤å¤–ï¼Œç”±äºåŒæ­¥è¯·æ±‚ä¼šç›´æ¥è¿è¡Œåœ¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹ä¸Šï¼Œæ‰€ä»¥åŒæ­¥è¯·æ±‚å¹¶ä¸ä¼šå— maxRequests çš„é™åˆ¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Dispatcher</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">      <span class="cm">/** Used by [Call.execute] to signal it is in-flight. */</span>
</span></span><span class="line"><span class="cl">  	  <span class="nd">@Synchronized</span> 
</span></span><span class="line"><span class="cl">      <span class="k">internal</span> <span class="k">fun</span> <span class="nf">executed</span><span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">RealCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="n">runningSyncCalls</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">      <span class="cm">/** Used by [Call.execute] to signal completion. */</span>
</span></span><span class="line"><span class="cl">  	  <span class="k">internal</span> <span class="k">fun</span> <span class="nf">finished</span><span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">RealCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="n">finished</span><span class="p">(</span><span class="n">runningSyncCalls</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  	  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  	  <span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">finished</span><span class="p">(</span><span class="n">calls</span><span class="p">:</span> <span class="n">Deque</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">call</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="k">val</span> <span class="py">idleCallback</span><span class="p">:</span> <span class="n">Runnable</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">    	<span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      		<span class="k">if</span> <span class="p">(!</span><span class="n">calls</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">call</span><span class="p">))</span> <span class="k">throw</span> <span class="n">AssertionError</span><span class="p">(</span><span class="s2">&#34;Call wasn&#39;t in-flight!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      		<span class="n">idleCallback</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">idleCallback</span>
</span></span><span class="line"><span class="cl">    	<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ¤æ–­æ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„ç½‘ç»œè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="k">val</span> <span class="py">isRunning</span> <span class="p">=</span> <span class="n">promoteAndExecute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    	<span class="k">if</span> <span class="p">(</span><span class="o">!is</span><span class="n">Running</span> <span class="o">&amp;&amp;</span> <span class="n">idleCallback</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      		<span class="n">idleCallback</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    	<span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="2å¼‚æ­¥è¯·æ±‚">2ã€å¼‚æ­¥è¯·æ±‚</h2>
<p>RealCall çš„ <code>enqueue</code>æ–¹æ³•ä¼šå°†å¤–éƒ¨ä¼ å…¥çš„ Callback åŒ…è£…ä¸ºä¸€ä¸ª AsyncCall å¯¹è±¡åä¼ ç»™ dispatcher</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealCall</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">client</span><span class="p">:</span> <span class="n">OkHttpClient</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/** The application&#39;s original request unadulterated by redirects or auth headers. */</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">originalRequest</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="py">forWebSocket</span><span class="p">:</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="n">Call</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">enqueue</span><span class="p">(</span><span class="n">responseCallback</span><span class="p">:</span> <span class="n">Callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span><span class="p">(</span><span class="n">executed</span><span class="p">.</span><span class="n">compareAndSet</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span> <span class="s2">&#34;Already Executed&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">callStart</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">AsyncCall</span><span class="p">(</span><span class="n">responseCallback</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç”±äº <code>enqueue</code>å¯¹åº”çš„æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥ OkHttp å†…éƒ¨å°±éœ€è¦è‡ªå·±æ„é€ ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯·æ±‚ï¼Œåœ¨è¯·æ±‚ç»“æŸåå†é€šè¿‡ Callback æ¥å°†ç»“æœå€¼å›è°ƒç»™å¤–éƒ¨ï¼Œå¼‚æ­¥è¯·æ±‚é€»è¾‘å¯¹åº”çš„è½½ä½“å°±æ˜¯ AsyncCall è¿™ä¸ªç±»</p>
<p>AsyncCall æ˜¯ RealCall çš„éé™æ€å†…éƒ¨ç±»ï¼Œæ‰€ä»¥ AsyncCall å¯ä»¥è®¿é—®åˆ° RealCall çš„æ‰€æœ‰å˜é‡å’Œæ–¹æ³•ã€‚æ­¤å¤–ï¼ŒAsyncCall ç»§æ‰¿äº† Runnable æ¥å£ï¼Œå…¶ <code>executeOn</code> æ–¹æ³•å°±ç”¨äºä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡æ¥æ‰§è¡Œ<code>run</code> æ–¹æ³•ã€‚<code>run</code> æ–¹æ³•å†…è¿˜æ˜¯è°ƒç”¨äº† <code>getResponseWithInterceptorChain()</code>æ–¹æ³•æ¥è·å– responseï¼Œå¹¶é€šè¿‡ Callback æ¥å°†æ‰§è¡Œç»“æœï¼ˆä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰å›è°ƒå‡ºå»ï¼Œåœ¨è¯·æ±‚ç»“æŸåä¹Ÿä¼šå°†è‡ªèº«ä» dispatcher ä¸­ç§»é™¤</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">inner</span> <span class="k">class</span> <span class="nc">AsyncCall</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">responseCallback</span><span class="p">:</span> <span class="n">Callback</span><span class="p">)</span> <span class="p">:</span> <span class="n">Runnable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="nd">@Volatile</span> <span class="k">var</span> <span class="py">callsPerHost</span> <span class="p">=</span> <span class="n">AtomicInteger</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  		<span class="k">private</span> <span class="k">set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">fun</span> <span class="nf">reuseCallsPerHostFrom</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">AsyncCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  		<span class="k">this</span><span class="p">.</span><span class="n">callsPerHost</span> <span class="p">=</span> <span class="n">other</span><span class="p">.</span><span class="n">callsPerHost</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">fun</span> <span class="nf">executeOn</span><span class="p">(</span><span class="n">executorService</span><span class="p">:</span> <span class="n">ExecutorService</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">assertThreadDoesntHoldLock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">success</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">executorService</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">success</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">RejectedExecutionException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">ioException</span> <span class="p">=</span> <span class="n">InterruptedIOException</span><span class="p">(</span><span class="s2">&#34;executor rejected&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ioException</span><span class="p">.</span><span class="n">initCause</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">noMoreExchanges</span><span class="p">(</span><span class="n">ioException</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">responseCallback</span><span class="p">.</span><span class="n">onFailure</span><span class="p">(</span><span class="k">this</span><span class="nd">@RealCall</span><span class="p">,</span> <span class="n">ioException</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(!</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">finished</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="c1">// This call is no longer running!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">threadName</span><span class="p">(</span><span class="s2">&#34;OkHttp </span><span class="si">${redactedUrl()}</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">var</span> <span class="py">signalledCallback</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">            <span class="n">timeout</span><span class="p">.</span><span class="n">enter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">getResponseWithInterceptorChain</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">signalledCallback</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">                <span class="n">responseCallback</span><span class="p">.</span><span class="n">onResponse</span><span class="p">(</span><span class="k">this</span><span class="nd">@RealCall</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">IOException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">signalledCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// Do not signal the callback twice!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="nc">Platform</span><span class="p">.</span><span class="k">get</span><span class="p">().</span><span class="n">log</span><span class="p">(</span><span class="s2">&#34;Callback failure for </span><span class="si">${toLoggableString()}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nc">Platform</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">responseCallback</span><span class="p">.</span><span class="n">onFailure</span><span class="p">(</span><span class="k">this</span><span class="nd">@RealCall</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(!</span><span class="n">signalledCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">val</span> <span class="py">canceledException</span> <span class="p">=</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;canceled due to </span><span class="si">$t</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">canceledException</span><span class="p">.</span><span class="n">addSuppressed</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">responseCallback</span><span class="p">.</span><span class="n">onFailure</span><span class="p">(</span><span class="k">this</span><span class="nd">@RealCall</span><span class="p">,</span> <span class="n">canceledException</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="n">t</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">client</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">finished</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Dispatcher åœ¨æ‹¿åˆ° AsyncCall å¯¹è±¡åï¼Œä¼šå…ˆå°†å…¶å­˜åˆ° readyAsyncCalls ä¸­ï¼Œç„¶åé€šè¿‡ <code>findExistingCallWithHost</code>æ–¹æ³•æ¥æŸ¥æ‰¾å½“å‰æ˜¯å¦æœ‰æŒ‡å‘åŒä¸€ Host çš„å¼‚æ­¥è¯·æ±‚ï¼Œæœ‰çš„è¯åˆ™äº¤æ¢ callsPerHost å˜é‡ï¼Œè¯¥å˜é‡å°±ç”¨äºæ ‡è®°å½“å‰æŒ‡å‘åŒä¸€ Host çš„è¯·æ±‚æ•°é‡ï¼Œæœ€åè°ƒç”¨ <code>promoteAndExecute</code> æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æ˜¯å¦å…è®¸å‘èµ·è¯·æ±‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Dispatcher</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="k">internal</span> <span class="k">fun</span> <span class="nf">enqueue</span><span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">AsyncCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">readyAsyncCalls</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Mutate the AsyncCall so that it shares the AtomicInteger of an existing running call to
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// the same host.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(!</span><span class="n">call</span><span class="p">.</span><span class="n">call</span><span class="p">.</span><span class="n">forWebSocket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æŸ¥æ‰¾å½“å‰æ˜¯å¦æœ‰æŒ‡å‘åŒä¸€ Host çš„å¼‚æ­¥è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">val</span> <span class="py">existingCall</span> <span class="p">=</span> <span class="n">findExistingCallWithHost</span><span class="p">(</span><span class="n">call</span><span class="p">.</span><span class="n">host</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">existingCall</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">call</span><span class="p">.</span><span class="n">reuseCallsPerHostFrom</span><span class="p">(</span><span class="n">existingCall</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">promoteAndExecute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">findExistingCallWithHost</span><span class="p">(</span><span class="n">host</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">AsyncCall</span><span class="p">?</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">existingCall</span> <span class="k">in</span> <span class="n">runningAsyncCalls</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">existingCall</span><span class="p">.</span><span class="n">host</span> <span class="o">==</span> <span class="n">host</span><span class="p">)</span> <span class="k">return</span> <span class="n">existingCall</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">existingCall</span> <span class="k">in</span> <span class="n">readyAsyncCalls</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">existingCall</span><span class="p">.</span><span class="n">host</span> <span class="o">==</span> <span class="n">host</span><span class="p">)</span> <span class="k">return</span> <span class="n">existingCall</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç”±äºå½“å‰æ­£åœ¨æ‰§è¡Œçš„ç½‘ç»œè¯·æ±‚æ€»æ•°å¯èƒ½å·²ç»è¾¾åˆ°é™åˆ¶ï¼Œæˆ–è€…æ˜¯æŒ‡å‘åŒä¸€ Host çš„è¯·æ±‚ä¹Ÿè¾¾åˆ°é™åˆ¶äº†ï¼Œæ‰€ä»¥ <code>promoteAndExecute()</code>æ–¹æ³•å°±ç”¨äºä»å¾…æ‰§è¡Œåˆ—è¡¨ readyAsyncCalls ä¸­è·å–å½“å‰ç¬¦åˆè¿è¡Œæ¡ä»¶çš„æ‰€æœ‰è¯·æ±‚ï¼Œå°†è¯·æ±‚å­˜åˆ° runningAsyncCalls ä¸­ï¼Œå¹¶è°ƒç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">promoteAndExecute</span><span class="p">():</span> <span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">assertThreadDoesntHoldLock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">executableCalls</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">AsyncCall</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">isRunning</span><span class="p">:</span> <span class="n">Boolean</span>
</span></span><span class="line"><span class="cl">    <span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">i</span> <span class="p">=</span> <span class="n">readyAsyncCalls</span><span class="p">.</span><span class="n">iterator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">asyncCall</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	    <span class="c1">//å¦‚æœå½“å‰æ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥è¯·æ±‚æ€»æ•°å·²ç»è¶…å‡ºé™åˆ¶ï¼Œåˆ™ç›´æ¥è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">runningAsyncCalls</span><span class="p">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="n">maxRequests</span><span class="p">)</span> <span class="k">break</span> <span class="c1">// Max capacity.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//å¦‚æœæŒ‡å‘åŒä¸ª Host çš„è¯·æ±‚æ€»æ•°å·²ç»è¶…å‡ºé™åˆ¶ï¼Œåˆ™å–ä¸‹ä¸€ä¸ªè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">asyncCall</span><span class="p">.</span><span class="n">callsPerHost</span><span class="p">.</span><span class="k">get</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="n">maxRequestsPerHost</span><span class="p">)</span> <span class="k">continue</span> <span class="c1">// Host max capacity.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span><span class="p">.</span><span class="n">remove</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°† callsPerHost é€’å¢åŠ ä¸€ï¼Œè¡¨ç¤ºæŒ‡å‘è¯¥ Host çš„é“¾æ¥æ•°åŠ ä¸€äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">asyncCall</span><span class="p">.</span><span class="n">callsPerHost</span><span class="p">.</span><span class="n">incrementAndGet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°† asyncCall å­˜åˆ°å¯æ‰§è¡Œåˆ—è¡¨ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">executableCalls</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncCall</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°† asyncCall å­˜åˆ°æ­£åœ¨æ‰§è¡Œåˆ—è¡¨ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">runningAsyncCalls</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncCall</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">isRunning</span> <span class="p">=</span> <span class="n">runningCallsCount</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æ‰§è¡Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">executableCalls</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">asyncCall</span> <span class="p">=</span> <span class="n">executableCalls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="n">asyncCall</span><span class="p">.</span><span class="n">executeOn</span><span class="p">(</span><span class="n">executorService</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">isRunning</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h2 id="3arraydeque">3ã€ArrayDeque</h2>
<p>ä¸Šé¢æœ‰è®²åˆ°ï¼Œä¸‰ç§è¯·æ±‚çš„å­˜å‚¨å®¹å™¨æ˜¯ ArrayDequeã€‚ArrayDeque å±äºéçº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ—ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°å¤šçº¿ç¨‹æ“ä½œæ—¶éƒ½éœ€è¦å¤–éƒ¨ä¸»åŠ¨çº¿ç¨‹åŒæ­¥ã€‚é‚£ä¹ˆè®©æˆ‘ä»¬æƒ³ä¸€æƒ³ï¼ŒOkHttp é€‰æ‹© ArrayDeque ä½œä¸ºä»»åŠ¡å®¹å™¨çš„ç†ç”±æ˜¯ä»€ä¹ˆï¼Ÿä»¥æˆ‘ç²—æµ…çš„çœ¼å…‰æ¥çœ‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ArrayDeque å†…éƒ¨ä½¿ç”¨æ•°ç»„ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œå…ƒç´ å…·æœ‰æ˜ç¡®çš„å…ˆåé¡ºåºï¼Œè¿™ç¬¦åˆæˆ‘ä»¬å¯¹ç½‘ç»œè¯·æ±‚<strong>å…ˆåˆ°å…ˆæ‰§è¡Œ</strong>çš„åŸºæœ¬é¢„æœŸ</li>
<li>åœ¨é€‰æ‹©ç¬¦åˆè¿è¡Œæ¡ä»¶çš„å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œéœ€è¦å¯¹ readyAsyncCalls è¿›è¡Œéå†ï¼Œæ•°ç»„åœ¨éå†æ•ˆç‡ä¸Šä¼šæ¯”è¾ƒé«˜</li>
<li>åœ¨éå†åˆ°ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚åï¼Œéœ€è¦å°†è¯·æ±‚ä» readyAsyncCalls ä¸­ç§»é™¤å¹¶è½¬ç§»åˆ° runningAsyncCalls ä¸­ï¼Œè€Œ ArrayDeque ä½œä¸ºåŒç«¯é˜Ÿåˆ—ï¼Œåœ¨å†…å­˜ç©ºé—´åˆ©ç”¨ç‡ä¸Šæ¯”è¾ƒé«˜</li>
<li>Dispatcher é¢å¯¹çš„å°±æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œæœ¬èº«å°±éœ€è¦è¿›è¡Œçº¿ç¨‹åŒæ­¥ï¼Œé€‰æ‹© ArrayDeque è¿™ä¸ªéçº¿ç¨‹å®‰å…¨çš„å®¹å™¨å¯ä»¥çœå»å¤šä½™çš„çº¿ç¨‹åŒæ­¥æ¶ˆè€—</li>
</ul>
<h2 id="4çº¿ç¨‹æ± ">4ã€çº¿ç¨‹æ± </h2>
<p>OkHttp çš„å¼‚æ­¥è¯·æ±‚æ˜¯äº¤ç”±å…¶å†…éƒ¨çš„çº¿ç¨‹æ± æ¥å®Œæˆçš„ï¼Œè¯¥çº¿ç¨‹æ± å°±é•¿è¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">var</span> <span class="py">executorServiceOrNull</span><span class="p">:</span> <span class="n">ExecutorService</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@get</span><span class="p">:</span><span class="n">Synchronized</span>
</span></span><span class="line"><span class="cl"><span class="nd">@get</span><span class="p">:</span><span class="n">JvmName</span><span class="p">(</span><span class="s2">&#34;executorService&#34;</span><span class="p">)</span> <span class="k">val</span> <span class="py">executorService</span><span class="p">:</span> <span class="n">ExecutorService</span>
</span></span><span class="line"><span class="cl"><span class="k">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">executorServiceOrNull</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">executorServiceOrNull</span> <span class="p">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="nc">Int</span><span class="p">.</span><span class="n">MAX_VALUE</span><span class="p">,</span> <span class="m">60</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="n">SECONDS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">SynchronousQueue</span><span class="p">(),</span> <span class="n">threadFactory</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$okHttpName</span><span class="s2"> Dispatcher&#34;</span><span class="p">,</span> <span class="k">false</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">executorServiceOrNull</span><span class="o">!!</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¯¥çº¿ç¨‹æ± çš„å‚æ•°è®¾ç½®æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿä»¥æˆ‘ç²—æµ…çš„çœ¼å…‰æ¥çœ‹ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol>
<li>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 0ï¼Œçº¿ç¨‹è¶…æ—¶æ—¶é—´æ˜¯ 60 ç§’ã€‚è¯´æ˜åœ¨æ²¡æœ‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœçº¿ç¨‹é—²ç½®äº† 60 ç§’ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ï¼Œè¿™å¯ä»¥é¿å…ç©ºé—²çº¿ç¨‹ç™½ç™½æµªè´¹ç³»ç»Ÿèµ„æºï¼Œé€‚åˆäºç§»åŠ¨è®¾å¤‡èµ„æºç´§ç¼ºçš„æƒ…æ™¯</li>
<li>å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ä¸º Int.MAX_VALUEï¼Œå¯ä»¥çœ‹åšæ˜¯å®Œå…¨æ²¡æœ‰é™åˆ¶çš„ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—æ˜¯ SynchronousQueueã€‚SynchronousQueue çš„ç‰¹ç‚¹æ˜¯å½“æœ‰ä»»åŠ¡å…¥é˜Ÿæ—¶ï¼Œå¿…é¡»ç­‰å¾…è¯¥ä»»åŠ¡è¢«æ¶ˆè´¹å¦åˆ™å…¥é˜Ÿæ“ä½œå°±ä¼šä¸€ç›´è¢«é˜»å¡ï¼Œè€Œç”±äºçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°é‡æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥æ¯ä¸ªå…¥é˜Ÿçš„ä»»åŠ¡éƒ½èƒ½é©¬ä¸Šäº¤ç”±çº¿ç¨‹å¤„ç†ï¼ˆäº¤ä»˜ç»™ç©ºé—²çº¿ç¨‹æˆ–è€…æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼‰ï¼Œè¿™å°±ä¿è¯äº†ä»»åŠ¡çš„å¤„ç†åŠæ—¶æ€§ï¼Œç¬¦åˆæˆ‘ä»¬å¯¹ç½‘ç»œè¯·æ±‚åº”è¯¥å°½å¿«å‘èµ·å¹¶å®Œæˆçš„æœŸæœ›</li>
</ol>
<p>è™½ç„¶çº¿ç¨‹æ± æœ¬èº«å¯¹äºæœ€å¤§çº¿ç¨‹æ•°å‡ ä¹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯ç”±äºæäº¤ä»»åŠ¡çš„æ“ä½œè¿˜å— maxRequests çš„æ§åˆ¶ï¼Œæ‰€ä»¥å®é™…ä¸Šè¯¥çº¿ç¨‹æ± æœ€å¤šåŒæ—¶è¿è¡Œ maxRequests ä¸ªçº¿ç¨‹</p>
<h2 id="5æ¨åŠ¨è¯·æ±‚æ‰§è¡Œ">5ã€æ¨åŠ¨è¯·æ±‚æ‰§è¡Œ</h2>
<p>æ—¢ç„¶ OkHttp å†…éƒ¨çš„çº¿ç¨‹æ± æ˜¯ä¸å¯èƒ½æ— é™åˆ¶åœ°æ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œè¯·æ±‚çš„ï¼Œé‚£ä¹ˆå½“è¯·æ±‚æ€»æ•°å·²è¾¾åˆ° maxRequests åï¼Œåç»­çš„è¯·æ±‚åªèƒ½æ˜¯å…ˆå¤„äºç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™äº›ç­‰å¾…çŠ¶æ€çš„è¯·æ±‚ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«å¯åŠ¨å‘¢ï¼Ÿ</p>
<p>åŒæ­¥è¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚ç»“æŸåéƒ½ä¼šè°ƒç”¨åˆ° Dispatcher çš„ä¸¤ä¸ª <code>finished</code> æ–¹æ³•ï¼Œåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•é‡Œåˆä¼šè§¦å‘åˆ° <code>promoteAndExecute()</code>æ–¹æ³•å»éå†ä»»åŠ¡åˆ—è¡¨æ¥æ‰§è¡Œï¼Œæ­¤æ—¶å°±æ¨åŠ¨äº†å¾…å¤„ç†åˆ—è¡¨çš„ä»»åŠ¡æ‰§è¡Œæ“ä½œã€‚æ‰€ä»¥è¯´ï¼ŒDispatcher ä¸­çš„è¯·æ±‚éƒ½å¯ä»¥çœ‹åšæ˜¯åœ¨è‡ªå‘æ€§åœ°å¯åŠ¨ï¼Œæ¯ä¸ªè¯·æ±‚ç»“æŸéƒ½ä¼šè‡ªåŠ¨è§¦å‘ä¸‹ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œçœå»äº†å¤šä½™çš„å®šæ—¶æ£€æŸ¥è¿™ç±»æ“ä½œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/** Used by [AsyncCall.run] to signal completion. */</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">fun</span> <span class="nf">finished</span><span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">AsyncCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">call</span><span class="p">.</span><span class="n">callsPerHost</span><span class="p">.</span><span class="n">decrementAndGet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">finished</span><span class="p">(</span><span class="n">runningAsyncCalls</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** Used by [Call.execute] to signal completion. */</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">fun</span> <span class="nf">finished</span><span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">RealCall</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">finished</span><span class="p">(</span><span class="n">runningSyncCalls</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">finished</span><span class="p">(</span><span class="n">calls</span><span class="p">:</span> <span class="n">Deque</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">call</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">val</span> <span class="py">idleCallback</span><span class="p">:</span> <span class="n">Runnable</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">	<span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  		<span class="k">if</span> <span class="p">(!</span><span class="n">calls</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">call</span><span class="p">))</span> <span class="k">throw</span> <span class="n">AssertionError</span><span class="p">(</span><span class="s2">&#34;Call wasn&#39;t in-flight!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  		<span class="n">idleCallback</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">idleCallback</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å¯ä»¥å¯åŠ¨çš„å¾…æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰çš„è¯åˆ™å¯åŠ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">val</span> <span class="py">isRunning</span> <span class="p">=</span> <span class="n">promoteAndExecute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!is</span><span class="n">Running</span> <span class="o">&amp;&amp;</span> <span class="n">idleCallback</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  		<span class="n">idleCallback</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="6æ€»ç»“">6ã€æ€»ç»“</h2>
<ul>
<li>å¦‚æœæ˜¯åŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆç½‘ç»œè¯·æ±‚è¿‡ç¨‹å°±ä¼šç›´æ¥åœ¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹ä¸Šå®Œæˆï¼Œä¸å— Dispatcher çš„æ§åˆ¶</li>
<li>å¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¼šå…ˆå­˜åˆ°å¾…æ‰§è¡Œåˆ—è¡¨ readyAsyncCalls ä¸­ï¼Œè¯¥è¯·æ±‚æ˜¯å¦å¯ä»¥ç«‹å³å‘èµ·å— maxRequests å’Œ maxRequestsPerHost ä¸¤ä¸ªæ¡ä»¶çš„é™åˆ¶ã€‚å¦‚æœç¬¦åˆæ¡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šä» readyAsyncCalls å–å‡ºå¹¶å­˜åˆ° runningAsyncCalls ä¸­ï¼Œç„¶åäº¤ç”± OkHttp å†…éƒ¨çš„çº¿ç¨‹æ± æ¥æ‰§è¡Œ</li>
<li>ä¸ç®¡å¤–éƒ¨æ˜¯åŒæ­¥è¯·æ±‚è¿˜æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œå†…éƒ¨éƒ½æ˜¯é€šè¿‡è°ƒç”¨<code>getResponseWithInterceptorChain()</code>æ–¹æ³•æ¥æ‹¿åˆ° Response çš„</li>
<li>Dispatcher å†…éƒ¨çš„çº¿ç¨‹æ± æœ¬èº«å…è®¸åŒæ—¶è¿è¡Œ Int.MAX_VALUE ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å®é™…ä¸Šçš„çº¿ç¨‹æ•°é‡è¿˜æ˜¯å— maxRequests çš„æ§åˆ¶</li>
</ul>
<h1 id="äº”realinterceptorchain">äº”ã€RealInterceptorChain</h1>
<p>é‡ç‚¹å†æ¥çœ‹ <code>getResponseWithInterceptorChain()</code>æ–¹æ³•ï¼Œå…¶ä¸»è¦é€»è¾‘å°±æ˜¯é€šè¿‡æ‹¦æˆªå™¨æ¥å®Œæˆæ•´ä¸ªç½‘ç»œè¯·æ±‚è¿‡ç¨‹ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé™¤äº†ä¼šè·å–å¤–éƒ¨ä¸»åŠ¨è®¾ç½®çš„æ‹¦æˆªå™¨å¤–ï¼Œä¹Ÿä¼šé»˜è®¤æ·»åŠ ä»¥ä¸‹å‡ ä¸ªæ‹¦æˆªå™¨</p>
<ol>
<li>RetryAndFollowUpInterceptorã€‚è´Ÿè´£å¤±è´¥é‡è¯•ä»¥åŠé‡å®šå‘</li>
<li>BridgeInterceptorã€‚è´Ÿè´£å¯¹ç”¨æˆ·æ„é€ çš„ Request è¿›è¡Œè½¬æ¢ï¼Œæ·»åŠ å¿…è¦çš„ header å’Œ cookieï¼Œåœ¨å¾—åˆ° response åå¦‚æœæœ‰éœ€è¦çš„ä¼šè¿›è¡Œ gzip è§£å‹</li>
<li>CacheInterceptorã€‚ç”¨äºå¤„ç†ç¼“å­˜</li>
<li>ConnectInterceptorã€‚è´Ÿè´£å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥</li>
<li>CallServerInterceptorã€‚è´Ÿè´£å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å’Œä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®</li>
</ol>
<p>æœ€åï¼Œrequest å’Œ interceptors ä¼šç”¨æ¥ç”Ÿæˆä¸€ä¸ª RealInterceptorChain å¯¹è±¡ï¼Œç”±å…¶æ¥æœ€ç»ˆè¿”å› response</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Throws</span><span class="p">(</span><span class="n">IOException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">fun</span> <span class="nf">getResponseWithInterceptorChain</span><span class="p">():</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Build a full stack of interceptors.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">val</span> <span class="py">interceptors</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ·»åŠ å¼€å‘è€…è®¾ç½®çš„æ‹¦æˆªå™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">client</span><span class="p">.</span><span class="n">interceptors</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">//æ·»åŠ é»˜è®¤çš„æ‹¦æˆªå™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">RetryAndFollowUpInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">BridgeInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">cookieJar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">CacheInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">cache</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">ConnectInterceptor</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(!</span><span class="n">forWebSocket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å¦‚æœä¸æ˜¯ WebSocket çš„è¯ï¼Œé‚£å°±å†æ·»åŠ å¼€å‘è€…è®¾ç½®çš„ NetworkInterceptors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">client</span><span class="p">.</span><span class="n">networkInterceptors</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">    <span class="c1">//CallServerInterceptor æ˜¯å®é™…ä¸Šå‘èµ·ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">interceptors</span> <span class="o">+=</span> <span class="n">CallServerInterceptor</span><span class="p">(</span><span class="n">forWebSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">chain</span> <span class="p">=</span> <span class="n">RealInterceptorChain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">call</span> <span class="p">=</span> <span class="k">this</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">interceptors</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">exchange</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="p">=</span> <span class="n">originalRequest</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">connectTimeoutMillis</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">connectTimeoutMillis</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">readTimeoutMillis</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">readTimeoutMillis</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">writeTimeoutMillis</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">writeTimeoutMillis</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="py">calledNoMoreExchanges</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">originalRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">isCanceled</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="p">.</span><span class="n">closeQuietly</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;Canceled&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">IOException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">calledNoMoreExchanges</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="n">noMoreExchanges</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">as</span> <span class="n">Throwable</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(!</span><span class="n">calledNoMoreExchanges</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">noMoreExchanges</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p><strong>Interceptor æ˜¯ OkHttp é‡Œå¾ˆé‡è¦çš„ä¸€ç¯ï¼ŒOkHttp ä¹Ÿæ˜¯é æ­¤ä¸ºå¼€å‘è€…æä¾›äº†å¾ˆé«˜çš„è‡ªç”±åº¦</strong>ã€‚Interceptor æ¥å£æœ¬èº«åªåŒ…å«ä¸€ä¸ª <code>intercept</code> æ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•å†…å¯æ‹¿åˆ°åŸå§‹çš„ Request å¯¹è±¡ä»¥åŠæœ€ç»ˆçš„ Response</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">interface</span> <span class="n">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nd">@Throws</span><span class="p">(</span><span class="n">IOException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª LogInterceptor æ¥æ‰“å°ç½‘ç»œè¯·æ±‚çš„è¯·æ±‚å‚æ•°ä»¥åŠæœ€ç»ˆçš„è¿”å›å€¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LogInterceptor</span> <span class="p">:</span> <span class="n">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="nc">Interceptor</span><span class="p">.</span><span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Interceptor çš„å®ç°åˆè¡·æ˜¯ä¸ºäº†ç»™å¼€å‘è€…æä¾›ä¸€ä¸ªå¯ä»¥æ§åˆ¶ç½‘ç»œè¯·æ±‚çš„<strong>å‘èµ·è¿‡ç¨‹</strong>åŠ<strong>æ”¶å°¾å·¥ä½œ</strong>çš„å…¥å£ï¼Œä¾‹å¦‚**æ·»åŠ  headerã€æ—¥å¿—è®°å½•ã€è¯·æ±‚æ‹¦æˆªã€ResponseBodyä¿®æ”¹ **ç­‰ï¼Œæ¯ä¸ª Interceptor åªè´Ÿè´£è‡ªå·±å…³å¿ƒçš„æ“ä½œï¼Œé‚£ä¹ˆåŠ¿å¿…å°±ä¼šæœ‰æ·»åŠ å¤šä¸ª Interceptor çš„éœ€æ±‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåªæœ‰è®©æ¯ä¸ª Interceptor éƒ½ä¾æ¬¡å¤„ç†å®Œ request ä¹‹åï¼ŒOkHttp æ‰èƒ½æ ¹æ®æœ€ç»ˆçš„ request å¯¹è±¡å»è”ç½‘è¯·æ±‚å¾—åˆ° responseï¼Œæ‰€ä»¥æ¯ä¸ª Interceptor éœ€è¦ä¾æ¬¡æ‹¿åˆ° request è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚è¯·æ±‚åˆ° response åï¼ŒInterceptor å¯èƒ½è¿˜éœ€è¦å¯¹ response è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå°±è¿˜éœ€è¦å°† response å†ä¾æ¬¡ä¼ é€’ç»™æ¯ä¸ª Interceptorã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆå®ç°å°†å¤šä¸ª Interceptor ç»™ä¸²è”èµ·æ¥å‘¢ï¼Ÿ</p>
<p><strong>è¿™é‡Œæ¥çœ‹ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬çš„ Interceptor å®ç°æ€è·¯</strong></p>
<p>å‡è®¾æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ Interceptor å®ç°ç±»æœ‰ä¸¤ä¸ªï¼šLogInterceptor å’Œ HeaderInterceptorï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°å°†è·å–åˆ° request å’Œ response çš„æ—¶æœºç»™æ‰“å°å‡ºæ¥ï¼Œé‡ç‚¹æ˜¯è¦çœ‹æ¯ä¸ª Interceptor çš„å…ˆåè°ƒç”¨é¡ºåºã€‚ä¸ºäº†å°†ä¸¤ä¸ª Interceptor ç»™ä¸²è”èµ·æ¥ï¼ŒRealInterceptorChain ä¼šå¾ªç¯è·å– index æŒ‡å‘çš„ä¸‹ä¸€ä¸ª Interceptor å¯¹è±¡ï¼Œæ¯æ¬¡æ„å»ºä¸€ä¸ªæ–°çš„ RealInterceptorChain å¯¹è±¡ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ <code>intercept</code> æ–¹æ³•ï¼Œè¿™æ ·å¤–éƒ¨åªéœ€è¦è°ƒç”¨ä¸€æ¬¡ <code>realInterceptorChain.proceed</code> å°±å¯ä»¥æ‹¿åˆ°æœ€ç»ˆçš„ response å¯¹è±¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">interface</span> <span class="nc">Chain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">request</span><span class="p">():</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">interface</span> <span class="nc">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealInterceptorChain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">interceptors</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">index</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="n">Chain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">copy</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">RealInterceptorChain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">RealInterceptorChain</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">interceptors</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">request</span><span class="p">():</span> <span class="n">Request</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">next</span> <span class="p">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">index</span> <span class="p">=</span> <span class="n">index</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">interceptor</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">interceptor</span><span class="p">.</span><span class="n">intercept</span><span class="p">(</span><span class="n">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LogInterceptor</span> <span class="p">:</span> <span class="n">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;LogInterceptor -- getRequest&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;LogInterceptor ---- getResponse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeaderInterceptor</span> <span class="p">:</span> <span class="n">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;HeaderInterceptor -- getRequest&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;HeaderInterceptor ---- getResponse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">interceptorList</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">LogInterceptor</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">HeaderInterceptor</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">realInterceptorChain</span> <span class="p">=</span> <span class="n">RealInterceptorChain</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">interceptorList</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">realInterceptorChain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="p">(</span><span class="s2">&#34;main response&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç çœ‹ç€æ€è·¯è¿˜å¯ä»¥ï¼Œå¯æ˜¯å½“è¿è¡Œåå°±ä¼šå‘ç°æŠ›å‡ºäº† IndexOutOfBoundsExceptionï¼Œå› ä¸ºä»£ç é‡Œå¹¶æ²¡æœ‰å¯¹ index è¿›è¡Œè¶Šç•Œåˆ¤æ–­ã€‚è€Œä¸”ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿç¼ºå°‘äº†ä¸€ä¸ªçœŸæ­£çš„ç”Ÿæˆ Response å¯¹è±¡çš„åœ°æ–¹ï¼Œæ¯ä¸ª Interceptor åªæ˜¯åœ¨è¿›è¡Œä¸­è½¬è°ƒç”¨è€Œå·²ï¼Œå› æ­¤è¿˜éœ€è¦ä¸€ä¸ªæ¥çœŸæ­£åœ°å®Œæˆç½‘ç»œè¯·æ±‚å¹¶è¿”å› Response å¯¹è±¡çš„åœ°æ–¹ï¼Œå³ CallServerInterceptor</p>
<p>æ‰€ä»¥ï¼ŒCallServerInterceptor çš„<code>intercept</code> æ–¹æ³•å°±ç”¨æ¥çœŸæ­£åœ°æ‰§è¡Œç½‘ç»œè¯·æ±‚å¹¶ç”Ÿæˆ Response å¯¹è±¡ï¼Œåœ¨è¿™é‡Œå°±ä¸èƒ½å†è°ƒç”¨ <code>proceed</code> æ–¹æ³•äº†ï¼Œä¸” CallServerInterceptor éœ€è¦æ”¾åœ¨ interceptorList çš„æœ€åä¸€ä½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CallServerInterceptor</span> <span class="p">:</span> <span class="n">Interceptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;CallServerInterceptor -- getRequest&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">Response</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;CallServerInterceptor ---- getResponse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">interceptorList</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">LogInterceptor</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">HeaderInterceptor</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">interceptorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">CallServerInterceptor</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">realInterceptorChain</span> <span class="p">=</span> <span class="n">RealInterceptorChain</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">interceptorList</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">realInterceptorChain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="p">(</span><span class="s2">&#34;main response&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æœ€ç»ˆçš„è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>intercept</code> æ–¹æ³•æ˜¯æ ¹æ®æ·»åŠ é¡ºåºæ¥è°ƒç”¨ï¼Œè€Œ response æ˜¯æŒ‰ç…§åæ–¹å‘æ¥ä¼ é€’</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">LogInterceptor</span> <span class="o">--</span> <span class="n">getRequest</span>
</span></span><span class="line"><span class="cl"><span class="n">HeaderInterceptor</span> <span class="o">--</span> <span class="n">getRequest</span>
</span></span><span class="line"><span class="cl"><span class="n">CallServerInterceptor</span> <span class="o">--</span> <span class="n">getRequest</span>
</span></span><span class="line"><span class="cl"><span class="n">CallServerInterceptor</span> <span class="o">----</span> <span class="n">getResponse</span>
</span></span><span class="line"><span class="cl"><span class="n">HeaderInterceptor</span> <span class="o">----</span> <span class="n">getResponse</span>
</span></span><span class="line"><span class="cl"><span class="n">LogInterceptor</span> <span class="o">----</span> <span class="n">getResponse</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="n">response</span>
</span></span></code></pre></div><p>ä»¥ä¸Šä»£ç æˆ‘ç®€åŒ–äº† OkHttp åœ¨å®ç° RealInterceptorChain æ—¶çš„æ€è·¯ï¼Œå…¶æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡å°†å¤šä¸ªæ‹¦æˆªå™¨ä»¥è´£ä»»é“¾çš„æ–¹å¼æ¥ä¸€å±‚å±‚è°ƒç”¨ï¼Œä¸Šä¸€ä¸ªæ‹¦æˆªå™¨å¤„ç†å®Œåå°†å°±å°†ç»“æœä¼ ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼ˆå³ CallServerInterceptor ï¼‰å¤„ç†å®Œåå°† Response å†ä¸€å±‚å±‚å¾€ä¸Šä¼ é€’</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealInterceptorChain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">call</span><span class="p">:</span> <span class="n">RealCall</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">val</span> <span class="py">interceptors</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">val</span> <span class="py">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">exchange</span><span class="p">:</span> <span class="n">Exchange</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">connectTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">readTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">val</span> <span class="py">writeTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="nc">Interceptor</span><span class="p">.</span><span class="n">Chain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">fun</span> <span class="nf">copy</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">index</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">index</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">exchange</span><span class="p">:</span> <span class="n">Exchange</span><span class="p">?</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">exchange</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">connectTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">connectTimeoutMillis</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">readTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">readTimeoutMillis</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">writeTimeoutMillis</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">writeTimeoutMillis</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">=</span> <span class="n">RealInterceptorChain</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">interceptors</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">exchange</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">connectTimeoutMillis</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">readTimeoutMillis</span><span class="p">,</span> <span class="n">writeTimeoutMillis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="nd">@Throws</span><span class="p">(</span><span class="n">IOException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">Â·Â·Â·</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">next</span> <span class="p">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">index</span> <span class="p">=</span> <span class="n">index</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span> <span class="n">request</span> <span class="p">=</span> <span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">interceptor</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Suppress</span><span class="p">(</span><span class="s2">&#34;USELESS_ELVIS&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">interceptor</span><span class="p">.</span><span class="n">intercept</span><span class="p">(</span><span class="n">next</span><span class="p">)</span> <span class="o">?:</span> <span class="k">throw</span> <span class="n">NullPointerException</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;interceptor </span><span class="si">$interceptor</span><span class="s2"> returned null&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">Â·Â·Â·</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="å…­interceptor">å…­ã€Interceptor</h1>
<p>æˆ‘ä»¬åœ¨æ„å»º OkHttpClient çš„æ—¶å€™ï¼Œæ·»åŠ æ‹¦æˆªå™¨çš„æ–¹æ³•åˆ†ä¸ºä¸¤ç±»ï¼š<code>addInterceptor</code>å’Œ<code>addNetworkInterceptor</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">okHttClient</span> <span class="p">=</span> <span class="nc">OkHttpClient</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">addInterceptor</span> <span class="p">{</span> <span class="n">chain</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">addNetworkInterceptor</span> <span class="p">{</span> <span class="n">chain</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span></code></pre></div><p>Interceptor å’Œ NetworkInterceptor åˆ†åˆ«è¢«ç§°ä¸º<strong>åº”ç”¨æ‹¦æˆªå™¨</strong>å’Œ<strong>ç½‘ç»œæ‹¦æˆªå™¨</strong>ï¼Œé‚£ä¹ˆå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>å‰é¢æœ‰è®²åˆ°ï¼ŒOkHttp åœ¨æ‰§è¡Œæ‹¦æˆªå™¨çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§å¦‚ä¸‹é¡ºåºçš„ï¼Œè¿™ä¸ªé¡ºåºå°±å·²ç»å†³å®šäº†ä¸åŒæ‹¦æˆªå™¨çš„è°ƒç”¨æ—¶æœºå·®å¼‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">interceptors</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Interceptor</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">client</span><span class="p">.</span><span class="n">interceptors</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">RetryAndFollowUpInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">BridgeInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">cookieJar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">CacheInterceptor</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">cache</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">ConnectInterceptor</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(!</span><span class="n">forWebSocket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="n">interceptors</span> <span class="o">+=</span> <span class="n">client</span><span class="p">.</span><span class="n">networkInterceptors</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">interceptors</span> <span class="o">+=</span> <span class="n">CallServerInterceptor</span><span class="p">(</span><span class="n">forWebSocket</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>ç”±äºåº”ç”¨æ‹¦æˆªå™¨å¤„äºåˆ—è¡¨å¤´éƒ¨ï¼Œæ‰€ä»¥åœ¨æ•´ä¸ªè´£ä»»é“¾è·¯ä¸­åº”ç”¨æ‹¦æˆªå™¨ä¼šé¦–å…ˆè¢«æ‰§è¡Œï¼Œå³ä½¿ä¹‹ååœ¨ RetryAndFollowUpInterceptor ä¸­å‘ç”Ÿäº†<strong>è¯·æ±‚å¤±è´¥é‡è¯•æˆ–è€…ç½‘ç»œé‡å®šå‘</strong>ç­‰æƒ…å†µï¼Œåº”ç”¨æ‹¦æˆªå™¨ä¹Ÿåªä¼šè¢«è§¦å‘ä¸€æ¬¡ï¼Œä½†ç½‘ç»œæ‹¦æˆªå™¨ä¼šè¢«è°ƒç”¨å¤šæ¬¡</li>
<li>ç½‘ç»œæ‹¦æˆªå™¨ä½äº CacheInterceptor ä¹‹åï¼Œé‚£ä¹ˆå½“ CacheInterceptor  å‘½ä¸­ç¼“å­˜çš„æ—¶å€™å°±ä¸ä¼šå»æ‰§è¡Œç½‘ç»œè¯·æ±‚äº†ï¼Œæ­¤æ—¶ç½‘ç»œæ‹¦æˆªå™¨å°±ä¸ä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤ç½‘ç»œæ‹¦æˆªå™¨æ˜¯å­˜åœ¨çŸ­è·¯çš„å¯èƒ½ã€‚æ­¤å¤–ï¼Œç½‘ç»œæ‹¦æˆªå™¨ä½äº ConnectInterceptor ä¹‹åï¼Œåœ¨è°ƒç”¨ç½‘ç»œæ‹¦æˆªå™¨ä¹‹å‰å°±å·²ç»å‡†å¤‡å¥½ç½‘ç»œé“¾æ¥äº†ï¼Œè¯´æ˜ç½‘ç»œæ‹¦æˆªå™¨æœ¬èº«å°±å…³è”ç€å®é™…çš„ç½‘ç»œè¯·æ±‚é€»è¾‘</li>
<li>ä»å•æ¬¡è¯·æ±‚æµç¨‹ä¸Šæ¥çœ‹ï¼Œåº”ç”¨æ‹¦æˆªå™¨è¢«è°ƒç”¨å¹¶ä¸æ„å‘³ç€çœŸæ­£æœ‰å‘èµ·äº†ç½‘ç»œè¯·æ±‚ï¼Œè€Œç½‘ç»œæ‹¦æˆªå™¨è¢«è°ƒç”¨å°±è¯´æ˜çš„ç¡®å‘èµ·äº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬å¸Œæœ›é€šè¿‡æ‹¦æˆªå™¨æ¥è®°å½•ç½‘ç»œè¯·æ±‚è¯¦æƒ…çš„è¯ï¼Œå°±éœ€è¦è€ƒè™‘ä¸¤è€…çš„è°ƒç”¨æ—¶æœºå·®å¼‚ï¼šåº”ç”¨æ‹¦æˆªå™¨æ— æ³•æ„ŸçŸ¥åˆ° OkHttp è‡ªåŠ¨æ·»åŠ çš„ä¸€äº› headerï¼Œä½†æ˜¯ç½‘ç»œæ‹¦æˆªå™¨å¯ä»¥ï¼›åº”ç”¨æ‹¦æˆªå™¨é™¤éä¸»åŠ¨ä¸­æ–­è¯·æ±‚ï¼Œå¦åˆ™æ¯æ¬¡è¯·æ±‚ä¸€å®šéƒ½ä¼šè¢«æ‰§è¡Œï¼Œä½†ç½‘ç»œæ‹¦æˆªå™¨å¯èƒ½å­˜åœ¨è¢«çŸ­è·¯çš„å¯èƒ½</li>
</ul>
<p>å€Ÿç”¨å®˜æ–¹çš„ä¸€å¼ å›¾ç‰‡æ¥è¡¨ç¤º</p>
<p><div class="not-prose">
<figure>
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46eebdde38824c5491cdb54450dadc7e~tplv-k3u1fbpfcp-zoom-1.image"
      alt="" 
      loading="lazy"
    >
  </figure></div>
</p>
<p>è¿™é‡Œå¯ä»¥æ ¹æ® <a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java" target="_blank" rel="noopener">square</a>
 å®˜æ–¹æä¾›çš„ä¸€ä¸ªä¾‹å­ï¼Œæ¥å®ç°åœ¨ä¸‹è½½ä¸€å¼  10 MB å›¾ç‰‡çš„æ—¶å€™é€šè¿‡æ‹¦æˆªå™¨å¯¹ä¸‹è½½è¿›åº¦è¿›è¡Œç›‘å¬ï¼Œå¹¶åŒæ—¶æŠŠå›¾ç‰‡ä¸‹è½½åˆ°ç³»ç»Ÿçš„æ¡Œé¢</p>
<p>å®ç°æ€è·¯å°±æ˜¯å¯¹åŸå§‹çš„ ResponseBody è¿›è¡Œå¤šä¸€å±‚ä»£ç†ï¼Œè®¡ç®—å·²ç»ä»ç½‘ç»œä¸­è¯»å–åˆ°çš„å­—èŠ‚æ•°å’Œèµ„æºçš„ contentLength ä¹‹é—´çš„ç™¾åˆ†æ¯”ï¼Œä»è€Œå¾—åˆ°ä¸‹è½½è¿›åº¦ã€‚æ­¤å¤–ï¼Œå› ä¸ºè¯¥æ‹¦æˆªå™¨æ˜¯å’Œç¡®åˆ‡çš„ç½‘ç»œè¯·æ±‚ç›¸å…³ï¼Œæ‰€ä»¥åº”è¯¥è¦è®¾ä¸ºç½‘ç»œæ‹¦æˆªå™¨æ‰æ¯”è¾ƒåˆç†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @Author: leavesCZY
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @Githubï¼šhttps://github.com/leavesCZY
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">interface</span> <span class="nc">ProgressListener</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">bytesRead</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">contentLength</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">Request</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="s2">&#34;https://images.pexels.com/photos/5177790/pexels-photo-5177790.jpeg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">progressListener</span><span class="p">:</span> <span class="n">ProgressListener</span> <span class="p">=</span> <span class="k">object</span> <span class="err">: </span><span class="nc">ProgressListener</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">firstUpdate</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="k">override</span> <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">bytesRead</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">contentLength</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">println</span><span class="p">(</span><span class="s2">&#34;completed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">firstUpdate</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">firstUpdate</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">contentLength</span> <span class="o">==</span> <span class="p">-</span><span class="m">1L</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;content-length: unknown&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nc">System</span><span class="p">.</span><span class="k">out</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&#34;content-length: %d</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">contentLength</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">println</span><span class="p">(</span><span class="n">bytesRead</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">contentLength</span> <span class="o">!=</span> <span class="p">-</span><span class="m">1L</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nc">System</span><span class="p">.</span><span class="k">out</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&#34;%d%% done</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="m">100</span> <span class="p">*</span> <span class="n">bytesRead</span> <span class="p">/</span> <span class="n">contentLength</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">client</span> <span class="p">=</span> <span class="nc">OkHttpClient</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">addNetworkInterceptor</span> <span class="p">{</span> <span class="n">chain</span><span class="p">:</span> <span class="nc">Interceptor</span><span class="p">.</span><span class="n">Chain</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">originalResponse</span> <span class="p">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">originalResponse</span><span class="p">.</span><span class="n">newBuilder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">ProgressResponseBody</span><span class="p">(</span><span class="n">originalResponse</span><span class="p">.</span><span class="n">body</span><span class="o">!!</span><span class="p">,</span> <span class="n">progressListener</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">.</span><span class="n">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">execute</span><span class="p">().</span><span class="n">use</span> <span class="p">{</span> <span class="n">response</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">response</span><span class="p">.</span><span class="n">isSuccessful</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;Unexpected code </span><span class="si">$response</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">desktopDir</span> <span class="p">=</span> <span class="nc">FileSystemView</span><span class="p">.</span><span class="n">getFileSystemView</span><span class="p">().</span><span class="n">homeDirectory</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">imageFile</span> <span class="p">=</span> <span class="n">File</span><span class="p">(</span><span class="n">desktopDir</span><span class="p">,</span> <span class="s2">&#34;</span><span class="si">${System.currentTimeMillis()}</span><span class="s2">.jpeg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">imageFile</span><span class="p">.</span><span class="n">createNewFile</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è¯»å– InputStream å†™å…¥åˆ°å›¾ç‰‡æ–‡ä»¶ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="o">!!</span><span class="p">.</span><span class="n">byteStream</span><span class="p">().</span><span class="n">copyTo</span><span class="p">(</span><span class="n">imageFile</span><span class="p">.</span><span class="n">outputStream</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">class</span> <span class="nc">ProgressResponseBody</span> <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">responseBody</span><span class="p">:</span> <span class="n">ResponseBody</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">progressListener</span><span class="p">:</span> <span class="n">ProgressListener</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">:</span> <span class="n">ResponseBody</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">bufferedSource</span><span class="p">:</span> <span class="n">BufferedSource</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">contentType</span><span class="p">():</span> <span class="n">MediaType</span><span class="p">?</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">responseBody</span><span class="p">.</span><span class="n">contentType</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">contentLength</span><span class="p">():</span> <span class="n">Long</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">responseBody</span><span class="p">.</span><span class="n">contentLength</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">source</span><span class="p">():</span> <span class="n">BufferedSource</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">bufferedSource</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">bufferedSource</span> <span class="p">=</span> <span class="n">source</span><span class="p">(</span><span class="n">responseBody</span><span class="p">.</span><span class="n">source</span><span class="p">()).</span><span class="n">buffer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">bufferedSource</span><span class="o">!!</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">source</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Source</span><span class="p">):</span> <span class="n">Source</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">object</span> <span class="err">: </span><span class="nc">ForwardingSource</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">var</span> <span class="py">totalBytesRead</span> <span class="p">=</span> <span class="m">0L</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Throws</span><span class="p">(</span><span class="n">IOException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">override</span> <span class="k">fun</span> <span class="nf">read</span><span class="p">(</span><span class="n">sink</span><span class="p">:</span> <span class="n">Buffer</span><span class="p">,</span> <span class="n">byteCount</span><span class="p">:</span> <span class="n">Long</span><span class="p">):</span> <span class="n">Long</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">val</span> <span class="py">bytesRead</span> <span class="p">=</span> <span class="k">super</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">byteCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// read() returns the number of bytes read, or -1 if this source is exhausted.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">totalBytesRead</span> <span class="o">+=</span> <span class="k">if</span> <span class="p">(</span><span class="n">bytesRead</span> <span class="o">!=</span> <span class="p">-</span><span class="m">1L</span><span class="p">)</span> <span class="n">bytesRead</span> <span class="k">else</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">                <span class="n">progressListener</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">totalBytesRead</span><span class="p">,</span> <span class="n">responseBody</span><span class="p">.</span><span class="n">contentLength</span><span class="p">(),</span> <span class="n">bytesRead</span> <span class="o">==</span> <span class="p">-</span><span class="m">1L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">bytesRead</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿›åº¦è¾“å‡ºå°±ç±»ä¼¼äºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">content</span><span class="p">-</span><span class="n">length</span><span class="p">:</span> <span class="m">11448857</span>
</span></span><span class="line"><span class="cl"><span class="m">467</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span><span class="p">%</span> <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="m">1836</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span><span class="p">%</span> <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="m">3205</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">Â·Â·Â·</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">99</span><span class="p">%</span> <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="m">11442570</span>
</span></span><span class="line"><span class="cl"><span class="m">99</span><span class="p">%</span> <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="m">11448857</span>
</span></span><span class="line"><span class="cl"><span class="m">100</span><span class="p">%</span> <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="n">completed</span>
</span></span></code></pre></div><h1 id="ä¸ƒç»“å°¾">ä¸ƒã€ç»“å°¾</h1>
<p>å…³äº OkHttp çš„æºç è®²è§£åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½†æœ¬æ–‡è¿˜ç¼ºå°‘äº†å¯¹ ConnectInterceptor å’Œ CallServerInterceptor çš„è®²è§£ï¼Œè¿™ä¸¤è€…æ˜¯ OkHttp å®Œæˆå®é™…ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ï¼Œæ¶‰åŠåˆ°äº† Connection å’Œ Socket è¿™äº›æ¯”è¾ƒåº•å±‚çš„é¢†åŸŸï¼Œæˆ‘æ²¡æ³•è®²å¾—å¤šæ¸…æ™°ï¼Œå°±ç›´æ¥ç•¥è¿‡è¿™å—å†…å®¹äº†~~</p>
<p>OkHttp çš„è¿è¡Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†åœ¨ä½¿ç”¨ä¸Šè¿˜æ˜¯æ¯”è¾ƒåŸå§‹ï¼Œä¸€èˆ¬æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åœ¨ OkHttp ä¹‹ä¸Šè¿›è¡Œä¸€å±‚å°è£…ï¼ŒRetrofit å°±æ˜¯ä¸€ä¸ªå¯¹ OkHttp çš„ä¼˜ç§€å°è£…åº“ï¼Œå¯¹ Retrofit çš„æºç è®²è§£å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/6886121327845965838" target="_blank" rel="noopener">ä¸‰æ–¹åº“æºç ç¬”è®°ï¼ˆ7ï¼‰-Retrofit æºç è¯¦è§£</a>
</p>
<p>ä¸‹ç¯‡æ–‡ç« å°±æ¥å†™å…³äº OkHttp æ‹¦æˆªå™¨çš„å®æˆ˜å†…å®¹å§</p>

      </article>

      


  
<script type="text/javascript">
  (function() {
    const themeToggle = document.querySelector('.darkmode-toggle input');
    const light = 'light';
    const dark = 'dark';
    let isDark = localStorage.theme === dark || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
    let theme = isDark ? dark : light;

    const s = document.createElement('script');
    s.type = 'text/javascript';
    const dataset = {
        repo: 'tomowang\/hugo-theme-tailwind',
        repoId: 'R_kgDOKjVJHA',
        category: 'Announcements',
        categoryId: 'DIC_kwDOKjVJHM4CafqS',
        mapping: 'pathname',
        reactionsEnabled: '1',
        emitMetadata: '0',
        theme: theme,
        lang: 'en',
    };
    s.src = 'https://giscus.app/client.js';
    s.crossorigin = 'anonymous';
    s.async = true;
    Object.entries(dataset).forEach(function(a) {
        return s.dataset[a[0]] = a[1];
    });

    const curScriptElement = document.currentScript;
    curScriptElement.parentNode.insertBefore(s, curScriptElement);

    function sendMessage(message) {
      const iframe = document.querySelector('iframe.giscus-frame');
      
      if (!iframe) return;
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
    }

    themeToggle.addEventListener('change', function () {
      if (this.checked) {
        theme = dark;
      } else {
        theme = light;
      }
      sendMessage({
        setConfig: {
          theme: theme,
        }
      });
    });
  })();
</script>
  



    </div>
  </div>
</div>

  </main>
  <footer class="flex flex-none justify-center">
    <section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row">
    
  
  
    <a href="https://x.com/hqqich" target="_blank" title="X" class="flex flex-row mr-2">
      <span class="hidden">X</span>
      <i class="h-6 w-6 flex-none"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M4 4l11.733 16h4.267l-11.733 -16z"></path>
   <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path>
</svg>
 </i>
    </a>
  
  
  
    <a href="https://github.com/hqqich" target="_blank" title="Github" class="flex flex-row mr-2">
      <span class="hidden">Github</span>
      <i class="h-6 w-6 flex-none"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
</svg>
 </i>
    </a>
  
  


  </div>
  <div class="grow"></div>
  <div class="flex flex-row">
    <i class="h-6 w-6 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
   <path d="M14 9.75a3.016 3.016 0 0 0 -4.163 .173a2.993 2.993 0 0 0 0 4.154a3.016 3.016 0 0 0 4.163 .173"></path>
</svg>
</i> 2022 - 2025 Hqqich
    
  </div>
  
  <div class="flex flex-row">
    <span class="ml-0 pl-0 md:ml-2 md:pl-2 border-l-0 md:border-l border-slate-300 dark:border-slate-400">
      Powered by <a href="https://gohugo.io" target="_blank" rel="noopener" class="underline">Hugo</a> <span class="text-red-600">&hearts;</span> <a href="https://github.com/tomowang/hugo-theme-tailwind" target="_blank" rel="noopener" class="underline">Tailwind</a>
    </span>
  </div>
  
</section>

  </footer>
  <script src="/hugo-blog/public/main.js"></script>

<div class="hidden top-1 right-1" id="code-copy">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
  <path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
</svg>

  </i>
</div>
<div class="hidden top-1 right-1" id="code-copy-done">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M5 12l5 5l10 -10" />
</svg>

  </i>
</div><script src="/hugo-blog/public/code-copy.js"></script>





</body>
</html>
