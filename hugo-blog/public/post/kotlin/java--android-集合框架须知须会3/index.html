<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><script src="/hugo-blog/public/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=hugo-blog/public/livereload" data-no-instant defer></script>
  <title>Java &amp; Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰ :: Hugo Theme Tailwind Example Site - Example site for hugo-theme-tailwind</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content=" å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹
ä¸€ã€SparseArray ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† Map&lt;Integer,Object&gt; ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼šUse new SparseArray&lt;Object&gt;(...) instead for better performance ...ï¼Œå³ç”¨ SparseArray&lt; Object &gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap
è¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿
1ã€åŸºæœ¬æ¦‚å¿µ SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š
SparseArray&lt;String&gt; sparseArray = new SparseArray&lt;&gt;(); sparseArray.put(100,&#34;leavesC&#34;); sparseArray.remove(100); sparseArray.get(100); sparseArray.removeAt(29); SparseArray&lt; E &gt; ç›¸å½“äº Map&lt; Integer , E &gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼šint[] mKeys ; Object[] mValues
"
/>
<meta
  name="keywords"
  content="hugo, tailwind, tailwindcss, hugo theme, hugo theme tailwind"
/>
<meta name="robots" content="noodp" /><link rel="manifest" href="/manifest.json" /><meta property="og:url" content="http://localhost:1313/hugo-blog/public/post/kotlin/java--android-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A3/">
  <meta property="og:site_name" content="Hugo Theme Tailwind Example Site">
  <meta property="og:title" content="Java & Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰">
  <meta property="og:description" content="å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹
ä¸€ã€SparseArray ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† Map&lt;Integer,Object&gt; ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼šUse new SparseArray&lt;Object&gt;(...) instead for better performance ...ï¼Œå³ç”¨ SparseArray&lt; Object &gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap
è¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿
1ã€åŸºæœ¬æ¦‚å¿µ SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š
SparseArray&lt;String&gt; sparseArray = new SparseArray&lt;&gt;(); sparseArray.put(100,&#34;leavesC&#34;); sparseArray.remove(100); sparseArray.get(100); sparseArray.removeAt(29); SparseArray&lt; E &gt; ç›¸å½“äº Map&lt; Integer , E &gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼šint[] mKeys ; Object[] mValues">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Java & Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰">
  <meta name="twitter:description" content="å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£
æœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹
ä¸€ã€SparseArray ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† Map&lt;Integer,Object&gt; ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼šUse new SparseArray&lt;Object&gt;(...) instead for better performance ...ï¼Œå³ç”¨ SparseArray&lt; Object &gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap
è¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿
1ã€åŸºæœ¬æ¦‚å¿µ SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š
SparseArray&lt;String&gt; sparseArray = new SparseArray&lt;&gt;(); sparseArray.put(100,&#34;leavesC&#34;); sparseArray.remove(100); sparseArray.get(100); sparseArray.removeAt(29); SparseArray&lt; E &gt; ç›¸å½“äº Map&lt; Integer , E &gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼šint[] mKeys ; Object[] mValues">


<link rel="canonical" href="http://localhost:1313/hugo-blog/public/post/kotlin/java--android-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A3/" />

<link rel="shortcut icon" href="/hugo-blog/public/favicon.ico" />
<link rel="stylesheet" href="/hugo-blog/public/css/index.c3a5d1586276a68cf55558ab67f2c726fee27f4aea3add1802872f471c5f233d.css">









  
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Xiaoliang Wang"},"dateModified":"0001-01-01T00:00:00Z","datePublished":"0001-01-01T00:00:00Z","description":" å…¬ä¼—å·ï¼šå­—èŠ‚æ•°ç»„ å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£\næœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£\næœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹\nä¸€ã€SparseArray ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† Map\u0026lt;Integer,Object\u0026gt; ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼šUse new SparseArray\u0026lt;Object\u0026gt;(...) instead for better performance ...ï¼Œå³ç”¨ SparseArray\u0026lt; Object \u0026gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap\nè¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿\n1ã€åŸºæœ¬æ¦‚å¿µ SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š\nSparseArray\u0026lt;String\u0026gt; sparseArray = new SparseArray\u0026lt;\u0026gt;(); sparseArray.put(100,\u0026#34;leavesC\u0026#34;); sparseArray.remove(100); sparseArray.get(100); sparseArray.removeAt(29); SparseArray\u0026lt; E \u0026gt; ç›¸å½“äº Map\u0026lt; Integer , E \u0026gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼šint[] mKeys ; Object[] mValues\n","name":"Java \u0026 Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰","url":"http://localhost:1313/hugo-blog/public/post/kotlin/java--android-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A3/"}
</script>

</head>
<body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800">
    
<div class="fixed right-0 top-0 z-50 flex items-center justify-center bg-gray-200 p-2 text-sm uppercase text-black sm:bg-red-200 md:bg-yellow-200 lg:bg-green-200 xl:bg-blue-200 2xl:bg-pink-200">
  <span class="block sm:hidden">all</span>
  <span class="hidden sm:block md:hidden">sm</span>
  <span class="hidden md:block lg:hidden">md</span>
  <span class="hidden lg:block xl:hidden">lg</span>
  <span class="hidden xl:block 2xl:hidden">xl</span>
  <span class="hidden 2xl:block">2xl</span>
</div>

  <header class="flex flex-none justify-center z-10">
    <div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3">
  <div class="flex-none ml-2 md:ml-0">
    <a href="/hugo-blog/public/" class="">
      <img class="h-12 w-12 rounded-full object-cover bg-gray-100" src="/hugo-blog/public/logo.svg" alt="logo">
    </a>
  </div>
  
  <h1 class="hidden md:flex flex-col justify-center mx-2">
    <a href="/hugo-blog/public/" class="text-2xl font-semibold text-slate-800 dark:text-slate-200">
      Hugo Theme Tailwind
    </a>
  </h1>
  
  <div class="flex-1"></div>
  <div class="flex-none">
    



<nav class="h-full static">
  <button id="navbar-menu-toggle" type="button" class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls="navbar-menu" aria-expanded="false">
    <span class="sr-only">Open main menu</span>
    <i class="w-8 h-8">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 6l16 0" />
  <path d="M4 12l16 0" />
  <path d="M4 18l16 0" />
</svg>

    </i>
  </button>
  <div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id="navbar-menu">
    <ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-xs md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5">
    
        <li id="post" class="">
          <a class="block px-3 py-3 hover:text-emerald-600 text-emerald-600"
            href="/hugo-blog/public/post/" title="Post">Post</a>
        </li>
      
    
        <li id="about" class="">
          <a class="block px-3 py-3 hover:text-emerald-600"
            href="/hugo-blog/public/about/" title="About">About</a>
        </li>
      
    
    </ul>
  </div>
</nav>


  </div>
  
  <div class="flex-none">
    <div class="h-full static">
      <button id="navbar-lang-toggle" type="button" class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
        <span class="sr-only">Open language switcher</span>
        <i class="w-8 h-8">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c0 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>

        </i>
      </button>
      <div class="absolute hidden top-16 z-50" id="navbar-lang">
        <ul class="flex flex-col rounded-xs px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5">
          <li class="">
            <span class="block px-3 py-3 cursor-default hover:text-emerald-600">English</span>
            </li>
        
        </ul>
      </div>
    </div>
  </div>
  
  <div class="flex-none md:hidden">
    <a href=/hugo-blog/public/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
      <span class="sr-only">Search</span>
      <i class="w-8 h-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
    <path d="M21 21l-6 -6" />
</svg>

      </i>
    </a>
  </div>
  <div class="darkmode-toggle flex flex-none mr-2 md:mr-0">
    <label for="darkmode-toggle" class="relative flex items-center gap-1 px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode">
      <input name="darkmode-toggle" id="darkmode-toggle" type="checkbox" class="sr-only peer" aria-label="Toggle dark mode">
      <div class="absolute z-10 w-15 h-8 rounded-full bg-white dark:bg-gray-700"></div>
      <i class="h-6 w-6 z-20 ml-1 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:invisible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
   <path d="M12 5l0 .01"></path>
   <path d="M17 7l0 .01"></path>
   <path d="M19 12l0 .01"></path>
   <path d="M17 17l0 .01"></path>
   <path d="M12 19l0 .01"></path>
   <path d="M7 17l0 .01"></path>
   <path d="M5 12l0 .01"></path>
   <path d="M7 7l0 .01"></path>
</svg>

      </i>
      <i class="h-6 w-6 z-20 mr-1 flex-none rounded-full place-self-center invisible peer-checked:visible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
   <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
   <path d="M19 11h2m-1 -1v2"></path>
</svg>

      </i>
    </label>
  </div>
</div>

  </header>
  <main class="flex flex-auto justify-center">
    
<div id="progress" class="fixed top-0 left-0 w-full h-1 bg-blue-500"></div>
<div class="w-full max-w-4xl lg:max-w-5xl">
  <div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700">
    <div>
      <a href="/hugo-blog/public/post/kotlin/java--android-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A3/">
        
      </a>
    </div>
    <div class="flex flex-col gap-y-3 p-6">
      <h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100">
        <a href="/hugo-blog/public/post/kotlin/java--android-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E9%A1%BB%E7%9F%A5%E9%A1%BB%E4%BC%9A3/">Java &amp; Android é›†åˆæ¡†æ¶é¡»çŸ¥é¡»ä¼šï¼ˆ3ï¼‰</a>
      </h1>

      
      


      <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M6.5 7h11"></path>
   <path d="M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z"></path>
   <path d="M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z"></path>
</svg>

    </i>
    <span>
      14 minutes to read
    </span>
  </div>
</div>

      <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
    class="icon icon-tabler icons-tabler-outline icon-tabler-user">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>

    </i>
    <span>Xiaoliang Wang</span>
  </div>
</div>

      
        
        <section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6">
          <h2>Table of Contents</h2>
          <aside><nav id="TableOfContents">
  <ul>
    <li><a href="#1åŸºæœ¬æ¦‚å¿µ">1ã€åŸºæœ¬æ¦‚å¿µ</a></li>
    <li><a href="#2ç±»å£°æ˜">2ã€ç±»å£°æ˜</a></li>
    <li><a href="#3å…¨å±€å˜é‡">3ã€å…¨å±€å˜é‡</a></li>
    <li><a href="#4æ„é€ å‡½æ•°">4ã€æ„é€ å‡½æ•°</a></li>
    <li><a href="#5æ·»åŠ å…ƒç´ ">5ã€æ·»åŠ å…ƒç´ </a></li>
    <li><a href="#6ç§»é™¤å…ƒç´ ">6ã€ç§»é™¤å…ƒç´ </a></li>
    <li><a href="#7æŸ¥æ‰¾å…ƒç´ ">7ã€æŸ¥æ‰¾å…ƒç´ </a></li>
    <li><a href="#8åƒåœ¾å›æ”¶">8ã€åƒåœ¾å›æ”¶</a></li>
    <li><a href="#9ä¼˜åŠ£åŠ¿æ€»ç»“">9ã€ä¼˜åŠ£åŠ¿æ€»ç»“</a></li>
    <li><a href="#10å…³è”ç±»">10ã€å…³è”ç±»</a></li>
  </ul>

  <ul>
    <li><a href="#1å­˜å‚¨æœºåˆ¶">1ã€å­˜å‚¨æœºåˆ¶</a></li>
    <li><a href="#2æ·»åŠ å…ƒç´ ">2ã€æ·»åŠ å…ƒç´ </a></li>
    <li><a href="#3è·å–å…ƒç´ ">3ã€è·å–å…ƒç´ </a></li>
    <li><a href="#4ç¼“å­˜æœºåˆ¶">4ã€ç¼“å­˜æœºåˆ¶</a>
      <ul>
        <li><a href="#ç¼“å­˜æ•°ç»„">ç¼“å­˜æ•°ç»„</a></li>
        <li><a href="#å¤ç”¨æ•°ç»„">å¤ç”¨æ•°ç»„</a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ul>
    </li>
    <li><a href="#5ä¼˜åŠ£åŠ¿æ€»ç»“">5ã€ä¼˜åŠ£åŠ¿æ€»ç»“</a></li>
    <li><a href="#6å…³è”ç±»">6ã€å…³è”ç±»</a></li>
  </ul>
</nav></aside>
        </section>
        
      

      <article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content">
        <blockquote>
<p>å…¬ä¼—å·ï¼š<a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adbc507fc3704fd8955aae739a433db2~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" rel="noopener">å­—èŠ‚æ•°ç»„</a>
</p>
<p>å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£</p></blockquote>
<blockquote>
<p>æœ¬ç³»åˆ—æ–‡ç« ä¼šé™†ç»­å¯¹ Java å’Œ Android çš„é›†åˆæ¡†æ¶ï¼ˆJDK 1.8ï¼ŒAndroid SDK 30ï¼‰ä¸­çš„å‡ ä¸ªå¸¸è§å®¹å™¨ç»“åˆæºç è¿›è¡Œä»‹ç»ï¼Œäº†è§£ä¸åŒå®¹å™¨åœ¨<strong>æ•°æ®ç»“æ„ã€é€‚ç”¨åœºæ™¯ã€ä¼˜åŠ¿ç‚¹</strong>ä¸Šçš„ä¸åŒï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ¤£ğŸ¤£</p></blockquote>
<p>æœ¬ç¯‡æ–‡ç« å†æ¥åˆ†æä¸‹ SparseArray å’Œ ArrayMap è¿™ä¸¤ä¸ª Android ç³»ç»Ÿç‹¬æœ‰çš„é›†åˆæ¡†æ¶ç±»ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨åœ¨ä½¿ç”¨ä¸Šç±»ä¼¼äº HashMapï¼Œéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚ç”±äº Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ SparseArray å’Œ ArrayMap åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œè¿™é‡Œå°±æ¥åˆ†æä¸‹å…¶å®ç°åŸç†å’Œä¼˜åŠ¿ç‚¹</p>
<h1 id="ä¸€sparsearray">ä¸€ã€SparseArray</h1>
<p>ä½¿ç”¨ Android Studio çš„åŒå­¦å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼Œå°±æ˜¯å¦‚æœåœ¨ä»£ç ä¸­å£°æ˜äº† <code>Map&lt;Integer,Object&gt;</code> ç±»å‹å˜é‡çš„è¯ï¼ŒAndroid Studio ä¼šæç¤ºï¼š<code>Use new SparseArray&lt;Object&gt;(...) instead for better performance ...</code>ï¼Œå³<strong>ç”¨ SparseArray&lt; Object &gt; æ€§èƒ½æ›´ä¼˜ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ HashMap</strong></p>
<p>è¿™é‡Œå°±æ¥ä»‹ç»ä¸‹ SparseArray çš„å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹å®ƒç›¸æ¯” HashMap æœ‰ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿</p>
<h2 id="1åŸºæœ¬æ¦‚å¿µ">1ã€åŸºæœ¬æ¦‚å¿µ</h2>
<p>SparseArray çš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sparseArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SparseArray</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sparseArray</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">100</span><span class="p">,</span><span class="s">&#34;leavesC&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sparseArray</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">100</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sparseArray</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">100</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sparseArray</span><span class="p">.</span><span class="na">removeAt</span><span class="p">(</span><span class="n">29</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>SparseArray&lt; E &gt; ç›¸å½“äº Map&lt; Integer , E &gt; ï¼Œkey å€¼å›ºå®šä¸º int ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªéœ€è¦å£°æ˜ value çš„æ•°æ®ç±»å‹å³å¯ï¼Œå…¶å†…éƒ¨ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«æ¥å­˜å‚¨ key å’Œ valueï¼š<code>int[] mKeys ; Object[] mValues</code></p>
<p>mKeys å’Œ mValues æŒ‰ç…§å¦‚ä¸‹è§„åˆ™å¯¹åº”èµ·æ¥ï¼š</p>
<ul>
<li>å‡è®¾è¦å‘ SparseArray å­˜å…¥ key ä¸º 10ï¼Œvalue ä¸º 200 çš„é”®å€¼å¯¹ï¼Œåˆ™å…ˆå°† 10 å­˜åˆ° mKeys ä¸­ï¼Œå‡è®¾ 10 åœ¨ mKeys ä¸­å¯¹åº”çš„ç´¢å¼•å€¼æ˜¯ 2ï¼Œåˆ™å°† value å­˜å…¥ mValues[2] ä¸­</li>
<li>mKeys ä¸­çš„å…ƒç´ å€¼æŒ‰ç…§é€’å¢çš„æ–¹æ³•è¿›è¡Œå­˜å‚¨ï¼Œæ¯æ¬¡å­˜æ”¾æ–°çš„é”®å€¼å¯¹æ—¶éƒ½é€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼å°† key æ’å…¥åˆ° mKeys ä¸­</li>
<li>å½“è¦ä» SparseArray å–å€¼æ—¶ï¼Œå…ˆé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•æ‰¾åˆ° key åœ¨ mKeys ä¸­å¯¹åº”çš„ç´¢å¼•ï¼Œç„¶åæ ¹æ®è¯¥ç´¢å¼•ä» mValues ä¸­å–å€¼</li>
</ul>
<p>ä»ä»¥ä¸Šå¯ä»¥çœ‹å‡ºæ¥çš„ä¸€ç‚¹å°±æ˜¯ï¼šSparseArray é¿å…äº† HashMap æ¯æ¬¡å­˜å–å€¼æ—¶çš„è£…ç®±æ‹†ç®±æ“ä½œï¼Œkey å€¼ä¿æŒä¸ºåŸºæœ¬æ•°æ®ç±»å‹ intï¼Œå‡å°‘äº†æ€§èƒ½å¼€é”€</p>
<h2 id="2ç±»å£°æ˜">2ã€ç±»å£°æ˜</h2>
<p>SparseArray æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥ç»§æ‰¿äºä»»ä½•ç±»ï¼Œå†…éƒ¨ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ° Java åŸç”Ÿçš„é›†åˆæ¡†æ¶ï¼Œæ‰€ä»¥ SparseArray æ˜¯ Android ç³»ç»Ÿè‡ªå·±å®ç°çš„ä¸€ä¸ªé›†åˆå®¹å™¨ç±»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SparseArray</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Cloneable</span><span class="w">
</span></span></span></code></pre></div><h2 id="3å…¨å±€å˜é‡">3ã€å…¨å±€å˜é‡</h2>
<p><code>mGarbage</code> æ˜¯ SparseArray çš„ä¸€ä¸ªä¼˜åŒ–ç‚¹ä¹‹ä¸€ï¼Œç”¨äºæ ‡è®°<strong>å½“å‰æ˜¯å¦æœ‰éœ€è¦åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </strong>ï¼Œå½“è¯¥å€¼è¢«ç½®ä¸º true æ—¶ï¼Œæ„å‘³ç€å½“å‰å­˜åœ¨æ— æ•ˆå…ƒç´ ï¼Œéœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä½†å›æ”¶æ“ä½œå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œï¼Œè€Œæ˜¯åœ¨åç»­æ“ä½œä¸­å†ç»Ÿä¸€è¿›è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//é”®å€¼å¯¹è¢«ç§»é™¤åå¯¹åº”çš„ value ä¼šå˜æˆæ­¤å€¼ï¼Œç”¨æ¥å½“åš GC æ ‡è®°ä½</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">DELETED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç”¨äºæ ‡è®°å½“å‰æ˜¯å¦æœ‰å¾…åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">mKeys</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mValues</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å½“å‰é›†åˆå…ƒç´ çš„æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//è¯¥å€¼å¹¶ä¸ä¸€å®šæ˜¯æ—¶æ—¶å¤„äºæ­£ç¡®çŠ¶æ€ï¼Œå› ä¸ºæœ‰å¯èƒ½å‡ºç°åªåˆ é™¤ key å’Œ value ä¸¤è€…ä¹‹ä¸€çš„æƒ…å†µ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ‰€ä»¥ size() æ–¹æ³•å†…éƒ½ä¼šå…ˆè¿›è¡Œ GC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="4æ„é€ å‡½æ•°">4ã€æ„é€ å‡½æ•°</h2>
<p>key æ•°ç»„å’Œ value æ•°ç»„çš„é»˜è®¤å¤§å°éƒ½æ˜¯ 10ï¼Œå¦‚æœåœ¨åˆå§‹åŒ–æ—¶å·²çŸ¥æœ€ç»ˆæ•°æ®é‡çš„å¤§å°ï¼Œåˆ™å¯ä»¥ç›´æ¥æŒ‡å®šåˆå§‹å®¹é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…åç»­çš„æ‰©å®¹æ“ä½œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//è®¾ç½®æ•°ç»„çš„é»˜è®¤åˆå§‹å®¹é‡ä¸º10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nf">SparseArray</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nf">SparseArray</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">initialCapacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initialCapacity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EmptyArray</span><span class="p">.</span><span class="na">INT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EmptyArray</span><span class="p">.</span><span class="na">OBJECT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrayUtils</span><span class="p">.</span><span class="na">newUnpaddedObjectArray</span><span class="p">(</span><span class="n">initialCapacity</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">mValues</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="5æ·»åŠ å…ƒç´ ">5ã€æ·»åŠ å…ƒç´ </h2>
<p>æ·»åŠ å…ƒç´ çš„æ–¹æ³•æœ‰å‡ ä¸ªï¼Œä¸»è¦çœ‹ <code>put(int key, E value)</code> æ–¹æ³•å°±å¯ä»¥ï¼Œè¯¥æ–¹æ³•ç”¨äºå­˜å…¥ key å’Œ value ç»„æˆçš„é”®å€¼å¯¹</p>
<p>æŒ‰ç…§å‰é¢æ‰€è¯´çš„ SparseArray å­˜å‚¨é”®å€¼å¯¹çš„è§„åˆ™ï¼Œ<code>put</code> æ–¹æ³•ä¼šå…ˆåˆ¤æ–­å½“å‰ mKeys ä¸­æ˜¯å¦å·²ç»æœ‰ç›¸åŒçš„ key å€¼ï¼Œæœ‰çš„è¯å°±ç”¨ value è¦†ç›– mValues ä¸­çš„æ—§å€¼ã€‚å¦‚æœä¸å­˜åœ¨ç›¸åŒ key å€¼ï¼Œåœ¨å°† key æ’å…¥åˆ° mKeys åéœ€è¦åœ¨ mValues çš„ç›¸åŒç´¢å¼•ä½ç½®æ’å…¥ valueã€‚ç”±äº mKeys æ˜¯æŒ‰ç…§å¤§å°å¯¹å…ƒç´ å€¼è¿›è¡Œæ’åºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å°† key æ’å…¥åˆ° mKeys å¯èƒ½ä¼šå¯¼è‡´å…ƒç´ é‡æ–°æ’åºï¼Œä»è€Œè¿é”å¯¼è‡´ mValues ä¹Ÿéœ€è¦é‡æ–°æ’åº</p>
<p><code>put</code> æ–¹æ³•ä» mKeys æŸ¥æ‰¾ key ç”¨çš„æ˜¯ ContainerHelpers ç±»æä¾›çš„äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•ï¼š<code>binarySearch</code>ï¼Œç”¨äºè·å– key åœ¨ mKeys ä¸­çš„å½“å‰ç´¢å¼•ï¼ˆå­˜åœ¨è¯¥ key çš„è¯ï¼‰æˆ–è€…æ˜¯åº”è¯¥å­˜æ”¾çš„ä½ç½®çš„ç´¢å¼•ï¼ˆä¸å­˜åœ¨è¯¥ keyï¼‰ï¼Œæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p>
<ol>
<li>å¦‚æœ mKeys ä¸­å­˜åœ¨å¯¹åº”çš„ keyï¼Œåˆ™ç›´æ¥è¿”å›å¯¹åº”çš„ç´¢å¼•å€¼</li>
<li>å¦‚æœ mKeys ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ key
<ol>
<li>å‡è®¾ mKeys ä¸­å­˜åœ¨&quot;å€¼æ¯” key å¤§ä¸”å¤§å°ä¸ key æœ€æ¥è¿‘çš„å€¼çš„ç´¢å¼•&quot;ä¸º presentIndexï¼Œåˆ™æ­¤æ–¹æ³•çš„è¿”å›å€¼ä¸º ~presentIndex</li>
<li>å¦‚æœ mKeys ä¸­ä¸å­˜åœ¨æ¯” key è¿˜è¦å¤§çš„å€¼çš„è¯ï¼Œåˆ™è¿”å›å€¼ä¸º ~mKeys.length</li>
</ol>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// This is Arrays.binarySearch(), but doesn&#39;t do any argument validation.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">binarySearch</span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">lo</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">hi</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hi</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">midVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">mid</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">midVal</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">midVal</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">mid</span><span class="p">;</span><span class="w">  </span><span class="c1">// value found</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">~</span><span class="n">lo</span><span class="p">;</span><span class="w">  </span><span class="c1">// value not present</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ mKeys å­˜åœ¨ç›®æ ‡ keyï¼Œé‚£ä¹ˆè¿”å›å€¼å³å¯¹åº”çš„ç´¢å¼•ä½ç½®ã€‚å¦‚æœä¸å­˜åœ¨ç›®æ ‡ keyï¼Œå…¶è¿”å›å€¼ä¹ŸæŒ‡å‘äº†åº”è¯¥è®© key å­˜å…¥çš„ä½ç½®ï¼Œå› ä¸ºå½“ä¸å­˜åœ¨ç›®æ ‡ key æ—¶ï¼Œå°†è®¡ç®—å‡ºçš„ç´¢å¼•å€¼è¿›è¡Œ ~ è¿ç®—åè¿”å›å€¼ä¸€å®šæ˜¯è´Ÿæ•°ï¼Œä»è€Œä¸â€œæ‰¾å¾—åˆ°ç›®æ ‡ key çš„æƒ…å†µï¼ˆè¿”å›å€¼å¤§äºç­‰äº0ï¼‰â€çš„æƒ…å†µåŒºåˆ†å¼€ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºè¯¥æ–¹æ³•çš„å·§å¦™ä¹‹å¤„ï¼Œå•çº¯çš„ä¸€ä¸ªè¿”å›å€¼å°±å¯ä»¥åŒºåˆ†å‡ºå¤šç§æƒ…å†µï¼Œä¸”é€šè¿‡è¿™ç§æ–¹å¼æ¥å­˜æ”¾æ•°æ®å¯ä»¥ä½¿å¾— mKeys çš„å†…éƒ¨å€¼ä¸€ç›´æ˜¯æŒ‰ç…§å€¼é€’å¢çš„æ–¹å¼æ¥æ’åºçš„</p>
<p>å†æ¥å…·ä½“çœ‹çœ‹ put æ–¹æ³•çš„é€»è¾‘</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//å¯¹åº”å·²ç»å­˜åœ¨ç›¸åŒ key çš„æƒ…å†µ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å–åï¼Œæ‹¿åˆ°çœŸå®çš„ç´¢å¼•ä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å¦‚æœç›®æ ‡ä½ç½®è¿˜æœªèµ‹å€¼ï¼Œåˆ™ç›´æ¥å­˜å…¥æ•°æ®å³å¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mKeys</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å¦‚æœå­˜åœ¨å†—ä½™æ•°æ®ï¼Œé‚£ä¹ˆå°±å…ˆè¿›è¡Œ GC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mKeys</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//GC åå†æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œå› ä¸ºå€¼å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//ç´¢å¼• i ä½ç½®å·²ç»ç”¨äºå­˜å‚¨å…¶å®ƒæ•°æ®äº†ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œè¿ç§»</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//æ‰€ä»¥ä»ç´¢å¼• i å¼€å§‹çš„æ‰€æœ‰æ•°æ®éƒ½éœ€è¦å‘åç§»åŠ¨ä¸€ä½ï¼Œå¹¶å°† key å­˜åˆ° mKeys[i]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrowingArrayUtils</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrowingArrayUtils</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">mValues</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mSize</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å°†ç´¢å¼• index å¤„çš„å…ƒç´ èµ‹å€¼ä¸º value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//çŸ¥é“ç›®æ ‡ä½ç½®çš„è¯å¯ä»¥ç›´æ¥å‘ mValues èµ‹å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setValueAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">UtilConfig</span><span class="p">.</span><span class="na">sThrowExceptionForUpperArrayOutOfBounds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// The array might be slightly bigger than mSize, in which case, indexing won&#39;t fail.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Check if exception should be thrown outside of the critical path.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayIndexOutOfBoundsException</span><span class="p">(</span><span class="n">index</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//å¦‚æœéœ€è¦åˆ™å…ˆè¿›è¡Œåƒåœ¾å›æ”¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mValues</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å’Œ put æ–¹æ³•ç±»ä¼¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ä½†åœ¨å­˜å…¥æ•°æ®å‰å…ˆå¯¹æ•°æ®å¤§å°è¿›è¡Œäº†åˆ¤æ–­ï¼Œæœ‰åˆ©äºå‡å°‘å¯¹ mKeys è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾çš„æ¬¡æ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ‰€ä»¥åœ¨â€œå­˜å…¥çš„ key æ¯”ç°æœ‰çš„ mKeys å€¼éƒ½å¤§â€çš„æƒ…å†µä¸‹ä¼šæ¯” put æ–¹æ³•æ€§èƒ½é«˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mKeys</span><span class="o">[</span><span class="n">mSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mKeys</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrowingArrayUtils</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrowingArrayUtils</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">mValues</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="6ç§»é™¤å…ƒç´ ">6ã€ç§»é™¤å…ƒç´ </h2>
<p>ä¸Šæ–‡è¯´äº†ï¼Œå¸ƒå°”å˜é‡ <code>mGarbage</code> ç”¨äºæ ‡è®°<strong>å½“å‰æ˜¯å¦æœ‰å¾…åƒåœ¾å›æ”¶(GC)çš„å…ƒç´ </strong>ï¼Œå½“è¯¥å€¼è¢«ç½®ä¸º true æ—¶ï¼Œå³æ„å‘³ç€<strong>å½“å‰çŠ¶æ€éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä½†å›æ”¶æ“ä½œå¹¶ä¸é©¬ä¸Šè¿›è¡Œï¼Œè€Œæ˜¯åœ¨åç»­æ“ä½œä¸­å†å®Œæˆ</strong></p>
<p>ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•åœ¨ç§»é™¤å…ƒç´ æ—¶ï¼Œéƒ½åªæ˜¯åˆ‡æ–­äº† mValues å¯¹ value çš„å¼•ç”¨ï¼Œè€Œ mKeys å¹¶æ²¡æœ‰è¿›è¡Œå›æ”¶ï¼Œè¿™ä¸ªæ“ä½œä¼šç•™åˆ° <code>gc()</code> è¿›è¡Œå¤„ç†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//æ ‡è®°å½“å‰éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å’Œ delete æ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œå·®åˆ«åœ¨äºä¼šè¿”å› key å¯¹åº”çš„å…ƒç´ å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="nf">removeReturnOld</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w"> </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">old</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//åˆ é™¤æŒ‡å®šç´¢å¼•å¯¹åº”çš„å…ƒç´ å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">UtilConfig</span><span class="p">.</span><span class="na">sThrowExceptionForUpperArrayOutOfBounds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// The array might be slightly bigger than mSize, in which case, indexing won&#39;t fail.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Check if exception should be thrown outside of the critical path.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayIndexOutOfBoundsException</span><span class="p">(</span><span class="n">index</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mValues</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//æ ‡è®°å½“å‰éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//åˆ é™¤ä»èµ·å§‹ç´¢å¼•å€¼ index å¼€å§‹ä¹‹åçš„ size ä¸ªå…ƒç´ å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeAtRange</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//é¿å…å‘ç”Ÿæ•°ç»„è¶Šç•Œçš„æƒ…å†µ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">end</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">removeAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç§»é™¤æ‰€æœ‰å…ƒç´ å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mValues</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="7æŸ¥æ‰¾å…ƒç´ ">7ã€æŸ¥æ‰¾å…ƒç´ </h2>
<p>æŸ¥æ‰¾å…ƒç´ çš„æ–¹æ³•è¾ƒå¤šï¼Œé€»è¾‘éƒ½æŒºç®€å•çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//æ ¹æ® key æŸ¥æ‰¾ç›¸åº”çš„å…ƒç´ å€¼ï¼ŒæŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å›é»˜è®¤å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&#34;unchecked&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">valueIfKeyNotFound</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æŸ¥æ‰¾æŒ‡å®š key åœ¨ mKeys ä¸­çš„ç´¢å¼•å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//å¦‚æœæ‰¾ä¸åˆ°è¯¥ key æˆ–è€…è¯¥ key å°šæœªèµ‹å€¼ï¼Œåˆ™è¿”å›é»˜è®¤å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">valueIfKeyNotFound</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w"> </span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ ¹æ® key æŸ¥æ‰¾ç›¸åº”çš„å…ƒç´ å€¼ï¼ŒæŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å› null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å› ä¸º mValues ä¸­çš„å…ƒç´ å€¼å¹¶éä¸€å®šæ˜¯è¿è´¯çš„ï¼Œæœ‰å¯èƒ½æºæ‚ç€ DELETED </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ‰€ä»¥åœ¨éå†å‰éœ€è¦å…ˆè¿›è¡Œ GCï¼Œè¿™æ ·é€šè¿‡æ•°ç»„å–å‡ºçš„å€¼æ‰æ˜¯æ­£ç¡®çš„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&#34;unchecked&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="nf">valueAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w"> </span><span class="n">mValues</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ ¹æ®ç´¢å¼•å€¼ index æŸ¥æ‰¾å¯¹åº”çš„ key </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">keyAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mKeys</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ ¹æ® key å¯¹åº”çš„ç´¢å¼•å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">indexOfKey</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ContainerHelpers</span><span class="p">.</span><span class="na">binarySearch</span><span class="p">(</span><span class="n">mKeys</span><span class="p">,</span><span class="w"> </span><span class="n">mSize</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ ¹æ® value æŸ¥æ‰¾å¯¹åº”çš„ç´¢å¼•å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">indexOfValue</span><span class="p">(</span><span class="n">E</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ä¸ indexOfValue æ–¹æ³•ç±»ä¼¼ï¼Œä½† indexOfValue æ–¹æ³•æ˜¯é€šè¿‡æ¯”è¾ƒ == æ¥åˆ¤æ–­æ˜¯å¦åŒä¸ªå¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//è€Œæ­¤æ–¹æ³•æ˜¯é€šè¿‡ equals æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦åŒä¸ªå¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">indexOfValueByValue</span><span class="p">(</span><span class="n">E</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mGarbage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">mValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="8åƒåœ¾å›æ”¶">8ã€åƒåœ¾å›æ”¶</h2>
<p>å› ä¸º SparseArray ä¸­ä¼šå‡ºç°åªç§»é™¤ key å’Œ value ä¸¤è€…ä¹‹ä¸€çš„æƒ…å†µï¼Œå¯¼è‡´å½“å‰æ•°ç»„ä¸­çš„æœ‰æ•ˆæ•°æ®å¹¶ä¸æ˜¯å…¨éƒ½ç´§æŒ¨ç€æ’åˆ—åœ¨ä¸€èµ·çš„ï¼Œå³å­˜åœ¨æ— æ•ˆå€¼ï¼Œå› æ­¤ <code>gc()</code> æ–¹æ³•ä¼šæ ¹æ® mValues ä¸­åˆ°åº•å­˜åœ¨å¤šå°‘æœ‰æ•ˆæ•°æ®ï¼Œå°† mKeys å’Œ mValues ä¸­çš„æ•°æ®è¿›è¡Œé‡æ–°æ’åˆ—ï¼Œå°†æœ‰æ„ä¹‰çš„å…ƒç´ å€¼ç´§æŒ¨ç€æ’åºåœ¨ä¸€èµ·</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">gc</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mKeys</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mValues</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//val é DELETED ï¼Œè¯´æ˜è¯¥ä½ç½®å¯èƒ½éœ€è¦ç§»åŠ¨æ•°æ®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DELETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//å°†ç´¢å¼• i å¤„çš„å€¼èµ‹å€¼åˆ°ç´¢å¼• o å¤„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//æ‰€ä»¥å¦‚æœ i == o ï¼Œåˆ™ä¸éœ€è¦æ‰§è¡Œä»£ç äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">keys</span><span class="o">[</span><span class="n">o</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">values</span><span class="o">[</span><span class="n">o</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">o</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mGarbage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="9ä¼˜åŠ£åŠ¿æ€»ç»“">9ã€ä¼˜åŠ£åŠ¿æ€»ç»“</h2>
<p>ä»ä¸Šæ–‡çš„ä»‹ç»æ¥çœ‹ï¼ŒSparseArray çš„ä¸»è¦ä¼˜åŠ¿æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>é¿å…äº†åŸºæœ¬æ•°æ®ç±»å‹ int çš„è£…ç®±æ‹†ç®±æ“ä½œ</li>
<li>å’Œ HashMap ä¸­æ¯ä¸ªå­˜å‚¨ç»“ç‚¹éƒ½æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ä¸åŒï¼ŒSparseArray ä¸éœ€è¦ç”¨äºåŒ…è£… key çš„ç»“æ„ä½“ï¼Œå•ä¸ªå…ƒç´ çš„å­˜å‚¨æˆæœ¬æ›´åŠ ä½å»‰</li>
<li>åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾æ•ˆç‡è¾ƒé«˜ï¼ˆäºŒåˆ†æŸ¥æ‰¾æ³•ï¼‰</li>
<li>å»¶è¿Ÿäº†åƒåœ¾å›æ”¶çš„æ—¶æœºï¼Œåªåœ¨éœ€è¦çš„æ—¶å€™æ‰ä¸€æ¬¡æ€§è¿›è¡Œ</li>
</ul>
<p>åŠ£åŠ¿æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å…·æœ‰ç‰¹å®šçš„é€‚ç”¨èŒƒå›´ï¼Œkey åªèƒ½æ˜¯ int ç±»å‹</li>
<li>æ’å…¥é”®å€¼å¯¹æ—¶å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡çš„æ•°ç»„å…ƒç´ </li>
<li>æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒæŸ¥æ‰¾æ•ˆç‡ï¼ˆäºŒåˆ†æŸ¥æ‰¾æ³•ï¼‰ä¼šæ˜æ˜¾é™ä½ï¼Œéœ€è¦ç»è¿‡å¤šæ¬¡æŠ˜åŠæŸ¥æ‰¾æ‰èƒ½å®šä½åˆ°ç›®æ ‡æ•°æ®ã€‚è€Œ HashMap åœ¨æ²¡æœ‰å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹åªéœ€è¦è¿›è¡Œä¸€æ¬¡å“ˆå¸Œè®¡ç®—å³å¯å®šä½åˆ°ç›®æ ‡å…ƒç´ ï¼Œæœ‰å“ˆå¸Œå†²çªæ—¶ä¹Ÿåªéœ€è¦å¯¹æ¯”é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ä¸Šçš„å…ƒç´ å³å¯</li>
</ul>
<h2 id="10å…³è”ç±»">10ã€å…³è”ç±»</h2>
<p>SparseArray å±äºæ³›å‹ç±»ï¼Œæ‰€ä»¥å³ä½¿ value æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ä¹Ÿä¼šè¢«è£…ç®±å’Œæ‹†ç®±ï¼Œå¦‚æœæƒ³å†çœå»è¿™ä¸€éƒ¨åˆ†å¼€é”€çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ SparseBooleanArrayã€SparseIntArray å’Œ SparseLongArray ç­‰ä¸‰ä¸ªå®¹å™¨ç±»ï¼Œè¿™ä¸‰ä¸ªå®¹å™¨çš„å®ç°åŸç†å’Œ SparseArray ç›¸åŒï¼Œä½†æ˜¯ value è¿˜æ˜¯å±äºåŸºæœ¬æ•°æ®ç±»å‹</p>
<p>æ­¤å¤–ï¼Œç³»ç»Ÿè¿˜æä¾›äº† LongSparseArray è¿™ä¸ªå®¹å™¨ç±»ï¼Œå…¶å®ç°åŸç†å’Œ SparseArray ç±»ä¼¼ï¼Œä½†æ˜¯ key å›ºå®šä¸º long ç±»å‹ï¼Œvalue é€šè¿‡æ³›å‹æ¥å£°æ˜ï¼Œå¯¹äºæ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒæœ‰ç”¨çš„ä¸€ç‚¹æ˜¯å¯ä»¥ç”¨æ¥æ ¹æ® viewId æ¥å­˜å‚¨ view å¯¹è±¡</p>
<h1 id="äºŒarraymap">äºŒã€ArrayMap</h1>
<p>ArrayMap å±äºæ³›å‹ç±»ï¼Œç»§æ‰¿äº† Map æ¥å£ï¼Œå…¶ä½¿ç”¨æ–¹å¼å’Œ HashMap åŸºæœ¬ä¸€æ ·ï¼Œä½†åœ¨å†…éƒ¨é€»è¾‘ä¸Šæœ‰ç€å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥éœ€è¦äº†è§£å…¶å®ç°åŸç†åæ‰èƒ½æ˜ç™½ ArrayMap åˆ°åº•é€‚ç”¨äºå“ªäº›åœºæ™¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ArrayMap</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></div><h2 id="1å­˜å‚¨æœºåˆ¶">1ã€å­˜å‚¨æœºåˆ¶</h2>
<p>ArrayMap ä¸­åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„ã€‚mHashes ç”¨äºå­˜å‚¨é”®å€¼å¯¹ä¸­ key çš„å“ˆå¸Œå€¼ï¼ŒmArray åˆ™ç”¨äºå­˜å‚¨ key å’Œ valueï¼Œå³æ¯ä¸ªé”®å€¼å¯¹ä¼šä¸€èµ·è¢«å­˜å…¥ mArray ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Hashes are an implementation detail. Use public key/value API.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">mHashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Storage is an implementation detail. Use public key/value API.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mArray</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>å½“å‘ ArrayMap æ’å…¥é”®å€¼å¯¹æ—¶ï¼Œä¼šå…ˆè®¡ç®—å‡º key çš„å“ˆå¸Œå€¼ï¼Œå°† keyHash æŒ‰ç…§å¤§å°é¡ºåºå­˜å…¥ mHashes ä¸­ï¼Œæ‹¿åˆ°å…¶ä½ç½®ç´¢å¼• indexã€‚ç„¶åå°† key å­˜å…¥ mArray çš„ index&laquo;1 ä½ç½®ï¼Œå°† value å­˜å…¥ mArray çš„ (index&laquo;1 + 1) ä½ç½®ï¼Œå³ key å’Œ value ä¼šå­˜å‚¨åœ¨ç›¸é‚»çš„ä½ç½®ã€‚ä»è¿™ä¸ªä½ç½®å¯¹åº”å…³ç³»æ¥çœ‹ï¼ŒmArray çš„æ‰€éœ€å®¹é‡è‡³å°‘ä¹Ÿéœ€è¦æ˜¯ mHashes çš„ä¸¤å€ï¼Œä¸”æ¯ä¸ª key-value çš„æ’åˆ—å…³ç³»ä¹Ÿæ˜¯å’Œ keyHash çš„æ’åˆ—ä¿æŒä¸€è‡´</p>
<p>å½“è¦é€šè¿‡ key å¯¹è±¡å‘ ArrayMap å–å€¼æ—¶ï¼Œå°±å…ˆè®¡ç®—å‡º keyHashï¼Œç„¶åé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•æ‰¾åˆ° keyHash åœ¨ mHashes ä¸­çš„ä½ç½®ç´¢å¼• indexï¼Œç„¶ååœ¨ (index&laquo;1 + 1)ä½ç½®ä» mArray æ‹¿åˆ° value</p>
<h2 id="2æ·»åŠ å…ƒç´ ">2ã€æ·»åŠ å…ƒç´ </h2>
<p>æœ‰å‡ ä¸ªç”¨äºæ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œå½“ä¸­é‡ç‚¹çœ‹ <code>put</code> æ–¹æ³•å³å¯ï¼Œå…¶å®ƒæ·»åŠ å…ƒç´ çš„æ–¹æ³•éƒ½éœ€è¦ä¾é è¯¥æ–¹æ³•æ¥å®ç°ã€‚å‰æ–‡æœ‰è®²åˆ°ï¼Œkey-value æœ€ç»ˆæ˜¯ä¼šç›¸é‚»ç€å­˜å…¥ mArray ä¸­çš„ï¼Œè€Œ key-value åœ¨ mArray ä¸­çš„ä½ç½®æ˜¯ç”± keyHash å’Œ mHashes æ¥å…±åŒå†³å®šçš„ï¼Œ<code>put</code> æ–¹æ³•çš„æ•´ä½“é€»è¾‘å¦‚ä¸‹æ‰€è¿°ï¼š</p>
<ol>
<li>æ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•è·å–åˆ° keyHash åœ¨ mHashes ä¸­çš„ç´¢å¼•ä½ç½® index</li>
<li>å¦‚æœ index å¤§äºç­‰äº 0ï¼Œè¯´æ˜åœ¨ mArray ä¸­ key å·²å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥è¦†ç›–æ—§å€¼å³å¯ï¼Œç»“æŸæµç¨‹</li>
<li>å¦‚æœ index å°äº 0ï¼Œè¯´æ˜åœ¨ mArray ä¸­ key ä¸å­˜åœ¨ï¼Œ~index æ­¤æ—¶ä»£è¡¨çš„æ˜¯ keyHash æŒ‰ç…§é€’å¢é¡ºåºåº”è¯¥æ’å…¥ mHashes çš„ä½ç½®</li>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œéœ€è¦çš„è¯åˆ™è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœç¬¦åˆç¼“å­˜æ ‡å‡†çš„è¯ï¼Œåˆ™ä¼šç¼“å­˜æ‰©å®¹å‰çš„æ•°ç»„</li>
<li>å¯¹æœ€ç»ˆçš„æ•°ç»„è¿›è¡Œæ•°æ®è¿ç§»ï¼Œæ’å…¥ key-value å’Œ keyHash</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬ä¸€æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexOfNull</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mIdentityHashCode</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">identityHashCode</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexOf</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">hash</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬äºŒæ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">old</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬ä¸‰æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬å››æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//ArrayMap çš„æ‰©å®¹æœºåˆ¶ç›¸æ¯” HashMap ä¼šæ¯”è¾ƒå…‹åˆ¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å½“æ•°ç»„é•¿åº¦å·²è¶…å‡º BASE_SIZE*2 åï¼Œæ•°ç»„å®¹é‡æŒ‰ç…§ 1.5 å€æ¥æ‰©å®¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="o">+</span><span class="p">(</span><span class="n">osize</span><span class="o">&gt;&gt;</span><span class="n">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: grow from &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">ohashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">oarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mArray</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">allocArrays</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CONCURRENT_MODIFICATION_EXCEPTIONS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentModificationException</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: copy 0-&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to 0&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">ohashes</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">mHashes</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">ohashes</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">oarray</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">mArray</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">oarray</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">freeArrays</span><span class="p">(</span><span class="n">ohashes</span><span class="p">,</span><span class="w"> </span><span class="n">oarray</span><span class="p">,</span><span class="w"> </span><span class="n">osize</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬äº”æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">osize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: move &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;-&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="o">-</span><span class="n">index</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">mHashes</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">mHashes</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">index</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">mArray</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">mArray</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">mSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CONCURRENT_MODIFICATION_EXCEPTIONS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mSize</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentModificationException</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mHashes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mArray</span><span class="o">[</span><span class="p">(</span><span class="n">index</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="p">)</span><span class="o">+</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>append</code> æ–¹æ³•ä¹Ÿæ˜¯ç”¨äºæ·»åŠ å…ƒç´ çš„ï¼Œå¸¦æœ‰ä¸€ç‚¹â€œè¿½åŠ â€çš„æ„æ€ï¼Œå¦‚æœå¤–éƒ¨å¯ä»¥ç¡®å®šæœ¬æ¬¡æ’å…¥çš„ key çš„ hash å€¼æ¯”å½“å‰æ‰€æœ‰å·²æœ‰å€¼éƒ½å¤§çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å‘ mHashes çš„å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œä»è€ŒèŠ‚çœäº†äºŒåˆ†æŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚æ‰€ä»¥ <code>append</code> æ–¹æ³•ä¼šå…ˆå’Œ mHashes çš„æœ€åä¸€ä¸ªå…ƒç´ å€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœ keyHash æ¯”è¯¥å€¼å¤§çš„è¯å°±è¯´æ˜å¯ä»¥ç›´æ¥ä¿å­˜åˆ°å°¾éƒ¨ï¼Œæ ¡éªŒä¸é€šè¿‡çš„è¯è¿˜æ˜¯ä¼šè°ƒç”¨ <code>put</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">mIdentityHashCode</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">identityHashCode</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">hashCode</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&#34;Array is full&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//å¦‚æœ mHashes å½“å‰çš„æœ€åä¸€ä¸ªå€¼æ¯” hash å¤§ï¼Œhash æ²¡æ³•ç›´æ¥æ’åˆ°å°¾éƒ¨ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯éœ€è¦è°ƒç”¨ put æ–¹æ³•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mHashes</span><span class="o">[</span><span class="n">index</span><span class="o">-</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">hash</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;here&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">fillInStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">w</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;New hash &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; is before end of array hash &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="o">[</span><span class="n">index</span><span class="o">-</span><span class="n">1</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; at index &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; key &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//å°† key-value ç›´æ¥æ’å…¥åˆ°æ•°ç»„å°¾éƒ¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">+</span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mHashes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">+</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="3è·å–å…ƒç´ ">3ã€è·å–å…ƒç´ </h2>
<p>è·å–å…ƒç´ çš„æ–¹æ³•ä¸»è¦çœ‹ <code>indexOf(Object key, int hash)</code>æ–¹æ³•å³å¯ï¼Œåªè¦ç†è§£äº†è¯¥æ–¹æ³•æ˜¯å¦‚ä½•è·å– keyIndex çš„ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿå¯¹ ArrayMap çš„å­˜å‚¨ç»“æ„æœ‰æ›´æ˜ç¡®çš„è®¤çŸ¥</p>
<p><code>indexOf</code> æ–¹æ³•ç”¨äºè·å–å’Œ keyï¼Œhash å‡èƒ½å¯¹åº”ä¸Šçš„å…ƒç´ çš„å“ˆå¸Œå€¼åœ¨ mHashes ä¸­çš„ç´¢å¼•ä½ç½®ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒkeyHash æ˜¯å­˜å‚¨åœ¨ mHashes ä¸­çš„ï¼Œè€Œ key-value åˆæ˜¯å­˜å‚¨åœ¨ mArray ä¸­çš„ï¼Œä½†æˆ‘ä»¬æ— æ³•åªæ ¹æ® keyHash å°±å‡†ç¡®å¯¹åº”ä¸Š key-valueï¼Œå› ä¸ºä¸åŒçš„ key æœ‰å¯èƒ½æœ‰ç›¸åŒçš„ hash å€¼ï¼Œå³éœ€è¦è€ƒè™‘å“ˆå¸Œå†²çªçš„æƒ…å†µï¼Œæ‰€ä»¥ <code>indexOf</code> æ–¹æ³•é™¤äº†éœ€è¦å¯¹æ¯” hash å€¼å¤§å°æ˜¯å¦ç›¸ç­‰å¤–è¿˜éœ€è¦å¯¹æ¯” key çš„ç›¸ç­‰æ€§</p>
<ol>
<li>é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•è·å–åˆ° mHashes ä¸­å’Œ hash ç›¸ç­‰çš„å€¼çš„ç´¢å¼• index</li>
<li>å¦‚æœ index å°äº 0ï¼Œè¯´æ˜ä¸å­˜åœ¨è¯¥ keyï¼Œé‚£ä¹ˆå°±è¿”å› indexï¼Œ~index å°±æ˜¯ hash æ’å…¥ mHashes åçš„ä½ç½®ç´¢å¼•ã€‚ç»“æŸæµç¨‹</li>
<li>index å¤§äºç­‰äº 0ï¼Œè¯´æ˜ key æœ‰å¯èƒ½å­˜åœ¨ï¼Œä¹‹æ‰€ä»¥è¯´å¯èƒ½ï¼Œå› ä¸ºå­˜åœ¨ key ä¸åŒä½† hash å€¼ç›¸ç­‰çš„æƒ…å†µ</li>
<li>åˆ¤æ–­ mArray ä¸­ index&laquo;1 ä½ç½®çš„å…ƒç´ æ˜¯å¦å’Œ key ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰è¯´æ˜å·²ç»æ‰¾åˆ°äº†ç›®æ ‡ä½ç½®ï¼Œè¿”å› indexã€‚ç»“æŸæµç¨‹</li>
<li>æ­¤æ—¶å¯ä»¥ç¡®å®šå‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹ mArray è¿›è¡Œç›¸ç­‰æ€§å¯¹æ¯”äº†ï¼Œè€Œä¹‹æ‰€ä»¥è¦åˆ†ä¸ºä¸¤ä¸ª for å¾ªç¯ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘éå†æ¬¡æ•°ï¼Œå› ä¸ºç›¸åŒ hash å€¼æ˜¯ä¼šé æ‹¢åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥åˆ†åˆ«å‘ä¸¤ä¾§è¿›è¡Œéå†æŸ¥æ‰¾ã€‚å¦‚æœ key å’Œ keyHash çš„ç›¸ç­‰æ€§å‡æ ¡éªŒé€šè¿‡ï¼Œé‚£ä¹ˆå°±è¿”å›å¯¹åº”çš„ç´¢å¼•ã€‚ç»“æŸæµç¨‹</li>
<li>ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°å’Œ key ç›¸ç­‰çš„å…ƒç´ å€¼ï¼Œé‚£ä¹ˆå°±æ‹¿åˆ° hash åº”è¯¥å­˜å…¥ mHashes åçš„ç´¢å¼•ï¼Œ~ è¿ç®—åè¿”å›</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">int</span><span class="w"> </span><span class="nf">indexOf</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hash</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Important fast case: if nothing is in here, nothing to look for.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">~</span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬ä¸€æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binarySearchHashes</span><span class="p">(</span><span class="n">mHashes</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">hash</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// If the hash code wasn&#39;t found, then we have no entry for this key.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬äºŒæ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// If the key at the returned index matches, that&#39;s what we want.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬å››æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">mArray</span><span class="o">[</span><span class="n">index</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬äº”æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Search for a matching key after the index.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mHashes</span><span class="o">[</span><span class="n">end</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w"> </span><span class="n">end</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">mArray</span><span class="o">[</span><span class="n">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">end</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Search for a matching key before the index.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mHashes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">mArray</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Key not found -- return negative value indicating where a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// new entry for this key should go.  We use the end of the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// hash chain to reduce the number of array entries that will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// need to be copied when inserting.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ç¬¬å…­æ­¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">~</span><span class="n">end</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="4ç¼“å­˜æœºåˆ¶">4ã€ç¼“å­˜æœºåˆ¶</h2>
<p>ArrayMap å†…éƒ¨åŒ…å«äº†å¯¹ mHashes å’Œ mArray è¿™ä¸¤ä¸ªæ•°ç»„è¿›è¡Œç¼“å­˜çš„æœºåˆ¶ï¼Œé¿å…ç”±äºé¢‘ç¹åˆ›å»ºæ•°ç»„è€Œé€ æˆå†…å­˜æŠ–åŠ¨ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„ä¹‰çš„ã€‚åœ¨ Android ç³»ç»Ÿä¸­ Bundle æ˜¯ä½¿ç”¨å¾—å¾ˆé¢‘ç¹çš„ä¸€ä¸ªç±»ï¼Œå…¶å†…éƒ¨å°±é€šè¿‡ ArrayMap æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œè¿™å¯ä»¥ä» Bundle çš„çˆ¶ç±» BaseBundle çœ‹åˆ°ã€‚æ‰€ä»¥ ArrayMap çš„æ•°ç»„ç¼“å­˜æœºåˆ¶åœ¨æˆ‘çœ‹æ¥æ›´å¤šçš„æ˜¯é¢å¯¹ç³»ç»Ÿè¿è¡Œæ—¶çš„ä¼˜åŒ–æªæ–½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BaseBundle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">putBoolean</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">unparcel</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">putByte</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">unparcel</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">putChar</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">unparcel</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>put</code> æ–¹æ³•å†…éƒ¨å°±ä½¿ç”¨åˆ°äº†æ•°ç»„çš„ç¼“å­˜å’Œå¤ç”¨æœºåˆ¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="o">+</span><span class="p">(</span><span class="n">osize</span><span class="o">&gt;&gt;</span><span class="n">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: grow from &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">ohashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">oarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mArray</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å°è¯•é€šè¿‡æ•°ç»„å¤ç”¨æœºåˆ¶æ¥åˆå§‹åŒ– mHashes å’Œ mArray</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">allocArrays</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CONCURRENT_MODIFICATION_EXCEPTIONS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentModificationException</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: copy 0-&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to 0&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">ohashes</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">mHashes</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">ohashes</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">oarray</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">mArray</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">oarray</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å°è¯•å›æ”¶ ohashes å’Œ oarray</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">freeArrays</span><span class="p">(</span><span class="n">ohashes</span><span class="p">,</span><span class="w"> </span><span class="n">oarray</span><span class="p">,</span><span class="w"> </span><span class="n">osize</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="ç¼“å­˜æ•°ç»„">ç¼“å­˜æ•°ç»„</h3>
<p>å®ç°æ•°ç»„ç¼“å­˜é€»è¾‘å¯¹åº”çš„æ˜¯ <code>freeArrays</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±ç”¨äºç¼“å­˜ mHashes å’Œ mArrayã€‚æ¯å½“ ArrayMap å®Œæˆæ•°ç»„æ‰©å®¹åå°±ä¼šè°ƒç”¨æ­¤æ–¹æ³•å¯¹æ‰©å®¹å‰çš„æ•°ç»„è¿›è¡Œç¼“å­˜ï¼Œä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰æ•°ç»„éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œè€Œæ˜¯æœ‰ç€æ•°ç»„é•¿åº¦å’Œç¼“å­˜æ€»æ•°è¿™ä¸¤æ–¹é¢çš„é™åˆ¶</p>
<p>é¦–å…ˆï¼ŒArrayMap åŒ…å«äº†å¤šä¸ªå…¨å±€çš„é™æ€å˜é‡å’Œé™æ€å¸¸é‡ç”¨äºæ§åˆ¶åŠå®ç°æ•°ç»„ç¼“å­˜ã€‚ä»<code>freeArrays</code>æ–¹æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œif å’Œ else è¯­å¥å—çš„é€»è¾‘æ˜¯åŸºæœ¬å®Œå…¨ä¸€æ ·çš„ï¼Œå…¶åŒºåˆ«åªåœ¨äºè§¦å‘ç¼“å­˜çš„æ¡ä»¶å’Œä½¿ç”¨çš„ç¼“å­˜æ± ä¸ä¸€æ ·</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœ hashes çš„æ•°ç»„é•¿åº¦æ˜¯ BASE_SIZE * 2ï¼Œä¸”å½“å‰ç¼“å­˜æ€»æ•°æ²¡æœ‰è¶…å‡º CACHE_SIZEï¼Œé‚£ä¹ˆç¼“å­˜çš„æ•°ç»„å°±ä¿å­˜åœ¨ mTwiceBaseCache æ‰€æ„é€ çš„çš„å•å‘é“¾è¡¨ä¸­ã€‚mTwiceBaseCache é‡‡ç”¨å•å‘é“¾è¡¨çš„ç»“æ„æ¥ä¸²è”å¤šä¸ªæ•°ç»„ï¼Œè¦ç¼“å­˜çš„ mArray çš„ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ å€¼ä¼šå…ˆæŒ‡å‘ mTwiceBaseCacheï¼Œç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ å€¼ä¼šæŒ‡å‘ mHashesï¼Œä¹‹å mArray ä¼šæˆä¸ºå•å‘é“¾è¡¨çš„æ–°çš„å¤´ç»“ç‚¹ï¼Œå³ mArray æˆä¸ºäº†æ–°çš„ mTwiceBaseCacheã€‚åœ¨è¿™ç§ç¼“å­˜æœºåˆ¶ä¸‹ï¼Œæœ€ç»ˆ mTwiceBaseCache æŒ‡å‘çš„å…¶å®æ˜¯æœ¬æ¬¡ç¼“å­˜çš„ mArrayï¼ŒmArray çš„ç¬¬ä¸€ä¸ªå…ƒç´ å€¼æŒ‡å‘çš„åˆæ˜¯ä¸Šä¸€æ¬¡ç¼“å­˜çš„ mArrayï¼Œç¬¬äºŒä¸ªå…ƒç´ å€¼æŒ‡å‘çš„æ˜¯æœ¬æ¬¡ç¼“å­˜çš„ mHashesï¼Œä»è€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ç»“æ„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE çš„æ•°ç»„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mBaseCacheSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE * 2 çš„æ•°ç»„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mTwiceBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mTwiceBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mTwiceBaseCacheSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mBaseCacheSize å’Œ mTwiceBaseCacheSize çš„æœ€å¤§ç¼“å­˜ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CACHE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç”¨æ¥å½“åšåŒæ­¥é”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">sBaseCacheLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">sTwiceBaseCacheLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç¼“å­˜ hashes å’Œ array</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">freeArrays</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">hashes</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">sTwiceBaseCacheLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mTwiceBaseCacheSize</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CACHE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="c1">//ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ mTwiceBaseCache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mTwiceBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="c1">//ç¬¬äºŒä¸ªå…ƒç´ æŒ‡å‘ hashes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="p">)</span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;=</span><span class="n">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">//åˆ‡é™¤å¤šä½™å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼Œæœ‰åˆ©äº GC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">//array æˆä¸ºå•é“¾è¡¨çš„å¤´ç»“ç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mTwiceBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mTwiceBaseCacheSize</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Storing 2x cache &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; now have &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mTwiceBaseCacheSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; entries&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">sBaseCacheLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mBaseCacheSize</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CACHE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="p">)</span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;=</span><span class="n">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mBaseCacheSize</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Storing 1x cache &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; now have &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mBaseCacheSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; entries&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="å¤ç”¨æ•°ç»„">å¤ç”¨æ•°ç»„</h3>
<p>ç¼“å­˜æ•°ç»„çš„ç›®çš„è‡ªç„¶å°±æ˜¯ä¸ºäº†åç»­å¤ç”¨ï¼Œæ•°ç»„çš„å¤ç”¨é€»è¾‘å¯¹åº”çš„æ˜¯ <code>allocArrays</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºä¸º mHashes å’Œ mArray ç”³è¯·ä¸€ä¸ªæ›´å¤§å®¹é‡çš„æ•°ç»„ç©ºé—´ï¼Œé€šè¿‡å¤ç”¨æ•°ç»„æˆ–è€…å…¨æ–°åˆå§‹åŒ–æ¥è·å¾—</p>
<p>åœ¨è¿›è¡Œæ•°ç»„ç¼“å­˜çš„æ—¶å€™ä¼šåˆ¤æ–­æ•°ç»„é•¿åº¦ï¼Œåªæœ‰å½“é•¿åº¦æ˜¯ BASE_SIZE * 2 æˆ– BASE_SIZE æ—¶æ‰ä¼šè¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆè‡ªç„¶åªæœ‰å½“æ•°ç»„çš„ç›®æ ‡é•¿åº¦ size æ˜¯è¿™ä¸¤ä¸ªå€¼ä¹‹ä¸€æ‰ç¬¦åˆå¤ç”¨æ¡ä»¶äº†ã€‚<code>allocArrays</code> æ–¹æ³•å–å‡ºç¼“å­˜çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å–å‡ºå•å‘é“¾è¡¨çš„å¤´ç»“ç‚¹èµ‹å€¼ç»™ mHashes å’Œ mArrayï¼ŒåŒæ—¶ä½¿é“¾è¡¨çš„ç¬¬äºŒä¸ªç»“ç‚¹æˆä¸ºæ–°çš„å¤´ç»“ç‚¹å³å¯ã€‚å¦‚æœä¸ç¬¦åˆå¤ç”¨æ¡ä»¶æˆ–è€…å¤ç”¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯éœ€è¦é‡æ–°æ„å»ºä¸¤ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE çš„æ•°ç»„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mBaseCacheSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç”¨äºç¼“å­˜é•¿åº¦ä¸º BASE_SIZE * 2 çš„æ•°ç»„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">mTwiceBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mTwiceBaseCache å·²ç¼“å­˜çš„æ•°ç»„ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mTwiceBaseCacheSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//mBaseCacheSize å’Œ mTwiceBaseCacheSize çš„æœ€å¤§ç¼“å­˜ä¸ªæ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CACHE_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//ç”¨æ¥å½“åšåŒæ­¥é”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">sBaseCacheLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">sTwiceBaseCacheLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">allocArrays</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHashes</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EMPTY_IMMUTABLE_INTS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&#34;ArrayMap is immutable&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">sTwiceBaseCacheLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mTwiceBaseCache</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mTwiceBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">//æŒ‡å‘å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œå³åŸå…ˆçš„ç¬¬äºŒä¸ªç»“ç‚¹å°†æˆä¸ºé“¾è¡¨æ–°çš„å¤´ç»“ç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mTwiceBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mHashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHashes</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">//ç¬¦åˆå¤ç”¨æ¡ä»¶ï¼Œåˆ‡é™¤å¤šä½™å¼•ç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">mTwiceBaseCacheSize</span><span class="o">--</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Retrieving 2x cache &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; now have &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mTwiceBaseCacheSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; entries&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassCastException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Whoops!  Someone trampled the array (probably due to not protecting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// their access with a lock).  Our cache is corrupt; report and give up.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Slog</span><span class="p">.</span><span class="na">wtf</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Found corrupt ArrayMap cache: [0]=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; [1]=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">//ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜ç¼“å­˜æœºåˆ¶å‘ç°é—®é¢˜ï¼Œåˆ™å¼ƒç”¨ä¹‹å‰çš„æ‰€æœ‰ç¼“å­˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mTwiceBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mTwiceBaseCacheSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">sBaseCacheLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mBaseCache</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mBaseCache</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mHashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHashes</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">mBaseCacheSize</span><span class="o">--</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Retrieving 1x cache &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; now have &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mBaseCacheSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; entries&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassCastException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Whoops!  Someone trampled the array (probably due to not protecting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// their access with a lock).  Our cache is corrupt; report and give up.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Slog</span><span class="p">.</span><span class="na">wtf</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Found corrupt ArrayMap cache: [0]=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; [1]=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mBaseCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">mBaseCacheSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mHashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">size</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="n">size</span><span class="o">&lt;&lt;</span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ä¸Šæ–‡è¯´äº†ï¼Œåªæœ‰é•¿åº¦ä¸º BASE_SIZE æˆ–è€… BASE_SIZE * 2 çš„æ•°ç»„æ‰ä¼šè¢«ç¼“å­˜å¤ç”¨ï¼Œè€Œ mHashes å’Œ mArray çš„æ‰©å®¹æ“ä½œä¹Ÿä¼šå°½é‡ä½¿å¾—æ‰©å®¹åçš„æ•°ç»„é•¿åº¦å°±æ˜¯è¿™ä¸¤ä¸ªå€¼ä¹‹ä¸€ï¼Œè¿™å¯ä»¥ä» <code>put</code> æ–¹æ³•è®¡ç®—æ‰©å®¹åå®¹é‡çš„ç®—æ³•çœ‹å‡ºæ¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//è®¡ç®—æ•°ç»„æ‰©å®¹åçš„å¤§å°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="o">+</span><span class="p">(</span><span class="n">osize</span><span class="o">&gt;&gt;</span><span class="n">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">osize</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">BASE_SIZE</span><span class="o">*</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BASE_SIZE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;put: grow from &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mHashes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; to &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">ohashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mHashes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">oarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mArray</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">allocArrays</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">freeArrays</span><span class="p">(</span><span class="n">ohashes</span><span class="p">,</span><span class="w"> </span><span class="n">oarray</span><span class="p">,</span><span class="w"> </span><span class="n">osize</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">Â·Â·Â·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ‰€ä»¥è¯´ï¼Œè™½ç„¶ ArrayMap çš„æ„é€ å‡½æ•°ä¸­å¹¶æ²¡æœ‰ç›´æ¥å°† BASE_SIZE ä½œä¸ºæ•°ç»„çš„é»˜è®¤é•¿åº¦ï¼Œä½†æ˜¯åœ¨æ‰©å®¹è¿‡ç¨‹ä¸­ä¼šå°½é‡å¾€ BASE_SIZE å’Œ BASE_SIZE * 2 è¿™ä¸¤ä¸ªå€¼é æ‹¢ï¼Œè¿™å°±æœ‰åˆ©äºå°½é‡å®ç°æ•°ç»„å¤ç”¨</p>
<p>æ­¤å¤–ï¼ŒArrayMap çš„æ‰©å®¹æ“ä½œåœ¨ç”³è¯·å†…å­˜æ—¶ä¹Ÿæ˜¾å¾—æ¯”è¾ƒå…‹åˆ¶ï¼Œåœ¨æ•°ç»„é•¿åº¦è¶…å‡º BASE_SIZE * 2  åï¼Œåªæ˜¯æ‰©å®¹åˆ°å½“å‰çš„ 1.5 å€ï¼Œä¸”ä¹Ÿåªåœ¨ mHashes å®¹é‡ä¸è¶³æ—¶æ‰ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚è€Œ HashMap åœ¨è¾¾åˆ°è´Ÿè½½å› å­è®¾å®šçš„æ¯”ä¾‹åï¼ˆæ­¤æ—¶æ•°ç»„æœªæ»¡ï¼‰å°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œè€Œä¸”ä¹Ÿæ˜¯æŒ‰ç…§æ‰©å……åˆ°ä¸¤å€å®¹é‡çš„æ–¹å¼è¿›è¡Œæ‰©å®¹ã€‚æ‰€ä»¥è¯´ï¼ŒArrayMap å¯¹äºå†…å­˜ç©ºé—´çš„åˆ©ç”¨æ•ˆç‡ä¼šæ›´é«˜ä¸€äº›</p>
<h2 id="5ä¼˜åŠ£åŠ¿æ€»ç»“">5ã€ä¼˜åŠ£åŠ¿æ€»ç»“</h2>
<p>ArrayMap çš„é€‚ç”¨åœºæ™¯å¯ä»¥ä»å®ƒçš„ç¼“å­˜æœºåˆ¶å°±çœ‹å‡ºæ¥ä¸€äº›ï¼Œå®ƒä¼šç¼“å­˜å®¹é‡ä¸º 4 æˆ–è€… 8 çš„æ•°ç»„å¹¶è¿›è¡Œåç»­å¤ç”¨ï¼Œè€Œè¿™ä¸¤ä¸ªå€¼å¯ä»¥è¯´éƒ½æ˜¯æ¯”è¾ƒå°çš„ã€‚Android ç³»ç»Ÿå¯¹äºå†…å­˜æ¯”è¾ƒæ•æ„Ÿï¼Œéœ€è¦å­˜å‚¨é”®å€¼å¯¹æ—¶é¢å¯¹çš„å¾€å¾€æ˜¯ä½¿ç”¨é¢‘ç‡é«˜ä½†æ•°æ®é‡å°çš„åœºæ™¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨è·³è½¬åˆ° Activity æ—¶å¾€å¾€æ˜¯é€šè¿‡ Bundle æ¥å­˜å‚¨è·³è½¬å‚æ•°ï¼Œä½†æ•°æ®é‡ä¸€èˆ¬éƒ½å¾ˆå°‘ï¼Œæ‰€ä»¥ Bundle å†…éƒ¨å°±ä½¿ç”¨åˆ°äº† ArrayMap æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚ArrayMap åœ¨å†…å­˜ç”³è¯·æ—¶ç›¸æ¯” HashMap ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œé”®å€¼å¯¹ä¼šä»¥æ›´åŠ ç´§å¯†çš„æ•°æ®ç»“æ„å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå¯¹å†…å­˜åˆ©ç”¨ç‡ä¼šæ›´é«˜ä¸€äº›</p>
<p>è€Œç›¸å¯¹çš„ï¼ŒArrayMap çš„è¿™ç§å­˜å‚¨ç»“æ„ä¹Ÿå¯¼è‡´äº†å…¶æŸ¥æ‰¾æ•ˆç‡ç›¸æ¯” HashMap è¦ä½å¾ˆå¤šã€‚åœ¨æ•°æ®é‡å¤§æ—¶ï¼ŒArrayMap å¯èƒ½éœ€è¦é€šè¿‡å¤šæ¬¡äºŒåˆ†æŸ¥æ‰¾æ‰èƒ½å®šä½åˆ°å…ƒç´ ï¼Œè€Œ HashMap åœ¨æ²¡æœ‰å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹åªéœ€è¦ç»è¿‡ä¸€æ¬¡å“ˆå¸Œè®¡ç®—å³å¯å®šä½åˆ°å…ƒç´ ï¼Œå³ä½¿æœ‰å“ˆå¸Œå†²çªä¹Ÿåªéœ€è¦éå†å‘ç”Ÿå†²çªçš„éƒ¨åˆ†å…ƒç´ å³å¯</p>
<p>æ‰€ä»¥è¯´ï¼Œ ArrayMap é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„åœºæ™¯ï¼Œæ­¤æ—¶æŸ¥æ‰¾æ•ˆç‡ä¹Ÿä¸ä¼šå—å¤šå¤§å½±å“ï¼Œè€Œå†…å­˜åˆ©ç”¨ç‡èƒ½å¤Ÿæ˜¾è‘—æé«˜ã€‚å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ HashMap æ¥æ›¿ä»£äº†</p>
<h2 id="6å…³è”ç±»">6ã€å…³è”ç±»</h2>
<p>ç³»ç»Ÿè¿˜åŒ…å«äº†ä¸€ä¸ªç”¨äºå­˜å‚¨ä¸é‡å¤å…ƒç´ å€¼çš„é›†åˆæ¡†æ¶ç±»ï¼šArraySetï¼Œä»åå­—å°±å¯ä»¥çŒœåˆ° ArraySet å®ç°äº† Set æ¥å£ã€‚ArraySet å†…éƒ¨ä¸€æ ·ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„æ¥å­˜å‚¨ hash å’Œ valueï¼Œå³ mHashes å’Œ mArrayï¼Œåœ¨å®ç°é€»è¾‘ä¸ŠåŸºæœ¬å’Œ ArrayMap ä¸€æ ·ï¼Œåªæ˜¯ä¼šåœ¨å­˜å€¼çš„æ—¶å€™åˆ¤æ–­ value æ˜¯å¦é‡å¤è€Œå·²ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>

      </article>

      


  
<script type="text/javascript">
  (function() {
    const themeToggle = document.querySelector('.darkmode-toggle input');
    const light = 'light';
    const dark = 'dark';
    let isDark = localStorage.theme === dark || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
    let theme = isDark ? dark : light;

    const s = document.createElement('script');
    s.type = 'text/javascript';
    const dataset = {
        repo: 'tomowang\/hugo-theme-tailwind',
        repoId: 'R_kgDOKjVJHA',
        category: 'Announcements',
        categoryId: 'DIC_kwDOKjVJHM4CafqS',
        mapping: 'pathname',
        reactionsEnabled: '1',
        emitMetadata: '0',
        theme: theme,
        lang: 'en',
    };
    s.src = 'https://giscus.app/client.js';
    s.crossorigin = 'anonymous';
    s.async = true;
    Object.entries(dataset).forEach(function(a) {
        return s.dataset[a[0]] = a[1];
    });

    const curScriptElement = document.currentScript;
    curScriptElement.parentNode.insertBefore(s, curScriptElement);

    function sendMessage(message) {
      const iframe = document.querySelector('iframe.giscus-frame');
      
      if (!iframe) return;
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
    }

    themeToggle.addEventListener('change', function () {
      if (this.checked) {
        theme = dark;
      } else {
        theme = light;
      }
      sendMessage({
        setConfig: {
          theme: theme,
        }
      });
    });
  })();
</script>
  



    </div>
  </div>
</div>

  </main>
  <footer class="flex flex-none justify-center">
    <section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row">
    
  
  
    <a href="https://x.com/hqqich" target="_blank" title="X" class="flex flex-row mr-2">
      <span class="hidden">X</span>
      <i class="h-6 w-6 flex-none"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M4 4l11.733 16h4.267l-11.733 -16z"></path>
   <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path>
</svg>
 </i>
    </a>
  
  
  
    <a href="https://github.com/hqqich" target="_blank" title="Github" class="flex flex-row mr-2">
      <span class="hidden">Github</span>
      <i class="h-6 w-6 flex-none"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
</svg>
 </i>
    </a>
  
  


  </div>
  <div class="grow"></div>
  <div class="flex flex-row">
    <i class="h-6 w-6 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
   <path d="M14 9.75a3.016 3.016 0 0 0 -4.163 .173a2.993 2.993 0 0 0 0 4.154a3.016 3.016 0 0 0 4.163 .173"></path>
</svg>
</i> 2022 - 2025 Hqqich
    
  </div>
  
  <div class="flex flex-row">
    <span class="ml-0 pl-0 md:ml-2 md:pl-2 border-l-0 md:border-l border-slate-300 dark:border-slate-400">
      Powered by <a href="https://gohugo.io" target="_blank" rel="noopener" class="underline">Hugo</a> <span class="text-red-600">&hearts;</span> <a href="https://github.com/tomowang/hugo-theme-tailwind" target="_blank" rel="noopener" class="underline">Tailwind</a>
    </span>
  </div>
  
</section>

  </footer>
  <script src="/hugo-blog/public/main.js"></script>

<div class="hidden top-1 right-1" id="code-copy">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
  <path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
</svg>

  </i>
</div>
<div class="hidden top-1 right-1" id="code-copy-done">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M5 12l5 5l10 -10" />
</svg>

  </i>
</div><script src="/hugo-blog/public/code-copy.js"></script>





</body>
</html>
